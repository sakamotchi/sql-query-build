# 1.5b.4 Nuxt UI移行 Phase 4: 最終テスト・リリース

## 概要

| 項目 | 内容 |
|------|------|
| タスクID | 1.5b.4 |
| タスク名 | Nuxt UI移行Phase 4: 最終テスト・リリース |
| 担当 | QA/FE |
| 工数 | 56時間 (1週間) |
| 依存関係 | 1.5b.3 (Phase 3: UIコンポーネント移行) |
| 完了条件 | パフォーマンス目標達成、全テスト通過 |

## 目的

移行したアプリケーションの最終テスト、パフォーマンス測定、バグ修正を実施し、本番リリースの準備を整える。

この段階で以下を達成する:
- E2Eテストの実装と実行
- パフォーマンステストの実施と目標達成
- バグ修正とコード品質の担保
- リリースドキュメントの作成
- 本番環境へのデプロイ

---

## タスク詳細

### 4.1 統合テスト (16時間)

#### 4.1.1 E2Eテストシナリオ作成

**テストシナリオの定義**:

```markdown
# E2Eテストシナリオ

## 1. ランチャーシナリオ
- [ ] アプリケーションが起動する
- [ ] 接続一覧が表示される
- [ ] 新規接続ボタンから接続フォームに遷移できる
- [ ] 接続カードをクリックしてクエリビルダーが新規ウィンドウで開く
- [ ] 検索機能が動作する
- [ ] 環境別フィルターが動作する
- [ ] ソート機能が動作する

## 2. 接続管理シナリオ
- [ ] 新規接続を作成できる
- [ ] 接続情報を編集できる
- [ ] 接続を削除できる
- [ ] 接続テストが実行できる
- [ ] 環境別テーマが正しく適用される

## 3. クエリビルダーシナリオ
- [ ] データベース構造が表示される
- [ ] テーブルを選択できる
- [ ] カラムを選択できる
- [ ] WHERE条件を設定できる
- [ ] SQLプレビューが表示される
- [ ] クエリを実行できる
- [ ] 結果が表示される
- [ ] クエリを保存できる

## 4. 環境別テーマシナリオ
- [ ] 開発環境で緑色のテーマが適用される
- [ ] テスト環境で青色のテーマが適用される
- [ ] ステージング環境でオレンジ色のテーマが適用される
- [ ] 本番環境で赤色のテーマと警告バナーが表示される

## 5. マルチウィンドウシナリオ
- [ ] 複数のクエリビルダーウィンドウを同時に開ける
- [ ] 各ウィンドウが独立して動作する
- [ ] ウィンドウタイトルに接続名が表示される
```

**完了条件**: テストシナリオが承認される

---

#### 4.1.2 E2Eテスト実装（Playwright）

**Playwrightのセットアップ**:

```bash
# Playwrightをインストール
npm install -D @playwright/test
npx playwright install
```

**`playwright.config.ts`の作成**:

```typescript
import { defineConfig, devices } from '@playwright/test'

export default defineConfig({
  testDir: './tests/e2e',
  fullyParallel: false,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,

  use: {
    baseURL: 'http://localhost:1420',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure'
  },

  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] }
    }
  ],

  webServer: {
    command: 'npm run tauri dev',
    url: 'http://localhost:1420',
    reuseExistingServer: !process.env.CI
  }
})
```

**テスト実装例**:

```typescript
// tests/e2e/launcher.spec.ts

import { test, expect } from '@playwright/test'

test.describe('Launcher Page', () => {
  test('should display launcher page', async ({ page }) => {
    await page.goto('/')

    // ヘッダーが表示される
    await expect(page.getByRole('heading', { name: /ランチャー/i })).toBeVisible()

    // 新規接続ボタンが表示される
    await expect(page.getByRole('button', { name: /新規接続/i })).toBeVisible()
  })

  test('should filter connections by environment', async ({ page }) => {
    await page.goto('/')

    // 環境フィルターを選択
    await page.getByRole('combobox', { name: /環境フィルター/i }).click()
    await page.getByRole('option', { name: '開発環境' }).click()

    // 開発環境の接続のみ表示される
    const cards = page.getByTestId('connection-card')
    await expect(cards).toHaveCount(await cards.count())
  })

  test('should search connections', async ({ page }) => {
    await page.goto('/')

    // 検索ボックスに入力
    const searchBox = page.getByPlaceholder(/接続名で検索/i)
    await searchBox.fill('開発DB')

    // 検索結果が表示される
    await expect(page.getByText('開発DB')).toBeVisible()
  })

  test('should navigate to connection form', async ({ page }) => {
    await page.goto('/')

    // 新規接続ボタンをクリック
    await page.getByRole('button', { name: /新規接続/i }).click()

    // 接続フォームページに遷移
    await expect(page).toHaveURL('/connection-form')
    await expect(page.getByRole('heading', { name: /新規接続/i })).toBeVisible()
  })

  test('should launch query builder window', async ({ page, context }) => {
    await page.goto('/')

    // 接続カードをクリック
    const card = page.getByTestId('connection-card').first()
    await card.click()

    // 新しいウィンドウが開く
    const newPage = await context.waitForEvent('page')
    await newPage.waitForLoadState()

    // クエリビルダーが表示される
    await expect(newPage.getByRole('heading', { name: /クエリビルダー/i })).toBeVisible()
  })
})
```

**完了条件**: E2Eテストが実装される

---

#### 4.1.3 E2Eテスト実行

```bash
# E2Eテストを実行
npm run test:e2e

# レポートを生成
npx playwright show-report
```

**完了条件**: 全E2Eテストが通過する

---

#### 4.1.4 機能テスト（手動）

**手動テストチェックリスト**:

```markdown
## 機能テスト

### 基本機能
- [ ] アプリケーションが起動する
- [ ] 全ページにアクセスできる
- [ ] ページ遷移が正しく動作する

### 接続管理
- [ ] 接続の作成ができる
- [ ] 接続の編集ができる
- [ ] 接続の削除ができる
- [ ] 接続テストが実行できる

### クエリビルダー
- [ ] データベース構造が表示される
- [ ] クエリを構築できる
- [ ] クエリを実行できる
- [ ] 結果が表示される
- [ ] クエリを保存できる

### 環境別テーマ
- [ ] 4つの環境すべてでテーマが正しく適用される
- [ ] 本番環境で警告バナーが表示される

### マルチウィンドウ
- [ ] 複数ウィンドウを同時に開ける
- [ ] 各ウィンドウが独立して動作する

### セキュリティ
- [ ] パスワードが暗号化されて保存される
- [ ] セキュリティプロバイダーを変更できる
```

**完了条件**: 全機能テストが通過する

---

#### 4.1.5 クロスブラウザテスト

**対応ブラウザ**:
- Chromium (メイン)
- WebKit (オプション)
- Firefox (オプション)

```bash
# 全ブラウザでテスト
npx playwright test --project=chromium
npx playwright test --project=webkit
npx playwright test --project=firefox
```

**完了条件**: 対応ブラウザで動作確認完了

---

### 4.2 パフォーマンステスト (8時間)

#### 4.2.1 Lighthouseテスト

**Lighthouseの実行**:

```bash
# Lighthouseをインストール
npm install -D lighthouse

# Lighthouseテストを実行
npx lighthouse http://localhost:1420 \
  --output json \
  --output html \
  --output-path ./lighthouse-report
```

**目標スコア**:

| 指標 | 目標 | 現状 |
|------|------|------|
| Performance | 90+ | - |
| Accessibility | 95+ | - |
| Best Practices | 90+ | - |
| SEO | N/A | - |

**完了条件**: Lighthouseスコアが90以上

---

#### 4.2.2 バンドルサイズ測定

**Vite Bundle Analyzerの使用**:

```bash
# Bundle Analyzerをインストール
npm install -D rollup-plugin-visualizer

# ビルド時に解析
npm run build
```

**`vite.config.ts`に設定追加**:

```typescript
import { visualizer } from 'rollup-plugin-visualizer'

export default defineConfig({
  plugins: [
    visualizer({
      filename: 'dist/stats.html',
      open: true
    })
  ]
})
```

**目標値**:

| 指標 | 現状 | 目標 | 達成状況 |
|------|------|------|---------|
| バンドルサイズ | ~500KB | <300KB | - |

**完了条件**: バンドルサイズが300KB以下

---

#### 4.2.3 初期ロード時間測定

**パフォーマンス測定ツール**:

```typescript
// app/utils/performance.ts

export const measureLoadTime = () => {
  if (typeof window !== 'undefined') {
    window.addEventListener('load', () => {
      const perfData = window.performance.timing
      const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart

      console.log(`Page Load Time: ${pageLoadTime}ms`)

      // 目標: 2秒以内
      if (pageLoadTime > 2000) {
        console.warn('Page load time exceeds target of 2000ms')
      }
    })
  }
}
```

**目標値**:

| 指標 | 現状 | 目標 |
|------|------|------|
| 初期ロード時間 | 3.0秒 | <2.0秒 |
| First Contentful Paint | 1.5秒 | <1.0秒 |
| Time to Interactive | 3.5秒 | <2.5秒 |

**完了条件**: 初期ロード時間が2秒以内

---

#### 4.2.4 メモリ使用量測定

**Chrome DevToolsでメモリプロファイリング**:

1. Chrome DevToolsを開く
2. Memoryタブに移動
3. Heap snapshotを取得
4. メモリリークをチェック

**目標**:
- [ ] メモリリークがない
- [ ] アイドル時のメモリ使用量が100MB以下

**完了条件**: メモリリークがない

---

#### 4.2.5 パフォーマンス最適化

**最適化手法**:

1. **コード分割**:
```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  build: {
    splitChunks: {
      layouts: true,
      pages: true,
      commons: true
    }
  }
})
```

2. **画像最適化**:
```vue
<NuxtImg
  src="/images/logo.png"
  loading="lazy"
  width="200"
  height="50"
/>
```

3. **Lazy Loading**:
```vue
<script setup lang="ts">
const HeavyComponent = defineAsyncComponent(() =>
  import('./HeavyComponent.vue')
)
</script>
```

**完了条件**: パフォーマンス目標を達成

---

### 4.3 バグ修正 (16時間)

#### 4.3.1 バグトリアージ

**バグ優先度の定義**:

| 優先度 | 定義 | 対応期限 |
|--------|------|---------|
| Critical | アプリが起動しない、データ損失の恐れ | 即座 |
| High | 主要機能が動作しない | 24時間以内 |
| Medium | 一部機能に問題がある | 1週間以内 |
| Low | UIの小さな問題、改善提案 | 次バージョン |

**バグトラッキング**:

```markdown
# バグ一覧

## Critical
- [ ] なし

## High
- [ ] [例] 接続削除時にエラーが発生する

## Medium
- [ ] [例] 検索フィルターがリセットされない

## Low
- [ ] [例] ツールチップの表示位置がずれる
```

**完了条件**: バグが優先度別に分類される

---

#### 4.3.2 クリティカルバグ修正

**修正プロセス**:

1. バグを再現する
2. 原因を特定する
3. 修正を実装する
4. テストを追加する
5. レビューを受ける
6. マージする

**完了条件**: クリティカルバグがゼロ

---

#### 4.3.3 高優先度バグ修正

同様の方法で高優先度バグを修正。

**完了条件**: 高優先度バグがゼロ

---

#### 4.3.4 中優先度バグ修正

同様の方法で中優先度バグを修正。

**完了条件**: 修正可能な限り対応

---

#### 4.3.5 修正確認テスト

```bash
# 修正後に全テストを再実行
npm run test
npm run test:e2e
```

**完了条件**: 全テストが通過する

---

### 4.4 リリース準備 (16時間)

#### 4.4.1 リリースノート作成

**`RELEASE_NOTES.md`**:

```markdown
# Release Notes - Nuxt UI v4 Migration

## バージョン: 2.0.0

**リリース日**: 2025-XX-XX

## 主な変更点

### UIフレームワーク移行
- VuetifyからNuxt UI v4へ移行
- Tailwind CSSベースの新しいデザインシステム
- アイコンをIconifyに移行（200,000+のアイコンに対応）

### パフォーマンス改善
- バンドルサイズ: 500KB → 280KB (-44%)
- 初期ロード時間: 3.0秒 → 1.8秒 (-40%)
- First Contentful Paint: 1.5秒 → 0.9秒 (-40%)

### 開発体験の向上
- Nuxt 3の自動インポート機能
- ファイルベースルーティング
- 型安全性の向上

## 破壊的変更

- Vuetifyコンポーネントは使用できません
- MDIアイコンの代わりにIconifyを使用
- 一部のコンポーネントAPIが変更されています

## 移行ガイド

詳細は [MIGRATION.md](./MIGRATION.md) を参照してください。

## 既知の問題

- なし

## 今後の予定

- Phase 2: 高度な機能実装
- Phase 3: 安全機能・最適化
```

**完了条件**: リリースノートが作成される

---

#### 4.4.2 ドキュメント更新

**`README.md`の更新**:

```markdown
# SQL Query Build

GUIベースでSQLクエリを構築できる直感的なSQLエディタ。

## 技術スタック

- **デスクトップフレームワーク**: Tauri 2.x
- **フロントエンドフレームワーク**: Nuxt 3
- **UIフレームワーク**: Nuxt UI v4
- **CSSフレームワーク**: Tailwind CSS v4
- **状態管理**: Pinia
- **バックエンド**: Rust

## 開発コマンド

```bash
# 開発サーバー起動
npm run tauri dev

# ビルド
npm run tauri build

# テスト
npm run test
npm run test:e2e
```

## ドキュメント

- [移行計画書](docs/migration_plan_nuxt_ui.md)
- [移行WBS](docs/migration_wbs_nuxt_ui.md)
- [要件定義書](docs/sql_editor_requirements_md.md)
```

**完了条件**: ドキュメントが更新される

---

#### 4.4.3 マイグレーションガイド作成

**`MIGRATION.md`**:

```markdown
# Migration Guide: Vuetify to Nuxt UI v4

## 概要

このガイドでは、VuetifyからNuxt UI v4への移行方法を説明します。

## コンポーネント移行

### ボタン

**Before (Vuetify):**
```vue
<v-btn color="primary" variant="elevated">
  保存
</v-btn>
```

**After (Nuxt UI):**
```vue
<UButton color="primary" variant="solid">
  保存
</UButton>
```

### カード

**Before (Vuetify):**
```vue
<v-card>
  <v-card-title>タイトル</v-card-title>
  <v-card-text>内容</v-card-text>
</v-card>
```

**After (Nuxt UI):**
```vue
<UCard>
  <template #header>
    <h3>タイトル</h3>
  </template>
  <p>内容</p>
</UCard>
```

## アイコン移行

**Before (MDI):**
```vue
<v-icon>mdi-database</v-icon>
```

**After (Iconify):**
```vue
<UIcon name="i-heroicons-circle-stack" />
```

## 詳細

詳細なコンポーネント移行マッピングは [migration_plan_nuxt_ui.md](docs/migration_plan_nuxt_ui.md) を参照してください。
```

**完了条件**: マイグレーションガイドが作成される

---

#### 4.4.4 最終コードレビュー

**レビュー観点**:

- [ ] コード品質（ESLint、Prettier）
- [ ] 型安全性（TypeScript）
- [ ] パフォーマンス
- [ ] アクセシビリティ
- [ ] セキュリティ
- [ ] ドキュメント

**完了条件**: コードレビューが承認される

---

#### 4.4.5 mainブランチへのPR作成

```bash
# PRを作成
gh pr create \
  --base main \
  --head feature/migrate-nuxt-ui \
  --title "feat: Migrate from Vuetify to Nuxt UI v4" \
  --body "$(cat <<'EOF'
## 概要
VuetifyからNuxt UI v4への移行を完了しました。

## 主な変更点
- Nuxt 3の導入
- Nuxt UI v4への全コンポーネント移行
- Tailwind CSSベースのデザインシステム
- パフォーマンス改善

## テスト
- [x] E2Eテスト通過
- [x] パフォーマンステスト目標達成
- [x] 全機能動作確認

## 関連ドキュメント
- [移行計画書](docs/migration_plan_nuxt_ui.md)
- [移行WBS](docs/migration_wbs_nuxt_ui.md)
- [リリースノート](RELEASE_NOTES.md)
EOF
)"
```

**完了条件**: PRが作成される

---

#### 4.4.6-4.4.10 マージからリリースまで

1. PR承認・マージ
2. リリースタグ作成
3. デプロイ・動作確認
4. リリースアナウンス
5. プロジェクトクロージング

---

## 成果物

### ドキュメント
- [ ] `RELEASE_NOTES.md` - リリースノート
- [ ] `MIGRATION.md` - マイグレーションガイド
- [ ] `README.md` - 更新版
- [ ] テストレポート
- [ ] パフォーマンステストレポート

### テスト
- [ ] E2Eテスト（Playwright）
- [ ] パフォーマンステスト結果

### リリース
- [ ] Pull Request
- [ ] リリースタグ
- [ ] デプロイ済みアプリケーション

---

## 品質基準

### パフォーマンス目標

| 指標 | 現状 | 目標 | 達成状況 |
|------|------|------|---------|
| バンドルサイズ | ~500KB | <300KB | ☐ |
| 初期ロード時間 | 3.0秒 | <2.0秒 | ☐ |
| FCP | 1.5秒 | <1.0秒 | ☐ |
| TTI | 3.5秒 | <2.5秒 | ☐ |
| Lighthouseスコア | 85 | 90+ | ☐ |

### テスト基準

- [ ] E2Eテスト通過率: 100%
- [ ] コードカバレッジ: 80%以上
- [ ] クリティカルバグ: 0件
- [ ] 高優先度バグ: 0件

---

## 実装チェックリスト

### 4.1 統合テスト
- [ ] 4.1.1 E2Eテストシナリオ作成
- [ ] 4.1.2 E2Eテスト実装（Playwright）
- [ ] 4.1.3 E2Eテスト実行
- [ ] 4.1.4 機能テスト（手動）
- [ ] 4.1.5 クロスブラウザテスト

### 4.2 パフォーマンステスト
- [ ] 4.2.1 Lighthouseテスト
- [ ] 4.2.2 バンドルサイズ測定
- [ ] 4.2.3 初期ロード時間測定
- [ ] 4.2.4 メモリ使用量測定
- [ ] 4.2.5 パフォーマンス最適化

### 4.3 バグ修正
- [ ] 4.3.1 バグトリアージ
- [ ] 4.3.2 クリティカルバグ修正
- [ ] 4.3.3 高優先度バグ修正
- [ ] 4.3.4 中優先度バグ修正
- [ ] 4.3.5 修正確認テスト

### 4.4 リリース準備
- [ ] 4.4.1 リリースノート作成
- [ ] 4.4.2 ドキュメント更新
- [ ] 4.4.3 マイグレーションガイド作成
- [ ] 4.4.4 最終コードレビュー
- [ ] 4.4.5 mainブランチへのPR作成
- [ ] 4.4.6 PR承認・マージ
- [ ] 4.4.7 リリースタグ作成
- [ ] 4.4.8 デプロイ・動作確認
- [ ] 4.4.9 リリースアナウンス
- [ ] 4.4.10 プロジェクトクロージング

---

## プロジェクト完了

**完了基準**:

✅ 全42コンポーネントがNuxt UI v4に移行完了
✅ 全E2Eテストが通過
✅ パフォーマンス目標を達成
✅ クリティカルバグがゼロ
✅ ドキュメントが完成
✅ 本番環境で動作確認完了

---

**作成日**: 2025-12-06
**作成者**: Claude Code
