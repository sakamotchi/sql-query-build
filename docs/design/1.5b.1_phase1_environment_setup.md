# 1.5b.1 Nuxt UI移行 Phase 1: 環境構築・準備

## 概要

| 項目 | 内容 |
|------|------|
| タスクID | 1.5b.1 |
| タスク名 | Nuxt UI移行Phase 1: 環境構築 |
| 担当 | FE |
| 工数 | 56時間 (1週間) |
| 依存関係 | 1.1.5 (開発環境・ビルド設定) |
| 完了条件 | Nuxt 3 + Nuxt UI動作確認 |

## 目的

VuetifyからNuxt UI v4への移行を開始するため、新しい技術スタックをセットアップし、基本的な動作を確認する。

この段階で以下を達成する:
- Nuxt 3 + Nuxt UI v4のインストールと初期設定
- Tailwind CSS v4のセットアップ
- 環境別テーマの再設計
- プロジェクト構造の変更準備

---

## アーキテクチャ

### 技術スタック変更

| コンポーネント | 移行前 | 移行後 |
|--------------|--------|--------|
| フレームワーク | Vue 3 + Vite | Nuxt 3 |
| UIライブラリ | Vuetify 3.10.3 | Nuxt UI v4.0.0 |
| CSSフレームワーク | Sass (Vuetify) | Tailwind CSS v4 |
| アイコン | @mdi/font | Iconify (@nuxt/icon) |
| カラーモード | Vuetifyテーマ | @nuxtjs/color-mode |

### 新しいディレクトリ構造

```
/
├── app/                      # Nuxt 3アプリケーション (旧: src/)
│   ├── assets/
│   │   └── css/
│   │       └── tailwind.css
│   ├── components/
│   │   ├── connection/
│   │   ├── common/
│   │   ├── query-builder/
│   │   ├── security/
│   │   └── settings/
│   ├── composables/
│   │   └── useTheme.ts
│   ├── layouts/
│   │   ├── default.vue
│   │   ├── launcher.vue
│   │   └── query-builder.vue
│   ├── pages/
│   │   ├── index.vue
│   │   ├── query-builder.vue
│   │   ├── settings.vue
│   │   └── connection-form.vue
│   ├── stores/
│   ├── utils/
│   ├── app.vue
│   └── app.config.ts         # Nuxt UI設定
├── public/
├── src-tauri/                # 変更なし
├── nuxt.config.ts            # Nuxt設定
├── tailwind.config.ts        # Tailwind設定
└── package.json
```

---

## タスク詳細

### 1.1 プロジェクトセットアップ (16時間)

#### 1.1.1 移行用ブランチ作成

```bash
# 移行用ブランチを作成
git checkout -b feature/migrate-nuxt-ui

# リモートにプッシュ
git push -u origin feature/migrate-nuxt-ui
```

**完了条件**: ブランチが作成され、リモートにプッシュ済み

---

#### 1.1.2 Nuxt 3インストール

**依存関係のインストール**:

```bash
# Nuxt 3をインストール
npm install nuxt@^3.14.0

# Nuxt必須モジュール
npm install @nuxtjs/tailwindcss@^7.0.0 @nuxtjs/color-mode@^3.5.0
npm install @pinia/nuxt@^0.7.0
```

**`nuxt.config.ts`の作成**:

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  // SSRは無効（Tauri制約）
  ssr: false,

  // Appディレクトリを使用
  srcDir: 'app/',

  // 開発サーバー設定（Tauri用）
  devServer: {
    host: '0.0.0.0',
    port: 1420
  },

  // Vite設定（Tauri統合）
  vite: {
    clearScreen: false,
    envPrefix: ['VITE_', 'TAURI_'],
    server: {
      strictPort: true,
      hmr: {
        protocol: 'ws',
        host: 'localhost',
        port: 1421
      },
      watch: {
        ignored: ['**/src-tauri/**']
      }
    }
  },

  // モジュール
  modules: [
    '@nuxtjs/tailwindcss',
    '@nuxtjs/color-mode',
    '@pinia/nuxt'
  ],

  // TypeScript設定
  typescript: {
    strict: true,
    typeCheck: true
  },

  // 実験的機能
  experimental: {
    payloadExtraction: false
  },

  // ビルド設定
  build: {
    transpile: []
  }
})
```

**完了条件**: `npm run dev`でNuxt 3が起動する

---

#### 1.1.3 Nuxt UI v4インストール

```bash
# Nuxt UIとアイコンモジュールをインストール
npm install @nuxt/ui@^4.0.0 @nuxt/icon@^1.0.0
```

**`nuxt.config.ts`にモジュール追加**:

```typescript
export default defineNuxtConfig({
  // ...
  modules: [
    '@nuxt/ui',          // 追加
    '@nuxt/icon',        // 追加
    '@nuxtjs/tailwindcss',
    '@nuxtjs/color-mode',
    '@pinia/nuxt'
  ]
})
```

**完了条件**: Nuxt UIコンポーネントが表示可能

---

#### 1.1.4 Tailwind CSS設定

**Tailwind CSS v4のインストール**:

```bash
npm install tailwindcss@^4.0.0
```

**`tailwind.config.ts`の作成**:

```typescript
// tailwind.config.ts
import type { Config } from 'tailwindcss'

export default {
  content: [
    './app/**/*.{vue,js,ts}',
    './nuxt.config.ts'
  ],
  theme: {
    extend: {
      // 環境別カラーパレット
      colors: {
        development: {
          50: '#F1F8E9',
          100: '#DCEDC8',
          200: '#C5E1A5',
          300: '#AED581',
          400: '#9CCC65',
          500: '#4CAF50',
          600: '#43A047',
          700: '#388E3C',
          800: '#2E7D32',
          900: '#1B5E20'
        },
        test: {
          50: '#E3F2FD',
          100: '#BBDEFB',
          200: '#90CAF9',
          300: '#64B5F6',
          400: '#42A5F5',
          500: '#2196F3',
          600: '#1E88E5',
          700: '#1976D2',
          800: '#1565C0',
          900: '#0D47A1'
        },
        staging: {
          50: '#FFF3E0',
          100: '#FFE0B2',
          200: '#FFCC80',
          300: '#FFB74D',
          400: '#FFA726',
          500: '#FF9800',
          600: '#FB8C00',
          700: '#F57C00',
          800: '#EF6C00',
          900: '#E65100'
        },
        production: {
          50: '#FFEBEE',
          100: '#FFCDD2',
          200: '#EF9A9A',
          300: '#E57373',
          400: '#EF5350',
          500: '#F44336',
          600: '#E53935',
          700: '#D32F2F',
          800: '#C62828',
          900: '#B71C1C'
        }
      }
    }
  },
  plugins: []
} satisfies Config
```

**`app/assets/css/tailwind.css`の作成**:

```css
@tailwind base;
@tailwind components;
@tailwind utilities;

/* 環境別カスタムユーティリティ */
@layer utilities {
  .env-development {
    @apply bg-development-50 border-development-500;
  }
  .env-test {
    @apply bg-test-50 border-test-500;
  }
  .env-staging {
    @apply bg-staging-50 border-staging-500;
  }
  .env-production {
    @apply bg-production-50 border-production-500 border-4;
  }
}
```

**完了条件**: Tailwindクラスが適用される

---

#### 1.1.5 TypeScript設定調整

**`tsconfig.json`の更新**:

```json
{
  "extends": "./.nuxt/tsconfig.json",
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "preserve",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "paths": {
      "~/*": ["./app/*"],
      "@/*": ["./app/*"]
    }
  },
  "include": [
    "app/**/*",
    "nuxt.config.ts"
  ],
  "exclude": [
    "node_modules",
    "dist",
    ".nuxt",
    "src-tauri"
  ]
}
```

**完了条件**: 型エラーがない

---

#### 1.1.6 Vite→Nuxt設定移行

**既存の`vite.config.ts`の設定をNuxtに移行**:

```typescript
// nuxt.config.ts (Tauri統合設定を追加)
export default defineNuxtConfig({
  // ...

  vite: {
    clearScreen: false,
    envPrefix: ['VITE_', 'TAURI_'],

    // Tauri開発サーバー設定
    server: {
      strictPort: true,
      port: 1420,
      hmr: {
        protocol: 'ws',
        host: 'localhost',
        port: 1421
      },
      watch: {
        ignored: ['**/src-tauri/**']
      }
    },

    // ビルド設定
    build: {
      target: 'esnext',
      minify: !process.env.TAURI_DEBUG ? 'esbuild' : false,
      sourcemap: !!process.env.TAURI_DEBUG
    }
  }
})
```

**完了条件**: Tauri統合が動作する

---

#### 1.1.7 依存関係クリーンアップ

**削除する依存関係**:

```bash
# Vuetify関連を削除
npm uninstall vuetify @mdi/font sass-embedded
```

**`package.json`の確認**:

```json
{
  "dependencies": {
    "nuxt": "^3.14.0",
    "@nuxt/ui": "^4.0.0",
    "@nuxt/icon": "^1.0.0",
    "@nuxtjs/tailwindcss": "^7.0.0",
    "@nuxtjs/color-mode": "^3.5.0",
    "@pinia/nuxt": "^0.7.0",
    "@tauri-apps/api": "^2.0.0",
    "pinia": "^3.0.3",
    "vue": "^3.5.13"
  },
  "devDependencies": {
    "tailwindcss": "^4.0.0",
    "typescript": "^5.6.3",
    "vite": "^6.0.3"
  }
}
```

**完了条件**: Vuetify関連パッケージが削除されている

---

#### 1.1.8 ビルドテスト

```bash
# プロダクションビルドを実行
npm run build

# Tauriビルドをテスト
npm run tauri build
```

**完了条件**: ビルドが成功する

---

### 1.2 Tailwind CSSテーマ設計 (16時間)

#### 1.2.1 環境別カラーパレット定義

**`app/app.config.ts`の作成**:

```typescript
// app/app.config.ts
export default defineAppConfig({
  ui: {
    // デフォルトプライマリカラー（開発環境）
    primary: 'green',

    // 環境別カラーパレット
    colors: {
      development: {
        50: '#F1F8E9',
        500: '#4CAF50',
        900: '#1B5E20'
      },
      test: {
        50: '#E3F2FD',
        500: '#2196F3',
        900: '#0D47A1'
      },
      staging: {
        50: '#FFF3E0',
        500: '#FF9800',
        900: '#E65100'
      },
      production: {
        50: '#FFEBEE',
        500: '#F44336',
        900: '#B71C1C'
      }
    }
  }
})
```

**完了条件**: 4環境の色が定義されている

---

#### 1.2.2 Tailwindテーマ拡張設定

**`tailwind.config.ts`に環境別カラーを追加** (1.1.4で実施済み)

**カスタムカラー使用例**:

```vue
<template>
  <!-- 開発環境のカラーを使用 -->
  <div class="bg-development-50 text-development-900 border-development-500">
    開発環境
  </div>

  <!-- 本番環境のカラーを使用 -->
  <div class="bg-production-50 text-production-900 border-production-500 border-4">
    本番環境
  </div>
</template>
```

**完了条件**: カスタムカラーが適用される

---

#### 1.2.3 ダークモード設定

**`nuxt.config.ts`に`@nuxtjs/color-mode`を設定**:

```typescript
export default defineNuxtConfig({
  // ...

  colorMode: {
    preference: 'light',  // デフォルトはライトモード
    fallback: 'light',
    classSuffix: '',
    storageKey: 'nuxt-color-mode'
  }
})
```

**ダークモード切り替えコンポーネント例**:

```vue
<script setup lang="ts">
const colorMode = useColorMode()

const toggleDarkMode = () => {
  colorMode.preference = colorMode.value === 'dark' ? 'light' : 'dark'
}
</script>

<template>
  <UButton
    :icon="colorMode.value === 'dark' ? 'i-heroicons-moon' : 'i-heroicons-sun'"
    @click="toggleDarkMode"
  >
    {{ colorMode.value === 'dark' ? 'ライト' : 'ダーク' }}モード
  </UButton>
</template>
```

**完了条件**: ダークモードが切り替え可能

---

#### 1.2.4 カスタムユーティリティ作成

**環境別クラスの定義** (`app/assets/css/tailwind.css`):

```css
@layer utilities {
  /* 環境別背景・ボーダー */
  .env-development {
    @apply bg-development-50 border-development-500 border-2;
  }
  .env-test {
    @apply bg-test-50 border-test-500 border-2;
  }
  .env-staging {
    @apply bg-staging-50 border-staging-500 border-2;
  }
  .env-production {
    @apply bg-production-50 border-production-500 border-4;
  }

  /* 環境別テキスト */
  .env-text-development {
    @apply text-development-900;
  }
  .env-text-test {
    @apply text-test-900;
  }
  .env-text-staging {
    @apply text-staging-900;
  }
  .env-text-production {
    @apply text-production-900;
  }
}
```

**完了条件**: 環境別クラスが使用可能

---

#### 1.2.5 グローバルCSS設定

**`app/assets/css/tailwind.css`にグローバルスタイル追加**:

```css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  /* デフォルトフォント */
  body {
    @apply font-sans;
  }

  /* スクロールバースタイル */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    @apply bg-gray-100 dark:bg-gray-800;
  }

  ::-webkit-scrollbar-thumb {
    @apply bg-gray-300 dark:bg-gray-600 rounded;
  }

  ::-webkit-scrollbar-thumb:hover {
    @apply bg-gray-400 dark:bg-gray-500;
  }
}
```

**`app/app.vue`でCSSをインポート**:

```vue
<script setup lang="ts">
// グローバルCSSをインポート
import '~/assets/css/tailwind.css'
</script>

<template>
  <div>
    <NuxtPage />
  </div>
</template>
```

**完了条件**: グローバルスタイルが適用される

---

#### 1.2.6 テーマ動作確認

**テストページの作成** (`app/pages/theme-test.vue`):

```vue
<script setup lang="ts">
const environments = ['development', 'test', 'staging', 'production'] as const
</script>

<template>
  <div class="p-8 space-y-8">
    <h1 class="text-3xl font-bold">環境別テーマテスト</h1>

    <div
      v-for="env in environments"
      :key="env"
      :class="`env-${env} p-6 rounded-lg`"
    >
      <h2 :class="`env-text-${env} text-2xl font-semibold mb-2`">
        {{ env }}環境
      </h2>
      <p class="text-gray-700 dark:text-gray-300">
        この環境のテーマカラーが正しく適用されています。
      </p>

      <UButton
        :color="env"
        class="mt-4"
      >
        {{ env }}ボタン
      </UButton>
    </div>
  </div>
</template>
```

**完了条件**: 4環境すべてのテーマが表示される

---

#### 1.2.7 ドキュメント作成

**`docs/theme-guide.md`の作成**:

````markdown
# Nuxt UI テーマガイド

## 環境別カラーパレット

| 環境 | Primary | Background | 用途 |
|------|---------|-----------|------|
| Development | #4CAF50 | #F1F8E9 | 開発環境 |
| Test | #2196F3 | #E3F2FD | テスト環境 |
| Staging | #FF9800 | #FFF3E0 | ステージング環境 |
| Production | #F44336 | #FFEBEE | 本番環境 |

## 使用方法

### Tailwind CSSクラス

```vue
<div class="bg-development-50 text-development-900">
  開発環境
</div>
```

### Nuxt UIコンポーネント

```vue
<UButton color="development">開発環境ボタン</UButton>
```
````

**完了条件**: テーマガイドが作成されている

---

### 1.3 プロジェクト構造変更 (16時間)

#### 1.3.1 ディレクトリ構造設計

**新しいディレクトリ構造のドキュメント作成**:

```
app/
├── assets/
│   └── css/
│       └── tailwind.css
├── components/
│   ├── connection/
│   ├── common/
│   ├── query-builder/
│   ├── security/
│   └── settings/
├── composables/
│   └── useTheme.ts
├── layouts/
│   ├── default.vue
│   ├── launcher.vue
│   └── query-builder.vue
├── pages/
│   ├── index.vue
│   ├── query-builder.vue
│   ├── settings.vue
│   └── connection-form.vue
├── stores/
├── utils/
├── app.vue
└── app.config.ts
```

**完了条件**: ドキュメントが作成され、レビュー承認済み

---

#### 1.3.2-1.3.10 ディレクトリ作成と移行

各ディレクトリを作成し、必要なファイルを配置します。

**完了条件**: すべてのディレクトリが作成され、`src/`から`app/`への移行が完了

---

### 1.4 サンプルコンポーネント作成 (8時間)

#### 1.4.1 ボタンコンポーネント移行サンプル

**`app/components/examples/ButtonSample.vue`の作成**:

```vue
<script setup lang="ts">
const variants = ['solid', 'outline', 'ghost', 'link'] as const
const colors = ['development', 'test', 'staging', 'production'] as const
</script>

<template>
  <div class="p-8 space-y-8">
    <h2 class="text-2xl font-bold">Nuxt UI ボタンサンプル</h2>

    <div
      v-for="color in colors"
      :key="color"
      class="space-y-4"
    >
      <h3 class="text-xl font-semibold capitalize">{{ color }}</h3>
      <div class="flex gap-4">
        <UButton
          v-for="variant in variants"
          :key="variant"
          :color="color"
          :variant="variant"
        >
          {{ variant }}
        </UButton>
      </div>
    </div>
  </div>
</template>
```

**完了条件**: ボタンが正しく表示される

---

#### 1.4.2-1.4.4 その他サンプルコンポーネント

カード、フォーム、テーマ切り替えのサンプルを作成します。

**完了条件**: すべてのサンプルコンポーネントが動作する

---

## 成果物

### ドキュメント
- [ ] `docs/theme-guide.md` - テーマ使用ガイド
- [ ] `docs/migration-phase1-report.md` - Phase 1完了レポート

### 設定ファイル
- [ ] `nuxt.config.ts` - Nuxt設定
- [ ] `tailwind.config.ts` - Tailwind設定
- [ ] `app/app.config.ts` - Nuxt UI設定
- [ ] `tsconfig.json` - TypeScript設定

### ソースコード
- [ ] `app/assets/css/tailwind.css` - グローバルCSS
- [ ] `app/app.vue` - ルートコンポーネント
- [ ] `app/components/examples/` - サンプルコンポーネント

---

## テスト観点

### 動作確認
- [ ] `npm run dev`で開発サーバーが起動する
- [ ] Nuxt UIコンポーネントが表示される
- [ ] Tailwind CSSクラスが適用される
- [ ] 環境別カラーが正しく表示される
- [ ] ダークモードが切り替え可能
- [ ] Tauri統合が動作する（HMR含む）

### ビルド確認
- [ ] `npm run build`が成功する
- [ ] `npm run tauri build`が成功する

---

## 実装チェックリスト

### 1.1 プロジェクトセットアップ
- [ ] 1.1.1 移行用ブランチ作成
- [ ] 1.1.2 Nuxt 3インストール
- [ ] 1.1.3 Nuxt UI v4インストール
- [ ] 1.1.4 Tailwind CSS設定
- [ ] 1.1.5 TypeScript設定調整
- [ ] 1.1.6 Vite→Nuxt設定移行
- [ ] 1.1.7 依存関係クリーンアップ
- [ ] 1.1.8 ビルドテスト

### 1.2 Tailwind CSSテーマ設計
- [ ] 1.2.1 環境別カラーパレット定義
- [ ] 1.2.2 Tailwindテーマ拡張設定
- [ ] 1.2.3 ダークモード設定
- [ ] 1.2.4 カスタムユーティリティ作成
- [ ] 1.2.5 グローバルCSS設定
- [ ] 1.2.6 テーマ動作確認
- [ ] 1.2.7 ドキュメント作成

### 1.3 プロジェクト構造変更
- [ ] 1.3.1 ディレクトリ構造設計
- [ ] 1.3.2-1.3.10 ディレクトリ作成と移行

### 1.4 サンプルコンポーネント作成
- [ ] 1.4.1 ボタンコンポーネント移行サンプル
- [ ] 1.4.2 カードコンポーネント移行サンプル
- [ ] 1.4.3 フォームコンポーネント移行サンプル
- [ ] 1.4.4 環境テーマ動的切り替えテスト

---

## 次のステップ

**1.5b.2 Phase 2: Nuxt 3への移行** に進みます。

- ファイルベースルーティング実装
- レイアウトシステム構築
- Pinia統合
- Tauri IPC統合確認

---

**作成日**: 2025-12-06
**作成者**: Claude Code
