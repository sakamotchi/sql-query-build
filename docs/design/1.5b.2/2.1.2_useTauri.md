# タスク1.5b.2.1.2: useTauri composable作成

**サブフェーズ**: 2.1 Composables・型定義
**工数**: 2時間
**優先度**: 高
**依存関係**: なし

---

## 目的

Tauri IPC通信を抽象化し、フロントエンドから簡単に呼び出せるようにする

---

## 実装内容

### ファイル作成: `app/composables/useTauri.ts`

```typescript
import { invoke } from '@tauri-apps/api/core'

/**
 * Tauri IPC通信Composable
 *
 * Tauriコマンドの実行を簡略化
 */
export const useTauri = () => {
  const isAvailable = ref(false)

  /**
   * Tauriが利用可能かチェック
   */
  onMounted(() => {
    if (typeof window !== 'undefined' && '__TAURI__' in window) {
      isAvailable.value = true
    }
  })

  /**
   * Tauriコマンドを実行
   *
   * @param command - コマンド名
   * @param args - 引数オブジェクト
   * @returns Promise<T> - コマンドの戻り値
   */
  const invokeCommand = async <T>(
    command: string,
    args?: Record<string, unknown>
  ): Promise<T> => {
    if (!isAvailable.value) {
      throw new Error('Tauri is not available. Running in browser mode.')
    }
    return invoke<T>(command, args)
  }

  /**
   * エラーハンドリング付きでTauriコマンドを実行
   */
  const safeInvokeCommand = async <T>(
    command: string,
    args?: Record<string, unknown>,
    fallback?: T
  ): Promise<T | undefined> => {
    try {
      return await invokeCommand<T>(command, args)
    } catch (error) {
      console.error(`Tauri command "${command}" failed:`, error)
      return fallback
    }
  }

  return {
    isAvailable,
    invokeCommand,
    safeInvokeCommand
  }
}
```

---

## 確認事項

- [ ] ファイルが作成されたか
- [ ] Tauri APIが正しくインポートされているか
- [ ] エラーハンドリングが実装されているか
- [ ] isAvailableチェックが正しく動作するか
- [ ] ジェネリック型が正しく定義されているか

---

## 成果物

- `app/composables/useTauri.ts`

---

## テスト項目

| テスト内容 | 期待結果 |
|-----------|---------|
| Tauri環境でisAvailableがtrueか | ✓ |
| ブラウザ環境でisAvailableがfalseか | ✓ |
| invokeCommandが正常に動作するか | ✓ |
| safeInvokeCommandがエラー時にfallbackを返すか | ✓ |

---

## 次のタスク

→ [2.1.3: 型定義ファイル作成](2.1.3_types.md)
