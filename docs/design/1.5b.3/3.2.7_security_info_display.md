# 3.2.7 セキュリティ情報表示強化

**フェーズ**: 1.5b Phase 3 - サブフェーズ3.2
**作成日**: 2025-12-14
**工数**: 0.5日

---

## 目的

各セキュリティプロバイダーとセキュリティレベルの詳細情報を表示し、ユーザーが適切な選択を行えるようにする。

---

## 機能要件

### 基本機能

1. **プロバイダー比較表**
   - 3つのプロバイダーの特徴・利点・欠点・推奨用途を比較表形式で表示

2. **セキュリティレベル詳細説明**
   - 各レベルの暗号化仕様、反復回数、推奨用途を表示

3. **視覚的な情報提示**
   - セキュリティレベルのビジュアル表示
   - プロバイダーごとのアイコンと色分け

---

## 実装内容

### 1. SecurityProviderComparison.vue

**ファイル**: `app/components/security/SecurityProviderComparison.vue`

```vue
<script setup lang="ts">
import type { SecurityProvider } from '~/types'

interface ProviderDetail {
  name: string
  icon: string
  color: string
  securityLevel: number
  features: {
    encryption: string
    keyManagement: string
    unlockRequired: boolean
    osIntegration: boolean
  }
  pros: string[]
  cons: string[]
  recommendedFor: string[]
}

const providers: Record<SecurityProvider, ProviderDetail> = {
  simple: {
    name: 'Simple',
    icon: 'i-heroicons-key',
    color: 'emerald',
    securityLevel: 1,
    features: {
      encryption: 'AES-256-GCM',
      keyManagement: 'アプリ固定キー + ランダムソルト',
      unlockRequired: false,
      osIntegration: false
    },
    pros: [
      'パスワード入力不要で即座に起動',
      'シンプルで使いやすい',
      'セットアップ不要'
    ],
    cons: [
      'ソースコードにアクセスできれば理論上は復号可能',
      '共有PCでは推奨されない',
      'セキュリティレベルは低い'
    ],
    recommendedFor: [
      '個人開発環境',
      'ローカル環境',
      '機密性の低いデータ',
      'UXを最優先する場合'
    ]
  },
  master_password: {
    name: 'Master Password',
    icon: 'i-heroicons-lock-closed',
    color: 'amber',
    securityLevel: 2,
    features: {
      encryption: 'AES-256-GCM + PBKDF2',
      keyManagement: 'ユーザー設定のマスターパスワードから導出',
      unlockRequired: true,
      osIntegration: false
    },
    pros: [
      'ユーザーのみが復号可能',
      '高いセキュリティレベル',
      '他のPCでも同じパスワードで復元可能'
    ],
    cons: [
      '起動時に毎回パスワード入力が必要',
      'パスワードを忘れると復元不可',
      'パスワード管理の責任がユーザーにある'
    ],
    recommendedFor: [
      'チーム共有PC',
      '機密性の高いデータ',
      '本番環境への接続情報',
      'セキュリティを重視する場合'
    ]
  },
  keychain: {
    name: 'OS Keychain',
    icon: 'i-heroicons-shield-check',
    color: 'blue',
    securityLevel: 3,
    features: {
      encryption: 'OSのセキュアストレージ',
      keyManagement: 'OS管理（Keychain/Credential Manager/Secret Service）',
      unlockRequired: false,
      osIntegration: true
    },
    pros: [
      'OSレベルのセキュリティ',
      '生体認証に対応（Touch ID/Face ID/Windows Hello）',
      'パスワード入力不要（OSが管理）'
    ],
    cons: [
      'OS認証プロンプトが表示される場合がある',
      '他のPCへの移行が困難',
      'OS固有の制限を受ける'
    ],
    recommendedFor: [
      '企業環境',
      '最高レベルのセキュリティが必要な場合',
      '生体認証を活用したい場合',
      'セキュリティポリシー準拠が必要な場合'
    ]
  }
}
</script>

<template>
  <UCard>
    <template #header>
      <h3 class="text-xl font-semibold">セキュリティプロバイダー比較</h3>
    </template>

    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead>
          <tr class="border-b border-gray-200 dark:border-gray-700">
            <th class="text-left py-3 px-4 font-semibold">項目</th>
            <th
              v-for="(provider, key) in providers"
              :key="key"
              class="text-left py-3 px-4"
            >
              <div class="flex items-center gap-2">
                <UIcon :name="provider.icon" :class="`text-${provider.color}-500`" />
                <span class="font-semibold">{{ provider.name }}</span>
              </div>
            </th>
          </tr>
        </thead>
        <tbody>
          <!-- セキュリティレベル -->
          <tr class="border-b border-gray-100 dark:border-gray-800">
            <td class="py-3 px-4 font-medium">セキュリティレベル</td>
            <td
              v-for="(provider, key) in providers"
              :key="key"
              class="py-3 px-4"
            >
              <div class="flex gap-1">
                <div
                  v-for="i in 3"
                  :key="i"
                  class="w-3 h-3 rounded-full"
                  :class="i <= provider.securityLevel ? `bg-${provider.color}-500` : 'bg-gray-200 dark:bg-gray-700'"
                />
              </div>
            </td>
          </tr>

          <!-- 暗号化方式 -->
          <tr class="border-b border-gray-100 dark:border-gray-800">
            <td class="py-3 px-4 font-medium">暗号化方式</td>
            <td
              v-for="(provider, key) in providers"
              :key="key"
              class="py-3 px-4 text-xs"
            >
              {{ provider.features.encryption }}
            </td>
          </tr>

          <!-- キー管理 -->
          <tr class="border-b border-gray-100 dark:border-gray-800">
            <td class="py-3 px-4 font-medium">キー管理</td>
            <td
              v-for="(provider, key) in providers"
              :key="key"
              class="py-3 px-4 text-xs"
            >
              {{ provider.features.keyManagement }}
            </td>
          </tr>

          <!-- アンロック必要 -->
          <tr class="border-b border-gray-100 dark:border-gray-800">
            <td class="py-3 px-4 font-medium">起動時アンロック</td>
            <td
              v-for="(provider, key) in providers"
              :key="key"
              class="py-3 px-4"
            >
              <UBadge
                :color="provider.features.unlockRequired ? 'amber' : 'emerald'"
                variant="soft"
                size="xs"
              >
                {{ provider.features.unlockRequired ? '必要' : '不要' }}
              </UBadge>
            </td>
          </tr>

          <!-- 利点 -->
          <tr class="border-b border-gray-100 dark:border-gray-800">
            <td class="py-3 px-4 font-medium align-top">利点</td>
            <td
              v-for="(provider, key) in providers"
              :key="key"
              class="py-3 px-4"
            >
              <ul class="space-y-1 text-xs">
                <li v-for="(pro, idx) in provider.pros" :key="idx" class="flex items-start gap-1">
                  <UIcon name="i-heroicons-check" class="w-3 h-3 text-emerald-500 mt-0.5 shrink-0" />
                  <span>{{ pro }}</span>
                </li>
              </ul>
            </td>
          </tr>

          <!-- 欠点 -->
          <tr class="border-b border-gray-100 dark:border-gray-800">
            <td class="py-3 px-4 font-medium align-top">欠点</td>
            <td
              v-for="(provider, key) in providers"
              :key="key"
              class="py-3 px-4"
            >
              <ul class="space-y-1 text-xs">
                <li v-for="(con, idx) in provider.cons" :key="idx" class="flex items-start gap-1">
                  <UIcon name="i-heroicons-x-mark" class="w-3 h-3 text-rose-500 mt-0.5 shrink-0" />
                  <span>{{ con }}</span>
                </li>
              </ul>
            </td>
          </tr>

          <!-- 推奨用途 -->
          <tr>
            <td class="py-3 px-4 font-medium align-top">推奨用途</td>
            <td
              v-for="(provider, key) in providers"
              :key="key"
              class="py-3 px-4"
            >
              <ul class="space-y-1 text-xs">
                <li v-for="(use, idx) in provider.recommendedFor" :key="idx" class="flex items-start gap-1">
                  <UIcon name="i-heroicons-light-bulb" class="w-3 h-3 text-amber-500 mt-0.5 shrink-0" />
                  <span>{{ use }}</span>
                </li>
              </ul>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </UCard>
</template>
```

---

### 2. SecurityLevelDetails.vue

**ファイル**: `app/components/security/SecurityLevelDetails.vue`

```vue
<script setup lang="ts">
import type { SecurityLevel } from '~/types'

interface LevelDetail {
  name: string
  color: string
  encryption: {
    algorithm: string
    keySize: number
    iterations: number
  }
  features: string[]
  recommendedFor: string[]
}

const levels: Record<SecurityLevel, LevelDetail> = {
  low: {
    name: '低',
    color: 'emerald',
    encryption: {
      algorithm: 'AES-256-GCM',
      keySize: 256,
      iterations: 100000
    },
    features: [
      '基本的な暗号化',
      '高速な処理',
      '低リソース消費'
    ],
    recommendedFor: [
      '開発環境',
      'テスト環境',
      '機密性の低いデータ'
    ]
  },
  medium: {
    name: '中',
    color: 'amber',
    encryption: {
      algorithm: 'AES-256-GCM',
      keySize: 256,
      iterations: 600000
    },
    features: [
      '推奨レベルの暗号化',
      'セキュリティとパフォーマンスのバランス',
      'OWASP推奨の反復回数'
    ],
    recommendedFor: [
      'ステージング環境',
      '一般的な用途',
      'デフォルト設定として推奨'
    ]
  },
  high: {
    name: '高',
    color: 'rose',
    encryption: {
      algorithm: 'AES-256-GCM',
      keySize: 256,
      iterations: 1000000
    },
    features: [
      '最高レベルの暗号化',
      '最も厳格なセキュリティ',
      'ブルートフォース攻撃への最大の耐性'
    ],
    recommendedFor: [
      '本番環境',
      '機密性の高いデータ',
      'セキュリティポリシー準拠が必要な場合'
    ]
  }
}
</script>

<template>
  <UCard>
    <template #header>
      <h3 class="text-xl font-semibold">セキュリティレベル詳細</h3>
    </template>

    <div class="space-y-4">
      <div
        v-for="(level, key) in levels"
        :key="key"
        class="border rounded-lg p-4"
        :class="`border-${level.color}-200 dark:border-${level.color}-800`"
      >
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-3">
            <div class="flex gap-1">
              <div
                v-for="i in 3"
                :key="i"
                class="w-3 h-3 rounded-full"
                :class="i <= (key === 'low' ? 1 : key === 'medium' ? 2 : 3) ? `bg-${level.color}-500` : 'bg-gray-200 dark:bg-gray-700'"
              />
            </div>
            <h4 class="text-lg font-semibold">{{ level.name }}</h4>
            <UBadge v-if="key === 'medium'" color="primary" variant="soft" size="xs">
              推奨
            </UBadge>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- 暗号化仕様 -->
          <div>
            <p class="text-sm font-medium text-gray-700 dark:text-gray-200 mb-2">
              暗号化仕様
            </p>
            <ul class="space-y-1 text-xs text-gray-600 dark:text-gray-400">
              <li class="flex items-center gap-2">
                <UIcon name="i-heroicons-lock-closed" class="w-3 h-3" />
                アルゴリズム: {{ level.encryption.algorithm }}
              </li>
              <li class="flex items-center gap-2">
                <UIcon name="i-heroicons-key" class="w-3 h-3" />
                キーサイズ: {{ level.encryption.keySize }}bit
              </li>
              <li class="flex items-center gap-2">
                <UIcon name="i-heroicons-arrow-path" class="w-3 h-3" />
                反復回数: {{ level.encryption.iterations.toLocaleString() }}回
              </li>
            </ul>
          </div>

          <!-- 特徴 -->
          <div>
            <p class="text-sm font-medium text-gray-700 dark:text-gray-200 mb-2">
              特徴
            </p>
            <ul class="space-y-1 text-xs text-gray-600 dark:text-gray-400">
              <li v-for="(feature, idx) in level.features" :key="idx" class="flex items-start gap-2">
                <UIcon name="i-heroicons-check" class="w-3 h-3 text-emerald-500 mt-0.5 shrink-0" />
                <span>{{ feature }}</span>
              </li>
            </ul>
          </div>
        </div>

        <!-- 推奨用途 -->
        <div class="mt-3 pt-3 border-t" :class="`border-${level.color}-100 dark:border-${level.color}-900`">
          <p class="text-sm font-medium text-gray-700 dark:text-gray-200 mb-2">
            推奨用途
          </p>
          <ul class="space-y-1 text-xs text-gray-600 dark:text-gray-400">
            <li v-for="(use, idx) in level.recommendedFor" :key="idx" class="flex items-start gap-2">
              <UIcon name="i-heroicons-light-bulb" class="w-3 h-3 text-amber-500 mt-0.5 shrink-0" />
              <span>{{ use }}</span>
            </li>
          </ul>
        </div>
      </div>

      <UAlert color="blue" variant="soft" icon="i-heroicons-information-circle">
        <template #title>パフォーマンスへの影響</template>
        <p class="text-sm mt-1">
          セキュリティレベルが高いほど、暗号化・復号化に時間がかかります。
          起動時やプロバイダー変更時に若干の遅延が発生する場合があります。
        </p>
      </UAlert>
    </div>
  </UCard>
</template>
```

---

### 3. SecuritySettings.vueへの統合

**ファイル**: `app/components/settings/SecuritySettings.vue`

```vue
<script setup lang="ts">
// ... 既存のコード ...

const showComparison = ref(false)
const showLevelDetails = ref(false)
</script>

<template>
  <div class="space-y-6">
    <!-- 既存のセキュリティ設定カード -->
    <UCard>
      <!-- ... 既存のコード ... -->
    </UCard>

    <!-- プロバイダー比較表（展開可能） -->
    <UCard>
      <template #header>
        <button
          type="button"
          class="w-full flex items-center justify-between"
          @click="showComparison = !showComparison"
        >
          <h3 class="text-xl font-semibold">プロバイダー比較</h3>
          <UIcon
            :name="showComparison ? 'i-heroicons-chevron-up' : 'i-heroicons-chevron-down'"
            class="w-5 h-5"
          />
        </button>
      </template>

      <div v-if="showComparison">
        <SecurityProviderComparison />
      </div>
    </UCard>

    <!-- セキュリティレベル詳細（展開可能） -->
    <UCard>
      <template #header>
        <button
          type="button"
          class="w-full flex items-center justify-between"
          @click="showLevelDetails = !showLevelDetails"
        >
          <h3 class="text-xl font-semibold">セキュリティレベル詳細</h3>
          <UIcon
            :name="showLevelDetails ? 'i-heroicons-chevron-up' : 'i-heroicons-chevron-down'"
            class="w-5 h-5"
          />
        </button>
      </template>

      <div v-if="showLevelDetails">
        <SecurityLevelDetails />
      </div>
    </UCard>

    <!-- 既存のマスターパスワードカード -->
    <UCard v-if="settings.provider === 'master_password'">
      <!-- ... 既存のコード ... -->
    </UCard>

    <!-- 既存のダイアログ -->
    <MasterPasswordSetupDialog v-model="showMasterPasswordDialog" :mode="masterPasswordMode" />
  </div>
</template>
```

---

## 成果物

- [ ] `app/components/security/SecurityProviderComparison.vue`
- [ ] `app/components/security/SecurityLevelDetails.vue`
- [ ] `app/components/settings/SecuritySettings.vue` - 統合

---

## 動作確認項目

- [ ] プロバイダー比較表が展開・折りたたみできる
- [ ] 3つのプロバイダーの情報が正しく表示される
- [ ] セキュリティレベル詳細が展開・折りたたみできる
- [ ] 3つのレベルの情報が正しく表示される
- [ ] 視覚的なレベル表示（ドット）が正しく表示される
- [ ] レスポンシブデザインが適用されている

---

## UI/UX考慮事項

### 情報の階層化

- デフォルトは折りたたみ表示（詳細情報は必要に応じて展開）
- 初心者には推奨設定を明示
- 上級者には詳細な技術仕様を提供

### 視覚的なフィードバック

- セキュリティレベルをドットで視覚化
- プロバイダーごとに色分け
- 推奨設定にバッジ表示

### アクセシビリティ

- 色だけでなくアイコンでも情報を表現
- キーボード操作に対応

---

## 今後の拡張

### Phase 2以降で検討

- プロバイダーごとの詳細ドキュメントへのリンク
- セキュリティレベルの変更時の影響シミュレーション
- ベンチマーク結果の表示（暗号化・復号化の速度）
- 推奨設定の自動選択（環境に応じて）

---

## 備考

- 比較表は展開可能にすることで、初期表示をシンプルに保つ
- 詳細情報は上級者向けに提供
- 推奨設定を明示することで、初心者の意思決定を支援

---

## 依存関係

**前提条件**:
- ✅ `SecuritySettings.vue` 実装済み
- ✅ Nuxt UIコンポーネント利用可能

**次のステップ**:
- Phase 2: セッションタイムアウト設定
- Phase 2: データエクスポート/インポート
