# 1.5b.3 Nuxt UI移行 Phase 3: UIコンポーネント移行

## 概要

| 項目 | 内容 |
|------|------|
| タスクID | 1.5b.3 |
| タスク名 | Nuxt UI移行Phase 3: UIコンポーネント移行 |
| 担当 | FE |
| 工数 | 168時間 (3-4週間) |
| 依存関係 | 1.5b.2 (Phase 2: Nuxt 3導入) |
| 完了条件 | 全42コンポーネント移行完了 |

## 目的

VuetifyコンポーネントをNuxt UI v4コンポーネントに移行する。

この段階で以下を達成する:
- 全42個の.vueファイルの移行
- VuetifyコンポーネントからNuxt UIコンポーネントへの置き換え
- MDIアイコンからIconifyアイコンへの移行
- 環境別テーマの完全実装

---

## コンポーネント移行マッピング

### Vuetify → Nuxt UI コンポーネント対応表

| Vuetify | Nuxt UI | 備考 |
|---------|---------|------|
| `v-btn` | `<UButton>` | 直接置換 |
| `v-card` | `<UCard>` | スロット構造が異なる |
| `v-text-field` | `<UInput>` | Props名が一部異なる |
| `v-select` | `<USelect>` | 直接置換 |
| `v-checkbox` | `<UCheckbox>` | 直接置換 |
| `v-radio-group` | `<URadioGroup>` | 直接置換 |
| `v-switch` | `<UToggle>` | コンポーネント名が異なる |
| `v-dialog` | `<UModal>` | スロット構造が異なる |
| `v-menu` | `<UDropdown>` | 直接置換 |
| `v-alert` | `<UAlert>` | 直接置換 |
| `v-snackbar` | `useToast()` | API方式に変更 |
| `v-table` | `<UTable>` | Props構造が異なる |
| `v-tabs` | `<UTabs>` | 構造が異なる |
| `v-icon` | `<UIcon>` | アイコン名の変更が必要 |
| `v-progress-circular` | `<div class="animate-spin">` + アイコン | カスタム実装 |
| `v-progress-linear` | `<UProgress>` | 直接置換 |

### アイコン移行マッピング

| 用途 | MDI | Iconify (Heroicons) |
|------|-----|---------------------|
| データベース | `mdi-database` | `i-heroicons-circle-stack` |
| 設定 | `mdi-cog` | `i-heroicons-cog-6-tooth` |
| 保存 | `mdi-content-save` | `i-heroicons-arrow-down-tray` |
| 削除 | `mdi-delete` | `i-heroicons-trash` |
| 編集 | `mdi-pencil` | `i-heroicons-pencil` |
| 検索 | `mdi-magnify` | `i-heroicons-magnifying-glass` |
| チェック | `mdi-check` | `i-heroicons-check` |
| 閉じる | `mdi-close` | `i-heroicons-x-mark` |
| 警告 | `mdi-alert` | `i-heroicons-exclamation-triangle` |
| 情報 | `mdi-information` | `i-heroicons-information-circle` |

---

## Week 1: 共通コンポーネント・プラグイン (40時間)

### 3.1.1 環境関連コンポーネント (16時間)

#### 3.1.1.1 環境ヘッダーコンポーネント

**`app/components/common/EnvironmentHeader.vue`**:

```vue
<script setup lang="ts">
interface Props {
  environment: 'development' | 'test' | 'staging' | 'production'
  connectionName: string
}

const props = defineProps<Props>()

const environmentConfig = {
  development: {
    label: '開発環境',
    icon: 'i-heroicons-code-bracket',
    bgClass: 'bg-development-50',
    textClass: 'text-development-900',
    borderClass: 'border-development-500'
  },
  test: {
    label: 'テスト環境',
    icon: 'i-heroicons-beaker',
    bgClass: 'bg-test-50',
    textClass: 'text-test-900',
    borderClass: 'border-test-500'
  },
  staging: {
    label: 'ステージング環境',
    icon: 'i-heroicons-adjustments-horizontal',
    bgClass: 'bg-staging-50',
    textClass: 'text-staging-900',
    borderClass: 'border-staging-500'
  },
  production: {
    label: '本番環境',
    icon: 'i-heroicons-exclamation-triangle',
    bgClass: 'bg-production-50',
    textClass: 'text-production-900',
    borderClass: 'border-production-500 border-4'
  }
}

const config = computed(() => environmentConfig[props.environment])
</script>

<template>
  <header
    :class="[config.bgClass, config.borderClass, 'border-b']"
  >
    <UContainer>
      <div class="flex items-center justify-between py-3">
        <div class="flex items-center gap-3">
          <UIcon :name="config.icon" :class="[config.textClass, 'text-2xl']" />
          <div>
            <div :class="[config.textClass, 'text-sm font-semibold opacity-75']">
              {{ config.label }}
            </div>
            <div :class="[config.textClass, 'text-lg font-bold']">
              {{ connectionName }}
            </div>
          </div>
        </div>

        <!-- 本番環境警告 -->
        <UAlert
          v-if="environment === 'production'"
          color="red"
          icon="i-heroicons-exclamation-triangle"
          title="本番環境"
          description="操作には十分注意してください"
        />
      </div>
    </UContainer>
  </header>
</template>
```

**移行前（Vuetify）**:
```vue
<v-app-bar :color="environmentColor">
  <v-icon>mdi-database</v-icon>
  <v-app-bar-title>{{ connectionName }}</v-app-bar-title>
</v-app-bar>
```

**完了条件**: 環境ヘッダーが正しく表示される

---

#### 3.1.1.2 環境バッジコンポーネント

**`app/components/common/EnvironmentBadge.vue`**:

```vue
<script setup lang="ts">
interface Props {
  environment: 'development' | 'test' | 'staging' | 'production'
  size?: 'sm' | 'md' | 'lg'
}

const props = withDefaults(defineProps<Props>(), {
  size: 'md'
})

const colorMap = {
  development: 'green',
  test: 'blue',
  staging: 'orange',
  production: 'red'
}

const labelMap = {
  development: '開発',
  test: 'テスト',
  staging: 'ステージング',
  production: '本番'
}
</script>

<template>
  <UBadge
    :color="colorMap[environment]"
    :size="size"
    variant="solid"
  >
    {{ labelMap[environment] }}
  </UBadge>
</template>
```

**移行前（Vuetify）**:
```vue
<v-chip :color="environmentColor" small>
  {{ environmentLabel }}
</v-chip>
```

**完了条件**: 環境バッジが正しく表示される

---

#### 3.1.1.3-3.1.1.6 その他環境関連コンポーネント

同様の方法で以下を移行:
- `EnvironmentIndicator.vue`
- `EnvironmentWarningBanner.vue`
- `WindowEnvironmentProvider.vue` → Composable化

---

### 3.1.2 共通UIコンポーネント (16時間)

#### 3.1.2.1 Composables整理

**`app/composables/useTheme.ts`**:

```typescript
export const useTheme = () => {
  const colorMode = useColorMode()

  const setEnvironmentTheme = (environment: string) => {
    // Nuxt UIのapp.config.tsで定義したカラーを使用
    return environment
  }

  const isDark = computed(() => colorMode.value === 'dark')

  const toggleDark = () => {
    colorMode.preference = isDark.value ? 'light' : 'dark'
  }

  return {
    setEnvironmentTheme,
    isDark,
    toggleDark
  }
}
```

---

#### 3.1.2.2 アイコンユーティリティ

**`app/utils/icons.ts`**:

```typescript
// MDI → Iconify マッピング
export const iconMap: Record<string, string> = {
  'mdi-database': 'i-heroicons-circle-stack',
  'mdi-cog': 'i-heroicons-cog-6-tooth',
  'mdi-content-save': 'i-heroicons-arrow-down-tray',
  'mdi-delete': 'i-heroicons-trash',
  'mdi-pencil': 'i-heroicons-pencil',
  'mdi-magnify': 'i-heroicons-magnifying-glass',
  'mdi-check': 'i-heroicons-check',
  'mdi-close': 'i-heroicons-x-mark',
  'mdi-alert': 'i-heroicons-exclamation-triangle',
  'mdi-information': 'i-heroicons-information-circle',
  'mdi-plus': 'i-heroicons-plus',
  'mdi-minus': 'i-heroicons-minus',
  'mdi-menu': 'i-heroicons-bars-3',
  'mdi-dots-vertical': 'i-heroicons-ellipsis-vertical',
  'mdi-chevron-down': 'i-heroicons-chevron-down',
  'mdi-chevron-up': 'i-heroicons-chevron-up',
  'mdi-chevron-left': 'i-heroicons-chevron-left',
  'mdi-chevron-right': 'i-heroicons-chevron-right'
}

export const mapIcon = (mdiIcon: string): string => {
  return iconMap[mdiIcon] || mdiIcon
}
```

---

#### 3.1.2.3 通知システム

**`app/composables/useNotification.ts`**:

```typescript
export const useNotification = () => {
  const toast = useToast()

  const showSuccess = (title: string, description?: string) => {
    toast.add({
      title,
      description,
      color: 'green',
      icon: 'i-heroicons-check-circle'
    })
  }

  const showError = (title: string, description?: string) => {
    toast.add({
      title,
      description,
      color: 'red',
      icon: 'i-heroicons-x-circle'
    })
  }

  const showInfo = (title: string, description?: string) => {
    toast.add({
      title,
      description,
      color: 'blue',
      icon: 'i-heroicons-information-circle'
    })
  }

  const showWarning = (title: string, description?: string) => {
    toast.add({
      title,
      description,
      color: 'orange',
      icon: 'i-heroicons-exclamation-triangle'
    })
  }

  return {
    showSuccess,
    showError,
    showInfo,
    showWarning
  }
}
```

**移行前（Vuetify）**:
```vue
<v-snackbar v-model="snackbar">
  {{ message }}
</v-snackbar>
```

**移行後（Nuxt UI）**:
```typescript
const { showSuccess } = useNotification()
showSuccess('保存しました')
```

---

#### 3.1.2.4-3.1.2.6 その他共通コンポーネント

ローディング表示、エラー表示などを実装。

---

### 3.1.3 プラグイン・設定 (8時間)

#### 3.1.3.1 Vuetifyプラグイン削除

```bash
rm -rf app/plugins/vuetify.ts
```

---

#### 3.1.3.2 Nuxt UIプラグイン設定

**`app/app.config.ts`の最終調整**:

```typescript
export default defineAppConfig({
  ui: {
    primary: 'green',
    gray: 'neutral',

    // 環境別カラー
    colors: {
      development: { /* ... */ },
      test: { /* ... */ },
      staging: { /* ... */ },
      production: { /* ... */ }
    },

    // グローバルコンポーネント設定
    button: {
      default: {
        size: 'md',
        color: 'primary',
        variant: 'solid'
      }
    },

    card: {
      default: {
        rounded: 'lg',
        shadow: 'md'
      }
    }
  }
})
```

---

## Week 2: ページコンポーネント (40時間)

### 3.2.1 ランチャーページ (16時間)

#### 3.2.1.1 ランチャーページ本体

**`app/pages/index.vue`** (Phase 2で作成済み、Nuxt UIコンポーネントに更新)

---

#### 3.2.1.2 ランチャーAppBar

**`app/components/connection/LauncherAppBar.vue`**:

```vue
<script setup lang="ts">
const emit = defineEmits<{
  newConnection: []
  openSettings: []
}>()
</script>

<template>
  <header class="bg-primary-500 text-white shadow-lg">
    <UContainer>
      <div class="flex items-center justify-between py-4">
        <div class="flex items-center gap-3">
          <UIcon name="i-heroicons-circle-stack" class="text-3xl" />
          <h1 class="text-2xl font-bold">SQLエディタ ランチャー</h1>
        </div>

        <div class="flex gap-3">
          <UButton
            icon="i-heroicons-plus-circle"
            color="white"
            variant="solid"
            @click="emit('newConnection')"
          >
            新規接続
          </UButton>

          <UButton
            icon="i-heroicons-cog-6-tooth"
            color="white"
            variant="ghost"
            @click="emit('openSettings')"
          />
        </div>
      </div>
    </UContainer>
  </header>
</template>
```

**移行前（Vuetify）**:
```vue
<v-app-bar color="primary" dark>
  <v-app-bar-nav-icon>
    <v-icon>mdi-database</v-icon>
  </v-app-bar-nav-icon>
  <v-app-bar-title>SQLエディタ ランチャー</v-app-bar-title>
  <v-btn @click="$emit('new-connection')">新規接続</v-btn>
</v-app-bar>
```

---

#### 3.2.1.3 ランチャーツールバー

**`app/components/connection/LauncherToolbar.vue`**:

```vue
<script setup lang="ts">
interface Props {
  search: string
  filter: string
  sort: string
}

interface Emits {
  (e: 'update:search', value: string): void
  (e: 'update:filter', value: string): void
  (e: 'update:sort', value: string): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()

const environmentFilterOptions = [
  { label: 'すべて', value: 'all' },
  { label: '開発環境', value: 'development' },
  { label: 'テスト環境', value: 'test' },
  { label: 'ステージング環境', value: 'staging' },
  { label: '本番環境', value: 'production' }
]

const sortOptions = [
  { label: '接続名順', value: 'name' },
  { label: '最終使用日時順', value: 'lastUsed' },
  { label: '環境順', value: 'environment' }
]
</script>

<template>
  <div class="flex items-center gap-4 mb-6">
    <UInput
      :model-value="search"
      @update:model-value="emit('update:search', $event)"
      icon="i-heroicons-magnifying-glass"
      placeholder="接続名で検索"
      class="flex-1 max-w-md"
    />

    <USelect
      :model-value="filter"
      @update:model-value="emit('update:filter', $event)"
      :options="environmentFilterOptions"
      placeholder="環境フィルター"
      class="w-48"
    />

    <USelect
      :model-value="sort"
      @update:model-value="emit('update:sort', $event)"
      :options="sortOptions"
      placeholder="並び順"
      class="w-48"
    />
  </div>
</template>
```

**移行前（Vuetify）**:
```vue
<v-toolbar flat>
  <v-text-field
    v-model="search"
    prepend-inner-icon="mdi-magnify"
    label="検索"
  />
  <v-select v-model="filter" :items="filters" />
  <v-select v-model="sort" :items="sorts" />
</v-toolbar>
```

---

#### 3.2.1.4 接続カード

**`app/components/connection/ConnectionCard.vue`**:

```vue
<script setup lang="ts">
interface Props {
  connection: Connection
}

interface Emits {
  (e: 'select'): void
  (e: 'edit'): void
  (e: 'delete'): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()

const environmentColor = computed(() => {
  const colorMap = {
    development: 'green',
    test: 'blue',
    staging: 'orange',
    production: 'red'
  }
  return colorMap[props.connection.environment]
})
</script>

<template>
  <UCard
    class="cursor-pointer hover:shadow-lg transition-shadow"
    @click="emit('select')"
  >
    <template #header>
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
          <UIcon name="i-heroicons-circle-stack" class="text-xl" />
          <h3 class="font-semibold">{{ connection.name }}</h3>
        </div>

        <EnvironmentBadge :environment="connection.environment" size="sm" />
      </div>
    </template>

    <div class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
      <div class="flex items-center gap-2">
        <UIcon name="i-heroicons-server" class="text-base" />
        <span>{{ connection.host }}:{{ connection.port }}</span>
      </div>

      <div class="flex items-center gap-2">
        <UIcon name="i-heroicons-circle-stack" class="text-base" />
        <span>{{ connection.database }}</span>
      </div>

      <div class="flex items-center gap-2">
        <UIcon name="i-heroicons-user" class="text-base" />
        <span>{{ connection.username }}</span>
      </div>
    </div>

    <template #footer>
      <div class="flex justify-between items-center">
        <div class="text-xs text-gray-500">
          最終使用: {{ formatDate(connection.lastUsedAt) }}
        </div>

        <div class="flex gap-2">
          <UButton
            icon="i-heroicons-pencil"
            size="sm"
            variant="ghost"
            @click.stop="emit('edit')"
          />
          <UButton
            icon="i-heroicons-trash"
            size="sm"
            color="red"
            variant="ghost"
            @click.stop="emit('delete')"
          />
        </div>
      </div>
    </template>
  </UCard>
</template>
```

**移行前（Vuetify）**:
```vue
<v-card @click="$emit('select')">
  <v-card-title>{{ connection.name }}</v-card-title>
  <v-card-text>
    <v-chip :color="environmentColor">{{ environmentLabel }}</v-chip>
    <div>{{ connection.host }}:{{ connection.port }}</div>
  </v-card-text>
  <v-card-actions>
    <v-btn icon @click.stop="$emit('edit')">
      <v-icon>mdi-pencil</v-icon>
    </v-btn>
    <v-btn icon @click.stop="$emit('delete')">
      <v-icon>mdi-delete</v-icon>
    </v-btn>
  </v-card-actions>
</v-card>
```

---

#### 3.2.1.5 接続リスト

**`app/components/connection/ConnectionList.vue`**:

```vue
<script setup lang="ts">
interface Props {
  connections: Connection[]
  loading: boolean
}

interface Emits {
  (e: 'select-connection', connection: Connection): void
  (e: 'edit-connection', connection: Connection): void
  (e: 'delete-connection', connection: Connection): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()
</script>

<template>
  <div>
    <!-- ローディング -->
    <div v-if="loading" class="flex justify-center py-12">
      <UIcon name="i-heroicons-arrow-path" class="animate-spin text-4xl text-primary-500" />
    </div>

    <!-- 空状態 -->
    <UCard v-else-if="connections.length === 0" class="text-center py-12">
      <UIcon name="i-heroicons-circle-stack-slash" class="text-6xl text-gray-400 mb-4" />
      <div class="text-xl font-semibold text-gray-600 mb-2">
        登録された接続がありません
      </div>
      <div class="text-gray-500 mb-6">
        「新規接続」ボタンから接続を追加してください
      </div>
    </UCard>

    <!-- 接続カードグリッド -->
    <div v-else class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
      <ConnectionCard
        v-for="connection in connections"
        :key="connection.id"
        :connection="connection"
        @select="emit('select-connection', connection)"
        @edit="emit('edit-connection', connection)"
        @delete="emit('delete-connection', connection)"
      />
    </div>
  </div>
</template>
```

**移行前（Vuetify）**:
```vue
<v-row>
  <v-col
    v-for="connection in connections"
    :key="connection.id"
    cols="12" sm="6" md="4" lg="3"
  >
    <ConnectionCard :connection="connection" />
  </v-col>
</v-row>
```

---

### 3.2.2 接続フォームページ (12時間)

#### 3.2.2.1-3.2.2.5 接続フォーム関連コンポーネント

同様の方法で以下を移行:
- `ConnectionForm.vue`
- `EnvironmentSelector.vue`
- `EnvironmentColorPicker.vue`
- `EnvironmentColorPreview.vue`
- `ThemePreview.vue`

---

### 3.2.3 設定ページ (12時間)

#### 3.2.3.1-3.2.3.6 設定関連コンポーネント

同様の方法で以下を移行:
- `SettingsPage.vue`
- `GeneralSettings.vue`
- `AboutSection.vue`
- `WindowRestoreSettings.vue`

---

## Week 3: クエリビルダー・セキュリティ (40時間)

### 3.3.1 クエリビルダーページ (24時間)

#### 主要コンポーネント

同様の方法で以下を移行:
- `QueryBuilderPage.vue`
- `QueryBuilderLayout.vue`
- `QueryBuilderToolbar.vue`
- `LeftPanel.vue`
- `CenterPanel.vue`
- `RightPanel.vue`
- `ResizablePanel.vue`
- `TableRelationArea.vue`
- `ConditionTabs.vue`
- `SqlPreview.vue`
- `QueryInfo.vue`
- `ResultPanel.vue`

---

### 3.3.2 セキュリティコンポーネント (16時間)

#### 主要コンポーネント

同様の方法で以下を移行:
- `SecuritySettings.vue`
- `SecurityProviderCard.vue`
- `SecurityLevelIndicator.vue`
- `ProviderChangeDialog.vue`
- `MasterPasswordSetupDialog.vue`
- `UnlockDialog.vue`

---

## Week 4: ダイアログ・テスト・修正 (40時間)

### 3.4.1 残りのコンポーネント (16時間)

同様の方法で以下を移行:
- `TableRelationArea.vue`
- `ResultPanel.vue`
- `RestoreWindowsDialog.vue`
- `ActiveFilters.vue`
- `PasswordStrengthMeter.vue`

---

### 3.4.2 統合テスト (8時間)

**テストスクリプトの作成**:

```bash
# 全ページ動作確認
npm run test:e2e -- --grep "page navigation"

# 環境テーマ切り替えテスト
npm run test:e2e -- --grep "theme switching"

# Tauri IPC動作確認
npm run test:e2e -- --grep "tauri ipc"

# マルチウィンドウテスト
npm run test:e2e -- --grep "multi window"
```

---

### 3.4.3 バグ修正・調整 (16時間)

- スタイル調整
- レスポンシブ対応確認
- アクセシビリティ確認
- パフォーマンス最適化

---

## 成果物

### 移行完了コンポーネント (42ファイル)

#### 環境関連 (5)
- [ ] `EnvironmentHeader.vue`
- [ ] `EnvironmentBadge.vue`
- [ ] `EnvironmentIndicator.vue`
- [ ] `EnvironmentWarningBanner.vue`
- [ ] `WindowEnvironmentProvider.vue` → Composable

#### 接続関連 (8)
- [ ] `LauncherAppBar.vue`
- [ ] `LauncherToolbar.vue`
- [ ] `ConnectionCard.vue`
- [ ] `ConnectionList.vue`
- [ ] `ConnectionForm.vue`
- [ ] `EnvironmentSelector.vue`
- [ ] `EnvironmentColorPicker.vue`
- [ ] `ThemePreview.vue`

#### クエリビルダー (13)
- [ ] `QueryBuilderLayout.vue`
- [ ] `QueryBuilderToolbar.vue`
- [ ] `LeftPanel.vue`
- [ ] `CenterPanel.vue`
- [ ] `RightPanel.vue`
- [ ] `ResizablePanel.vue`
- [ ] `TableRelationArea.vue`
- [ ] `ConditionTabs.vue`
- [ ] `SqlPreview.vue`
- [ ] `QueryInfo.vue`
- [ ] `ResultPanel.vue`
- [ ] その他

#### セキュリティ (6)
- [ ] `SecuritySettings.vue`
- [ ] `SecurityProviderCard.vue`
- [ ] `SecurityLevelIndicator.vue`
- [ ] `ProviderChangeDialog.vue`
- [ ] `MasterPasswordSetupDialog.vue`
- [ ] `UnlockDialog.vue`

#### 設定 (6)
- [ ] `SettingsPage.vue`
- [ ] `GeneralSettings.vue`
- [ ] `AboutSection.vue`
- [ ] `WindowRestoreSettings.vue`
- [ ] その他

#### ダイアログ・その他 (4)
- [ ] `RestoreWindowsDialog.vue`
- [ ] `ActiveFilters.vue`
- [ ] `PasswordStrengthMeter.vue`
- [ ] その他

---

## 実装チェックリスト

### Week 1: 共通コンポーネント
- [ ] 3.1.1 環境関連コンポーネント
- [ ] 3.1.2 共通UIコンポーネント
- [ ] 3.1.3 プラグイン・設定

### Week 2: ページコンポーネント
- [ ] 3.2.1 ランチャーページ
- [ ] 3.2.2 接続フォームページ
- [ ] 3.2.3 設定ページ

### Week 3: クエリビルダー・セキュリティ
- [ ] 3.3.1 クエリビルダーページ
- [ ] 3.3.2 セキュリティコンポーネント

### Week 4: ダイアログ・テスト
- [ ] 3.4.1 残りのコンポーネント
- [ ] 3.4.2 統合テスト
- [ ] 3.4.3 バグ修正・調整

---

## 次のステップ

**1.5b.4 Phase 4: 最終テスト・リリース** に進みます。

- E2Eテスト実装・実行
- パフォーマンステスト
- バグ修正
- リリース準備

---

**作成日**: 2025-12-06
**作成者**: Claude Code
