# タスク1.4.1: Vuetifyテーマ定義作成 設計書

## 概要

**タスクID**: 1.4.1
**タスク名**: Vuetifyテーマ定義作成
**工数**: 1日
**依存関係**: 1.1.2 (Vuetify 3.x セットアップ)
**完了条件**: 4環境のテーマが定義される

---

## 目的

データベース接続の環境（開発・テスト・ステージング・本番）を視覚的に区別するため、Vuetify 3.xのテーマシステムを使用して4つの環境別テーマを定義する。

---

## Vuetifyテーマシステム概要

### Vuetify 3.xのテーマ機能

- カスタマイズ可能なカラーパレット
- 動的なテーマ切り替え
- ライトモード/ダークモード対応
- CSS変数による実装

---

## 環境別テーマ定義

### 1. テーマカラーパレット

| 環境 | テーマ名 | Primary色 | Secondary色 | Background色 | Surface色 | 用途・意図 |
|------|---------|-----------|-------------|--------------|-----------|-----------|
| 開発環境 | `development` | `#4CAF50` (緑) | `#66BB6A` | `#F1F8E9` | `#FFFFFF` | 安全な作業環境を示す緑色 |
| テスト環境 | `test` | `#2196F3` (青) | `#42A5F5` | `#E3F2FD` | `#FFFFFF` | 検証環境を示す青色 |
| ステージング環境 | `staging` | `#FF9800` (オレンジ) | `#FFA726` | `#FFF3E0` | `#FFFFFF` | 注意が必要な環境を示すオレンジ色 |
| 本番環境 | `production` | `#F44336` (赤) | `#EF5350` | `#FFEBEE` | `#FFFFFF` | 危険を示す赤色 |

### 2. 共通カラー定義

全環境で共通して使用するカラー:

| カラー名 | カラーコード | 用途 |
|---------|-------------|------|
| `error` | `#F44336` | エラーメッセージ |
| `warning` | `#FF9800` | 警告メッセージ |
| `info` | `#2196F3` | 情報メッセージ |
| `success` | `#4CAF50` | 成功メッセージ |
| `on-surface` | `#000000` | テキストカラー (ライトモード) |
| `on-surface-variant` | `#424242` | 補助テキストカラー |
| `outline` | `#00000042` | 境界線 |

---

## 実装設計

### ファイル構成

```
src/plugins/
└── vuetify.ts        # Vuetifyプラグイン設定
```

### vuetify.ts

**ファイル**: `src/plugins/vuetify.ts`

```typescript
import { createVuetify, ThemeDefinition } from 'vuetify';
import * as components from 'vuetify/components';
import * as directives from 'vuetify/directives';
import 'vuetify/styles';
import '@mdi/font/css/materialdesignicons.css';

// 環境別テーマ定義
const developmentTheme: ThemeDefinition = {
  dark: false,
  colors: {
    primary: '#4CAF50',      // 緑
    secondary: '#66BB6A',    // ライトグリーン
    background: '#F1F8E9',   // 非常に薄い緑
    surface: '#FFFFFF',      // 白
    error: '#F44336',        // 赤
    info: '#2196F3',         // 青
    success: '#4CAF50',      // 緑
    warning: '#FF9800',      // オレンジ
    'on-primary': '#FFFFFF', // プライマリー上のテキスト
    'on-secondary': '#FFFFFF',
    'on-background': '#000000',
    'on-surface': '#000000',
    'on-error': '#FFFFFF',
  },
};

const testTheme: ThemeDefinition = {
  dark: false,
  colors: {
    primary: '#2196F3',      // 青
    secondary: '#42A5F5',    // ライトブルー
    background: '#E3F2FD',   // 非常に薄い青
    surface: '#FFFFFF',      // 白
    error: '#F44336',        // 赤
    info: '#2196F3',         // 青
    success: '#4CAF50',      // 緑
    warning: '#FF9800',      // オレンジ
    'on-primary': '#FFFFFF',
    'on-secondary': '#FFFFFF',
    'on-background': '#000000',
    'on-surface': '#000000',
    'on-error': '#FFFFFF',
  },
};

const stagingTheme: ThemeDefinition = {
  dark: false,
  colors: {
    primary: '#FF9800',      // オレンジ
    secondary: '#FFA726',    // ライトオレンジ
    background: '#FFF3E0',   // 非常に薄いオレンジ
    surface: '#FFFFFF',      // 白
    error: '#F44336',        // 赤
    info: '#2196F3',         // 青
    success: '#4CAF50',      // 緑
    warning: '#FF9800',      // オレンジ
    'on-primary': '#FFFFFF',
    'on-secondary': '#000000',
    'on-background': '#000000',
    'on-surface': '#000000',
    'on-error': '#FFFFFF',
  },
};

const productionTheme: ThemeDefinition = {
  dark: false,
  colors: {
    primary: '#F44336',      // 赤
    secondary: '#EF5350',    // ライトレッド
    background: '#FFEBEE',   // 非常に薄い赤
    surface: '#FFFFFF',      // 白
    error: '#F44336',        // 赤
    info: '#2196F3',         // 青
    success: '#4CAF50',      // 緑
    warning: '#FF9800',      // オレンジ
    'on-primary': '#FFFFFF',
    'on-secondary': '#FFFFFF',
    'on-background': '#000000',
    'on-surface': '#000000',
    'on-error': '#FFFFFF',
  },
};

// Vuetifyインスタンスを作成
export default createVuetify({
  components,
  directives,
  theme: {
    defaultTheme: 'development',
    themes: {
      development: developmentTheme,
      test: testTheme,
      staging: stagingTheme,
      production: productionTheme,
    },
  },
  defaults: {
    VBtn: {
      variant: 'elevated',
    },
    VCard: {
      elevation: 2,
    },
  },
  icons: {
    defaultSet: 'mdi',
  },
});
```

---

## 型定義

### ThemeType

**ファイル**: `src/types/theme.ts`

```typescript
/**
 * 環境テーマタイプ
 */
export type ThemeType = 'development' | 'test' | 'staging' | 'production';

/**
 * テーマカラー情報
 */
export interface ThemeColorInfo {
  name: ThemeType;
  label: string;
  primary: string;
  secondary: string;
  background: string;
  description: string;
}

/**
 * テーマカラー一覧
 */
export const THEME_COLORS: Record<ThemeType, ThemeColorInfo> = {
  development: {
    name: 'development',
    label: '開発環境',
    primary: '#4CAF50',
    secondary: '#66BB6A',
    background: '#F1F8E9',
    description: '安全な作業環境を示す緑色',
  },
  test: {
    name: 'test',
    label: 'テスト環境',
    primary: '#2196F3',
    secondary: '#42A5F5',
    background: '#E3F2FD',
    description: '検証環境を示す青色',
  },
  staging: {
    name: 'staging',
    label: 'ステージング環境',
    primary: '#FF9800',
    secondary: '#FFA726',
    background: '#FFF3E0',
    description: '注意が必要な環境を示すオレンジ色',
  },
  production: {
    name: 'production',
    label: '本番環境',
    primary: '#F44336',
    secondary: '#EF5350',
    background: '#FFEBEE',
    description: '危険を示す赤色',
  },
};
```

---

## ダークモード対応 (将来拡張)

### ダークテーマ定義

本タスクでは実装しないが、将来的にダークモードを実装する場合の定義例:

```typescript
const developmentDarkTheme: ThemeDefinition = {
  dark: true,
  colors: {
    primary: '#66BB6A',      // ライトグリーン
    secondary: '#81C784',
    background: '#1B5E20',   // ダークグリーン
    surface: '#2E7D32',      // グリーン
    error: '#F44336',
    info: '#2196F3',
    success: '#4CAF50',
    warning: '#FF9800',
    'on-primary': '#000000',
    'on-secondary': '#000000',
    'on-background': '#FFFFFF',
    'on-surface': '#FFFFFF',
    'on-error': '#FFFFFF',
  },
};
```

---

## Nuxt.jsへの組み込み

### nuxt.config.ts

**ファイル**: `nuxt.config.ts`

```typescript
export default defineNuxtConfig({
  modules: ['vuetify-nuxt-module'],

  vuetify: {
    moduleOptions: {
      /* Vuetifyモジュールのオプション */
    },
    vuetifyOptions: './plugins/vuetify.ts',
  },

  css: [
    'vuetify/styles',
    '@mdi/font/css/materialdesignicons.css',
  ],
});
```

### プラグインの登録

**ファイル**: `plugins/vuetify.client.ts` (すでに存在する場合は上書き)

```typescript
import vuetify from '@/plugins/vuetify';

export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.vueApp.use(vuetify);
});
```

---

## テーマのCSS変数

### 生成されるCSS変数

Vuetifyは自動的に以下のCSS変数を生成します:

```css
/* 開発環境テーマの例 */
:root {
  --v-theme-primary: 76, 175, 80;           /* RGB値 */
  --v-theme-secondary: 102, 187, 106;
  --v-theme-background: 241, 248, 233;
  --v-theme-surface: 255, 255, 255;
  --v-theme-error: 244, 67, 54;
  --v-theme-info: 33, 150, 243;
  --v-theme-success: 76, 175, 80;
  --v-theme-warning: 255, 152, 0;

  /* カラーオーバーレイ */
  --v-theme-on-primary: 255, 255, 255;
  --v-theme-on-secondary: 255, 255, 255;
  --v-theme-on-background: 0, 0, 0;
  --v-theme-on-surface: 0, 0, 0;
}
```

### カスタムCSSでの使用例

```scss
.custom-component {
  // CSS変数を直接使用
  background-color: rgb(var(--v-theme-primary));
  color: rgb(var(--v-theme-on-primary));

  // Vuetifyのヘルパー関数を使用 (推奨)
  background-color: rgba(var(--v-theme-primary), 0.8);
}
```

---

## アクセシビリティ考慮事項

### コントラスト比

WCAG 2.1 AA基準（4.5:1以上）を満たすカラーパレット:

| 環境 | Primary / On-Primary | Background / On-Background | 判定 |
|------|---------------------|---------------------------|------|
| 開発環境 | `#4CAF50` / `#FFFFFF` | `#F1F8E9` / `#000000` | ✅ 合格 |
| テスト環境 | `#2196F3` / `#FFFFFF` | `#E3F2FD` / `#000000` | ✅ 合格 |
| ステージング | `#FF9800` / `#FFFFFF` | `#FFF3E0` / `#000000` | ✅ 合格 |
| 本番環境 | `#F44336` / `#FFFFFF` | `#FFEBEE` / `#000000` | ✅ 合格 |

### カラーユニバーサルデザイン

色覚多様性に配慮した配色:
- 赤・緑だけに依存せず、背景色でも識別可能
- アイコンやラベルで補助的に環境を表示
- コントラストを十分に確保

---

## テスト観点

### ビジュアルテスト

- [ ] 4つの環境テーマが正しく定義されていること
- [ ] 各テーマの色が仕様通りであること
- [ ] ライトモードで正しく表示されること
- [ ] テーマ間の違いが明確に識別できること

### アクセシビリティテスト

- [ ] コントラスト比がWCAG 2.1 AA基準を満たすこと
- [ ] 色覚シミュレーターで検証済みであること

### ブラウザ互換性テスト

- [ ] Chrome, Firefox, Safari, Edgeで正しく表示されること
- [ ] CSS変数が正しく適用されること

---

## 実装チェックリスト

- [ ] `src/plugins/vuetify.ts` の作成・更新
- [ ] `src/types/theme.ts` の作成
- [ ] 4つの環境テーマ定義の実装
- [ ] Nuxt.jsへの組み込み
- [ ] Material Design Iconsのインストール
- [ ] テーマカラーのアクセシビリティ検証
- [ ] ビジュアルテストの実施

---

## パフォーマンス考慮事項

### CSS変数の利用

- ランタイムでのテーマ切り替えが高速
- JavaScriptによる再計算が不要
- CSSのみで反映

### Tree Shaking

```typescript
// 必要なコンポーネントのみインポート
import { VBtn, VCard, VAppBar } from 'vuetify/components';

// 全コンポーネントのインポートは避ける (バンドルサイズ増加)
// import * from 'vuetify/components'; // ❌
```

---

## 参考資料

- [Vuetify 3 Theme Configuration](https://vuetifyjs.com/en/features/theme/)
- [Material Design Color System](https://m3.material.io/styles/color/overview)
- [WCAG 2.1 Contrast Guidelines](https://www.w3.org/WAI/WCAG21/Understanding/contrast-minimum.html)
- [カラーユニバーサルデザイン推奨配色セット](https://jfly.uni-koeln.de/color/)

---

## 備考

### 本番環境の強調表示

本番環境テーマは、タスク1.4.4で実装する環境識別ヘッダーと組み合わせて、より強力な警告表示を行う予定。

### カスタムテーマの追加

将来的にユーザー定義のカスタムテーマを追加できるよう、拡張可能な設計とする。
