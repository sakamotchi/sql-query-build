# タスク1.6.1: クエリビルダー画面レイアウト作成 設計書

## 概要

**タスクID**: 1.6.1
**タスク名**: クエリビルダー画面レイアウト作成
**工数**: 2日
**依存関係**: 1.4.4 (環境識別ヘッダーコンポーネント)
**完了条件**: 3カラムレイアウト表示
**UIフレームワーク**: Nuxt UI v4（Tailwind CSS 4ベース）

---

## 目的

クエリビルダーのメイン画面として、3カラムレイアウトを実装する。左パネルにはDB構造ツリー、中央パネルにはテーブル関係図と条件設定タブ、右パネルにはSQLプレビューを配置し、ユーザーが直感的にSQLクエリを構築できるインターフェースを提供する。

Nuxt UI v4のコンポーネントとTailwind CSS 4を活用し、モダンで一貫性のあるUIを実現する。

---

## 画面レイアウト設計

### 全体構成

```
┌─────────────────────────────────────────────────────────────────┐
│ 環境識別ヘッダー（環境色・接続名・警告バナー）                    │
├─────────────────────────────────────────────────────────────────┤
│ ツールバー（実行・保存・新規作成・履歴・設定）                    │
├────────────┬──────────────────────────────┬─────────────────────┤
│ 左パネル   │        中央パネル            │      右パネル       │
│ (250px)    │       (フレキシブル)          │      (350px)        │
│            │                              │                     │
│ DB構造     │ ┌────────────────────────┐  │ SQLプレビュー       │
│ ツリー     │ │  テーブル関係図(上部)   │  │                     │
│            │ │                        │  │ ┌─────────────────┐ │
│ - スキーマ │ │  [テーブルA] [テーブルB]│  │ │ SELECT          │ │
│   - テーブル│ │       ↓ JOIN ↓        │  │ │   column1,      │ │
│     - カラム│ │                        │  │ │   column2       │ │
│            │ └────────────────────────┘  │ │ FROM table      │ │
│            │                              │ │ WHERE ...       │ │
│            │ ┌────────────────────────┐  │ └─────────────────┘ │
│            │ │  条件設定タブ(下部)     │  │                     │
│            │ │                        │  │ クエリ情報         │
│            │ │ [SELECT][WHERE][GROUP] │  │ - 行数: 0          │
│            │ │ [ORDER BY][LIMIT]      │  │ - 実行時間: -      │
│            │ │                        │  │                     │
│            │ └────────────────────────┘  │                     │
├────────────┴──────────────────────────────┴─────────────────────┤
│ 実行結果表示エリア（テーブル形式・高さ可変）                      │
└─────────────────────────────────────────────────────────────────┘
```

### パネルサイズ

| パネル | 初期幅 | 最小幅 | 最大幅 | リサイズ可能 |
|--------|--------|--------|--------|--------------|
| 左パネル | 250px | 200px | 400px | ○ |
| 中央パネル | フレキシブル | 400px | - | - |
| 右パネル | 350px | 280px | 500px | ○ |
| 結果エリア | 200px (高さ) | 100px | 50% | ○ |

---

## コンポーネント設計

### ファイル構成

```
src/
├── pages/
│   └── query-builder.vue           # クエリビルダーページ
├── components/
│   └── query-builder/
│       ├── QueryBuilderLayout.vue  # レイアウトコンテナ
│       ├── QueryBuilderToolbar.vue # ツールバー
│       ├── LeftPanel.vue           # 左パネル（DB構造）
│       ├── CenterPanel.vue         # 中央パネル
│       │   ├── TableRelationArea.vue    # テーブル関係図エリア
│       │   └── ConditionTabs.vue        # 条件設定タブ
│       ├── RightPanel.vue          # 右パネル（SQLプレビュー）
│       │   ├── SqlPreview.vue           # SQLプレビュー
│       │   └── QueryInfo.vue            # クエリ情報
│       ├── ResultPanel.vue         # 結果表示エリア
│       └── ResizablePanel.vue      # リサイズ可能パネル
└── stores/
    └── query-builder.ts            # クエリビルダー状態管理
```

---

### QueryBuilderLayout.vue

**責務**: 3カラムレイアウトのコンテナとリサイズ機能

```vue
<script setup lang="ts">
import { ref, computed, onMounted, onUnmounted } from 'vue';
import { useQueryBuilderStore } from '@/stores/query-builder';
import QueryBuilderToolbar from './QueryBuilderToolbar.vue';
import LeftPanel from './LeftPanel.vue';
import CenterPanel from './CenterPanel.vue';
import RightPanel from './RightPanel.vue';
import ResultPanel from './ResultPanel.vue';
import ResizablePanel from './ResizablePanel.vue';

const queryBuilderStore = useQueryBuilderStore();

// パネルサイズ
const leftPanelWidth = ref(250);
const rightPanelWidth = ref(350);
const resultPanelHeight = ref(200);
const isResultPanelVisible = ref(false);

// パネル表示状態
const isLeftPanelCollapsed = ref(false);
const isRightPanelCollapsed = ref(false);

// パネルサイズ制約
const panelConstraints = {
  left: { min: 200, max: 400 },
  right: { min: 280, max: 500 },
  result: { min: 100, maxRatio: 0.5 },
};

/**
 * 左パネルのリサイズ
 */
const handleLeftPanelResize = (width: number) => {
  leftPanelWidth.value = Math.max(
    panelConstraints.left.min,
    Math.min(panelConstraints.left.max, width)
  );
};

/**
 * 右パネルのリサイズ
 */
const handleRightPanelResize = (width: number) => {
  rightPanelWidth.value = Math.max(
    panelConstraints.right.min,
    Math.min(panelConstraints.right.max, width)
  );
};

/**
 * 結果パネルのリサイズ
 */
const handleResultPanelResize = (height: number) => {
  const maxHeight = window.innerHeight * panelConstraints.result.maxRatio;
  resultPanelHeight.value = Math.max(
    panelConstraints.result.min,
    Math.min(maxHeight, height)
  );
};

/**
 * 左パネルの折りたたみ切り替え
 */
const toggleLeftPanel = () => {
  isLeftPanelCollapsed.value = !isLeftPanelCollapsed.value;
};

/**
 * 右パネルの折りたたみ切り替え
 */
const toggleRightPanel = () => {
  isRightPanelCollapsed.value = !isRightPanelCollapsed.value;
};

/**
 * 結果パネルの表示切り替え
 */
const toggleResultPanel = () => {
  isResultPanelVisible.value = !isResultPanelVisible.value;
};

/**
 * クエリ実行後に結果パネルを表示
 */
const showResultPanel = () => {
  isResultPanelVisible.value = true;
};

// コンポーネント公開
defineExpose({
  showResultPanel,
  toggleResultPanel,
});
</script>

<template>
  <div class="query-builder-layout">
    <!-- ツールバー -->
    <QueryBuilderToolbar
      class="query-builder-toolbar"
      @toggle-left-panel="toggleLeftPanel"
      @toggle-right-panel="toggleRightPanel"
      @toggle-result-panel="toggleResultPanel"
    />

    <!-- メインコンテンツエリア -->
    <div class="query-builder-content">
      <!-- 左パネル -->
      <ResizablePanel
        v-if="!isLeftPanelCollapsed"
        direction="right"
        :initial-size="leftPanelWidth"
        :min-size="panelConstraints.left.min"
        :max-size="panelConstraints.left.max"
        class="left-panel-container"
        @resize="handleLeftPanelResize"
      >
        <LeftPanel />
      </ResizablePanel>

      <!-- 左パネル折りたたみ時のボタン -->
      <div
        v-else
        class="panel-collapsed left-collapsed"
        @click="toggleLeftPanel"
      >
        <UIcon name="i-heroicons-chevron-right" />
      </div>

      <!-- 中央パネル -->
      <div class="center-panel-container">
        <CenterPanel />
      </div>

      <!-- 右パネル折りたたみ時のボタン -->
      <div
        v-if="isRightPanelCollapsed"
        class="panel-collapsed right-collapsed"
        @click="toggleRightPanel"
      >
        <UIcon name="i-heroicons-chevron-left" />
      </div>

      <!-- 右パネル -->
      <ResizablePanel
        v-else
        direction="left"
        :initial-size="rightPanelWidth"
        :min-size="panelConstraints.right.min"
        :max-size="panelConstraints.right.max"
        class="right-panel-container"
        @resize="handleRightPanelResize"
      >
        <RightPanel />
      </ResizablePanel>
    </div>

    <!-- 結果パネル -->
    <ResizablePanel
      v-if="isResultPanelVisible"
      direction="top"
      :initial-size="resultPanelHeight"
      :min-size="panelConstraints.result.min"
      class="result-panel-container"
      @resize="handleResultPanelResize"
    >
      <ResultPanel @close="toggleResultPanel" />
    </ResizablePanel>
  </div>
</template>

<style scoped>
.query-builder-layout {
  @apply flex flex-col h-full overflow-hidden;
}

.query-builder-toolbar {
  @apply flex-shrink-0;
}

.query-builder-content {
  @apply flex flex-1 overflow-hidden;
}

.left-panel-container {
  @apply flex-shrink-0 border-r border-gray-200 dark:border-gray-800;
}

.center-panel-container {
  @apply flex-1 overflow-hidden min-w-[400px];
}

.right-panel-container {
  @apply flex-shrink-0 border-l border-gray-200 dark:border-gray-800;
}

.result-panel-container {
  @apply flex-shrink-0 border-t border-gray-200 dark:border-gray-800;
}

.panel-collapsed {
  @apply flex items-center justify-center w-6 bg-white dark:bg-gray-900 cursor-pointer transition-colors duration-200;
}

.panel-collapsed:hover {
  @apply bg-gray-100 dark:bg-gray-800;
}

.left-collapsed {
  @apply border-r border-gray-200 dark:border-gray-800;
}

.right-collapsed {
  @apply border-l border-gray-200 dark:border-gray-800;
}
</style>
```

---

### QueryBuilderToolbar.vue

**責務**: クエリビルダーのツールバー（実行・保存・新規作成など）

```vue
<script setup lang="ts">
import { computed } from 'vue';
import { useQueryBuilderStore } from '@/stores/query-builder';

const emit = defineEmits<{
  (e: 'toggle-left-panel'): void;
  (e: 'toggle-right-panel'): void;
  (e: 'toggle-result-panel'): void;
}>();

const queryBuilderStore = useQueryBuilderStore();

// 実行可能かどうか
const canExecute = computed(() => queryBuilderStore.canExecuteQuery);

// 実行中かどうか
const isExecuting = computed(() => queryBuilderStore.isExecuting);

/**
 * クエリ実行
 */
const executeQuery = () => {
  queryBuilderStore.executeQuery();
};

/**
 * クエリ保存
 */
const saveQuery = () => {
  // TODO: クエリ保存ダイアログを開く
};

/**
 * 新規クエリ作成
 */
const createNewQuery = () => {
  queryBuilderStore.resetQuery();
};

/**
 * クエリ履歴を開く
 */
const openHistory = () => {
  // TODO: クエリ履歴パネルを開く
};
</script>

<template>
  <nav class="flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800">
    <!-- 左パネル切り替え -->
    <UButton
      icon="i-heroicons-circle-stack"
      size="sm"
      color="gray"
      variant="ghost"
      title="DB構造パネル"
      @click="emit('toggle-left-panel')"
    />

    <UDivider orientation="vertical" class="h-6" />

    <!-- メインアクション -->
    <UButton
      color="primary"
      size="sm"
      :disabled="!canExecute || isExecuting"
      :loading="isExecuting"
      @click="executeQuery"
    >
      <template #leading>
        <UIcon name="i-heroicons-play" />
      </template>
      実行
    </UButton>

    <UButton
      variant="ghost"
      color="gray"
      size="sm"
      @click="saveQuery"
    >
      <template #leading>
        <UIcon name="i-heroicons-document-arrow-down" />
      </template>
      保存
    </UButton>

    <UButton
      variant="ghost"
      color="gray"
      size="sm"
      @click="createNewQuery"
    >
      <template #leading>
        <UIcon name="i-heroicons-document-plus" />
      </template>
      新規
    </UButton>

    <UDivider orientation="vertical" class="h-6" />

    <!-- 履歴 -->
    <UButton
      icon="i-heroicons-clock"
      size="sm"
      color="gray"
      variant="ghost"
      title="クエリ履歴"
      @click="openHistory"
    />

    <div class="flex-1" />

    <!-- 表示切り替え -->
    <UButton
      icon="i-heroicons-table-cells"
      size="sm"
      color="gray"
      variant="ghost"
      title="結果パネル"
      @click="emit('toggle-result-panel')"
    />

    <UButton
      icon="i-heroicons-code-bracket"
      size="sm"
      color="gray"
      variant="ghost"
      title="SQLプレビューパネル"
      @click="emit('toggle-right-panel')"
    />
  </nav>
</template>
```

---

### ResizablePanel.vue

**責務**: リサイズ可能なパネルコンポーネント

```vue
<script setup lang="ts">
import { ref, computed, onMounted, onUnmounted } from 'vue';

const props = withDefaults(
  defineProps<{
    /** リサイズ方向 (left, right, top, bottom) */
    direction: 'left' | 'right' | 'top' | 'bottom';
    /** 初期サイズ */
    initialSize: number;
    /** 最小サイズ */
    minSize?: number;
    /** 最大サイズ */
    maxSize?: number;
  }>(),
  {
    minSize: 100,
    maxSize: undefined,
  }
);

const emit = defineEmits<{
  (e: 'resize', size: number): void;
}>();

const panelRef = ref<HTMLElement | null>(null);
const size = ref(props.initialSize);
const isResizing = ref(false);

const isHorizontal = computed(() =>
  props.direction === 'left' || props.direction === 'right'
);

const panelStyle = computed(() => ({
  [isHorizontal.value ? 'width' : 'height']: `${size.value}px`,
}));

const resizerClass = computed(() => `resizer resizer-${props.direction}`);

/**
 * リサイズ開始
 */
const startResize = (e: MouseEvent) => {
  e.preventDefault();
  isResizing.value = true;
  document.addEventListener('mousemove', handleResize);
  document.addEventListener('mouseup', stopResize);
  document.body.style.cursor = isHorizontal.value ? 'col-resize' : 'row-resize';
  document.body.style.userSelect = 'none';
};

/**
 * リサイズ処理
 */
const handleResize = (e: MouseEvent) => {
  if (!isResizing.value || !panelRef.value) return;

  const rect = panelRef.value.getBoundingClientRect();
  let newSize: number;

  switch (props.direction) {
    case 'right':
      newSize = e.clientX - rect.left;
      break;
    case 'left':
      newSize = rect.right - e.clientX;
      break;
    case 'bottom':
      newSize = e.clientY - rect.top;
      break;
    case 'top':
      newSize = rect.bottom - e.clientY;
      break;
  }

  // サイズ制約を適用
  newSize = Math.max(props.minSize, newSize);
  if (props.maxSize) {
    newSize = Math.min(props.maxSize, newSize);
  }

  size.value = newSize;
  emit('resize', newSize);
};

/**
 * リサイズ終了
 */
const stopResize = () => {
  isResizing.value = false;
  document.removeEventListener('mousemove', handleResize);
  document.removeEventListener('mouseup', stopResize);
  document.body.style.cursor = '';
  document.body.style.userSelect = '';
};

onUnmounted(() => {
  if (isResizing.value) {
    stopResize();
  }
});
</script>

<template>
  <div
    ref="panelRef"
    class="resizable-panel"
    :class="{ 'is-resizing': isResizing }"
    :style="panelStyle"
  >
    <div class="panel-content">
      <slot />
    </div>
    <div
      :class="resizerClass"
      @mousedown="startResize"
    />
  </div>
</template>

<style scoped>
.resizable-panel {
  @apply relative flex overflow-hidden;
}

.panel-content {
  @apply flex-1 overflow-auto;
}

.resizer {
  @apply absolute bg-transparent z-10 transition-colors duration-200;
}

.resizer:hover,
.is-resizing .resizer {
  @apply bg-primary-500;
}

.resizer-right {
  @apply top-0 right-0 w-1 h-full cursor-col-resize;
}

.resizer-left {
  @apply top-0 left-0 w-1 h-full cursor-col-resize;
}

.resizer-top {
  @apply top-0 left-0 w-full h-1 cursor-row-resize;
}

.resizer-bottom {
  @apply bottom-0 left-0 w-full h-1 cursor-row-resize;
}
</style>
```

---

### CenterPanel.vue

**責務**: 中央パネル（テーブル関係図と条件設定タブ）

```vue
<script setup lang="ts">
import { ref } from 'vue';
import TableRelationArea from './TableRelationArea.vue';
import ConditionTabs from './ConditionTabs.vue';

// 上下パネルの分割比率
const splitRatio = ref(50); // 50%
const isDragging = ref(false);

/**
 * 分割ドラッグ開始
 */
const startDrag = (e: MouseEvent) => {
  e.preventDefault();
  isDragging.value = true;
  document.addEventListener('mousemove', handleDrag);
  document.addEventListener('mouseup', stopDrag);
};

/**
 * 分割ドラッグ処理
 */
const handleDrag = (e: MouseEvent) => {
  if (!isDragging.value) return;

  const container = document.querySelector('.center-panel');
  if (!container) return;

  const rect = container.getBoundingClientRect();
  const ratio = ((e.clientY - rect.top) / rect.height) * 100;
  splitRatio.value = Math.max(20, Math.min(80, ratio));
};

/**
 * 分割ドラッグ終了
 */
const stopDrag = () => {
  isDragging.value = false;
  document.removeEventListener('mousemove', handleDrag);
  document.removeEventListener('mouseup', stopDrag);
};
</script>

<template>
  <div class="center-panel">
    <!-- 上部: テーブル関係図 -->
    <div
      class="table-relation-area"
      :style="{ height: `${splitRatio}%` }"
    >
      <TableRelationArea />
    </div>

    <!-- 分割ハンドル -->
    <div
      class="split-handle"
      :class="{ 'is-dragging': isDragging }"
      @mousedown="startDrag"
    >
      <div class="handle-indicator" />
    </div>

    <!-- 下部: 条件設定タブ -->
    <div
      class="condition-tabs-area"
      :style="{ height: `${100 - splitRatio}%` }"
    >
      <ConditionTabs />
    </div>
  </div>
</template>

<style scoped>
.center-panel {
  @apply flex flex-col h-full overflow-hidden;
}

.table-relation-area {
  @apply overflow-hidden min-h-[100px];
}

.condition-tabs-area {
  @apply overflow-hidden min-h-[100px];
}

.split-handle {
  @apply h-2 bg-white dark:bg-gray-900 cursor-row-resize flex items-center justify-center flex-shrink-0;
  @apply border-t border-b border-gray-200 dark:border-gray-800;
}

.split-handle:hover,
.split-handle.is-dragging {
  @apply bg-primary-50 dark:bg-primary-900/20;
}

.handle-indicator {
  @apply w-8 h-1 bg-gray-300 dark:bg-gray-600 rounded;
}

.split-handle:hover .handle-indicator,
.split-handle.is-dragging .handle-indicator {
  @apply bg-primary-500;
}
</style>
```

---

### LeftPanel.vue

**責務**: 左パネル（DB構造ツリー）のコンテナ

```vue
<script setup lang="ts">
import { ref } from 'vue';

// 検索クエリ
const searchQuery = ref('');

// ツリーのフィルタリング（実装はタスク1.6.3で詳細化）
const handleSearch = (query: string) => {
  searchQuery.value = query;
};
</script>

<template>
  <div class="flex flex-col h-full bg-white dark:bg-gray-900">
    <!-- ヘッダー -->
    <div class="flex items-center justify-between px-3 py-2 border-b border-gray-200 dark:border-gray-800">
      <span class="text-sm font-medium">データベース構造</span>
      <UButton
        icon="i-heroicons-arrow-path"
        size="xs"
        color="gray"
        variant="ghost"
        title="更新"
      />
    </div>

    <!-- 検索ボックス -->
    <div class="p-2 border-b border-gray-200 dark:border-gray-800">
      <UInput
        v-model="searchQuery"
        size="sm"
        placeholder="テーブル・カラムを検索..."
        icon="i-heroicons-magnifying-glass"
        @update:model-value="handleSearch"
      />
    </div>

    <!-- DB構造ツリー（タスク1.6.3で実装） -->
    <div class="flex-1 overflow-auto p-2">
      <slot name="tree">
        <!-- DatabaseTree コンポーネントをここに配置 -->
        <div class="flex flex-col items-center justify-center h-full gap-2">
          <UIcon name="i-heroicons-circle-stack" class="text-4xl text-gray-400" />
          <p class="text-gray-500 dark:text-gray-400">DB構造ツリー</p>
          <p class="text-xs text-gray-400 dark:text-gray-500">(タスク1.6.3で実装)</p>
        </div>
      </slot>
    </div>
  </div>
</template>
```

---

### RightPanel.vue

**責務**: 右パネル（SQLプレビューとクエリ情報）

```vue
<script setup lang="ts">
import { computed } from 'vue';
import { useQueryBuilderStore } from '@/stores/query-builder';
import SqlPreview from './SqlPreview.vue';
import QueryInfo from './QueryInfo.vue';

const queryBuilderStore = useQueryBuilderStore();

const generatedSql = computed(() => queryBuilderStore.generatedSql);
const queryInfo = computed(() => queryBuilderStore.queryInfo);
</script>

<template>
  <div class="flex flex-col h-full bg-white dark:bg-gray-900">
    <!-- SQLプレビュー -->
    <div class="flex flex-col flex-1 min-h-[200px] overflow-hidden">
      <div class="flex items-center justify-between px-3 py-2 border-b border-gray-200 dark:border-gray-800">
        <span class="text-sm font-medium">SQLプレビュー</span>
        <UButton
          icon="i-heroicons-clipboard-document"
          size="xs"
          color="gray"
          variant="ghost"
          title="コピー"
        />
      </div>
      <SqlPreview :sql="generatedSql" />
    </div>

    <!-- クエリ情報 -->
    <div class="flex-shrink-0 border-t border-gray-200 dark:border-gray-800">
      <div class="flex items-center justify-between px-3 py-2 border-b border-gray-200 dark:border-gray-800">
        <span class="text-sm font-medium">クエリ情報</span>
      </div>
      <QueryInfo :info="queryInfo" />
    </div>
  </div>
</template>
```

---

## 状態管理設計

### query-builder.ts (ストアの基本構造)

```typescript
import { defineStore } from 'pinia';
import type { QueryModel, QueryInfo } from '@/types/query';

interface QueryBuilderState {
  /** 現在のクエリモデル */
  query: QueryModel | null;
  /** 生成されたSQL */
  generatedSql: string;
  /** クエリ情報 */
  queryInfo: QueryInfo;
  /** 実行中フラグ */
  isExecuting: boolean;
  /** エラーメッセージ */
  error: string | null;
}

export const useQueryBuilderStore = defineStore('query-builder', {
  state: (): QueryBuilderState => ({
    query: null,
    generatedSql: '',
    queryInfo: {
      rowCount: 0,
      executionTime: null,
      lastExecutedAt: null,
    },
    isExecuting: false,
    error: null,
  }),

  getters: {
    /**
     * クエリ実行可能かどうか
     */
    canExecuteQuery(state): boolean {
      return !!state.query && state.query.tables.length > 0;
    },
  },

  actions: {
    /**
     * クエリをリセット
     */
    resetQuery() {
      this.query = {
        tables: [],
        joins: [],
        columns: [],
        where: [],
        groupBy: [],
        having: [],
        orderBy: [],
        limit: null,
        offset: null,
      };
      this.generatedSql = '';
      this.error = null;
    },

    /**
     * クエリを実行
     */
    async executeQuery() {
      if (!this.canExecuteQuery) return;

      this.isExecuting = true;
      this.error = null;

      try {
        // TODO: タスク1.7.4で実装
      } catch (error) {
        this.error = error instanceof Error ? error.message : 'Unknown error';
      } finally {
        this.isExecuting = false;
      }
    },
  },
});
```

---

## レスポンシブ対応

### ブレークポイント

| 画面サイズ | 対応 |
|-----------|------|
| < 768px | 非対応（デスクトップアプリのため） |
| 768px - 1024px | 左右パネルを折りたたみ可能に |
| 1024px - 1440px | 標準レイアウト |
| > 1440px | パネルサイズを広げて表示 |

### 最小ウィンドウサイズ

```json
{
  "minWidth": 1024,
  "minHeight": 600
}
```

---

## キーボードショートカット

| ショートカット | アクション |
|---------------|-----------|
| `Ctrl/Cmd + Enter` | クエリ実行 |
| `Ctrl/Cmd + S` | クエリ保存 |
| `Ctrl/Cmd + N` | 新規クエリ |
| `Ctrl/Cmd + B` | 左パネル切り替え |
| `Ctrl/Cmd + J` | 右パネル切り替え |
| `Escape` | 実行キャンセル |

---

## テスト設計

### ユニットテスト

```typescript
describe('QueryBuilderLayout', () => {
  it('should render three column layout', () => {
    // 3カラムレイアウトが正しく表示されること
  });

  it('should resize left panel within constraints', () => {
    // 左パネルが制約内でリサイズできること
  });

  it('should collapse and expand panels', () => {
    // パネルの折りたたみ・展開が動作すること
  });
});

describe('ResizablePanel', () => {
  it('should resize on drag', () => {
    // ドラッグでリサイズできること
  });

  it('should respect min/max constraints', () => {
    // 最小・最大サイズが守られること
  });
});
```

### E2Eテストシナリオ

```
シナリオ1: レイアウト表示確認
1. クエリビルダーを開く
2. 3カラムレイアウトが表示されることを確認
3. 各パネルが正しい位置に配置されていることを確認

シナリオ2: パネルリサイズ
1. 左パネルの境界をドラッグ
2. パネル幅が変更されることを確認
3. 最小・最大サイズで停止することを確認

シナリオ3: パネル折りたたみ
1. 左パネル切り替えボタンをクリック
2. 左パネルが折りたたまれることを確認
3. 再度クリックして展開されることを確認
```

---

## 実装チェックリスト

- [ ] `src/pages/query-builder.vue` の作成
- [ ] `src/components/query-builder/QueryBuilderLayout.vue` の作成
- [ ] `src/components/query-builder/QueryBuilderToolbar.vue` の作成
- [ ] `src/components/query-builder/ResizablePanel.vue` の作成
- [ ] `src/components/query-builder/LeftPanel.vue` の作成
- [ ] `src/components/query-builder/CenterPanel.vue` の作成
- [ ] `src/components/query-builder/RightPanel.vue` の作成
- [ ] `src/components/query-builder/ResultPanel.vue` の作成
- [ ] `src/stores/query-builder.ts` の作成（基本構造）
- [ ] パネルリサイズ機能の実装
- [ ] パネル折りたたみ機能の実装
- [ ] キーボードショートカットの実装
- [ ] レスポンシブ対応
- [ ] ユニットテストの作成
- [ ] E2Eテストの作成

---

## 参考資料

- [Nuxt UI v4 Documentation](https://ui.nuxt.com/)
- [Nuxt UI Components](https://ui.nuxt.com/components)
- [Tailwind CSS v4](https://tailwindcss.com/)
- [CSS Flexbox](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_flexible_box_layout)
- [Resize Observer API](https://developer.mozilla.org/en-US/docs/Web/API/Resize_Observer_API)
