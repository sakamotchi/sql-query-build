# タスク1.6.8: ORDER BY設定UI実装 設計書

## 概要

**タスクID**: 1.6.8
**タスク名**: ORDER BY設定UI実装
**工数**: 1日
**依存関係**: 1.6.5 (カラム選択UI実装)
**完了条件**: ソート順の追加・変更・削除・並べ替えが可能
**UIフレームワーク**: Nuxt UI v4（Tailwind CSS 4ベース）

---

## 目的

SELECT文のORDER BY句を構築するUIを実装する。複数のカラムに対して、昇順(ASC)または降順(DESC)を指定し、適用の優先順位を並べ替えできるインターフェースを提供する。

---

## UI設計

### ORDER BYタブ

```
┌─────────────────────────────────────────────────────────────┐
│ [SELECT] [WHERE] [GROUP BY] [ORDER BY] [LIMIT]              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ORDER BY条件                                 [+ カラム追加] │
│  ─────────────────────────────────────────────────────────  │
│                                                              │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  ::  u.created_at          [ 昇順 (ASC) ▼ ]  [×]    │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                              │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  ::  u.name                [ 降順 (DESC) ▼ ] [×]    │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                              │
│  （ドラッグ＆ドロップで優先順位を並べ替え可能）               │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## コンポーネント設計

### ファイル構成

```
src/components/query-builder/
├── order-by/
│   ├── OrderByTab.vue            # ORDER BYタブ
│   └── OrderByRow.vue            # ソート順設定行
└── ConditionTabs.vue             # タブコンテナ（更新）
```

---

### order-by/OrderByTab.vue

```vue
<script setup lang="ts">
import { computed } from 'vue'
import { useQueryBuilderStore } from '@/stores/query-builder'
import OrderByRow from './OrderByRow.vue'
import draggable from 'vuedraggable' 

const queryBuilderStore = useQueryBuilderStore()

const isEmpty = computed(() => queryBuilderStore.selectedTables.length === 0)

const orderByColumns = computed({
  get: () => queryBuilderStore.orderByColumns,
  set: (val) => queryBuilderStore.updateOrderByColumns(val)
})

const availableColumns = computed(() => {
  // ...
})

const addOrderByColumn = () => {
    queryBuilderStore.addOrderByColumn({
        id: crypto.randomUUID(),
        column: null,
        direction: 'ASC'
    })
}
// ...
</script>

<template>
  <!-- GROUP BYタブと同様の構造 -->
  <!-- Draggableリスト -->
    <draggable v-model="orderByColumns" ...>
        <OrderByRow ... />
    </draggable>
</template>
```

### order-by/OrderByRow.vue

```vue
<script setup lang="ts">
// Props: item (OrderByColumn), availableColumns
// Emits: update, remove

const directions = [
  { label: '昇順 (ASC)', value: 'ASC' },
  { label: '降順 (DESC)', value: 'DESC' }
]
</script>

<template>
  <div class="flex items-center gap-2 p-2 border rounded bg-white dark:bg-gray-800">
     <!-- ドラッグハンドル -->
     <UIcon name="i-heroicons-bars-2" class="drag-handle cursor-move text-gray-400" />
     
     <!-- カラム選択 -->
     <div class="flex-2">
       <ColumnSelect v-model="item.column" :columns="availableColumns" />
     </div>

     <!-- 順序選択 -->
     <div class="flex-1 min-w-[140px]">
       <USelect v-model="item.direction" :items="directions" option-attribute="label" value-attribute="value" />
     </div>

     <!-- 削除ボタン -->
     <UButton icon="i-heroicons-x-mark" color="red" variant="ghost" size="sm" @click="$emit('remove')" />
  </div>
</template>
```
