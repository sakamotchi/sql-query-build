# ã‚¿ã‚¹ã‚¯1.6.5: ã‚«ãƒ©ãƒ é¸æŠUIå®Ÿè£… è¨­è¨ˆæ›¸

## æ¦‚è¦

**ã‚¿ã‚¹ã‚¯ID**: 1.6.5
**ã‚¿ã‚¹ã‚¯å**: ã‚«ãƒ©ãƒ é¸æŠUIå®Ÿè£…
**å·¥æ•°**: 2æ—¥
**ä¾å­˜é–¢ä¿‚**: 1.6.4 (ãƒ†ãƒ¼ãƒ–ãƒ«é¸æŠæ©Ÿèƒ½å®Ÿè£…)
**å®Œäº†æ¡ä»¶**: ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§ã‚«ãƒ©ãƒ é¸æŠ
**UIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Nuxt UI v4ï¼ˆTailwind CSS 4ãƒ™ãƒ¼ã‚¹ï¼‰

---

## ç›®çš„

é¸æŠã•ã‚ŒãŸãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰SELECTå¥ã«å«ã‚ã‚‹ã‚«ãƒ©ãƒ ã‚’ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§é¸æŠã™ã‚‹UIã‚’å®Ÿè£…ã™ã‚‹ã€‚å…¨é¸æŠ/è§£é™¤ã€ã‚«ãƒ©ãƒ ã®ä¸¦ã³æ›¿ãˆã€ã‚¨ã‚¤ãƒªã‚¢ã‚¹è¨­å®šãªã©ã®æ©Ÿèƒ½ã‚’Nuxt UI v4ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§æä¾›ã—ã¾ã™ã€‚

---

## UIè¨­è¨ˆ

### ã‚«ãƒ©ãƒ é¸æŠã‚¿ãƒ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [SELECT] [WHERE] [GROUP BY] [ORDER BY] [LIMIT]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ“‹ users (u)                          [å…¨é¸æŠ] [è§£é™¤]â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ â˜‘ï¸ ğŸ”‘ id        â†’ id                               â”‚    â”‚
â”‚  â”‚ â˜‘ï¸ ğŸ“ name      â†’ name                             â”‚    â”‚
â”‚  â”‚ â˜‘ï¸ ğŸ“ email     â†’ email                            â”‚    â”‚
â”‚  â”‚ â˜ ğŸ”— dept_id   â†’ department_id                    â”‚    â”‚
â”‚  â”‚ â˜ ğŸ“… created_at                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ“‹ departments (d)                    [å…¨é¸æŠ] [è§£é™¤]â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ â˜‘ï¸ ğŸ”‘ id        â†’ dept_id                          â”‚    â”‚
â”‚  â”‚ â˜‘ï¸ ğŸ“ name      â†’ dept_name                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  é¸æŠã‚«ãƒ©ãƒ : 5 / 7                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é¸æŠã•ã‚ŒãŸã‚«ãƒ©ãƒ ä¸€è¦§ï¼ˆä¸¦ã³æ›¿ãˆå¯èƒ½ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¸æŠã•ã‚ŒãŸã‚«ãƒ©ãƒ                               [â†‘é †åºå¤‰æ›´å¯èƒ½]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜° u.id         AS id                                [Ã—]    â”‚
â”‚ â˜° u.name       AS name                              [Ã—]    â”‚
â”‚ â˜° u.email      AS email                             [Ã—]    â”‚
â”‚ â˜° d.id         AS dept_id                           [Ã—]    â”‚
â”‚ â˜° d.name       AS dept_name                         [Ã—]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
src/components/query-builder/
â”œâ”€â”€ ConditionTabs.vue              # æ¡ä»¶è¨­å®šã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒŠ
â”œâ”€â”€ select/
â”‚   â”œâ”€â”€ SelectTab.vue              # SELECTã‚¿ãƒ–
â”‚   â”œâ”€â”€ TableColumnGroup.vue       # ãƒ†ãƒ¼ãƒ–ãƒ«åˆ¥ã‚«ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—
â”‚   â”œâ”€â”€ ColumnCheckbox.vue         # ã‚«ãƒ©ãƒ ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
â”‚   â”œâ”€â”€ SelectedColumnList.vue     # é¸æŠã‚«ãƒ©ãƒ ä¸€è¦§
â”‚   â””â”€â”€ SelectedColumnItem.vue     # é¸æŠã‚«ãƒ©ãƒ é …ç›®
â””â”€â”€ CenterPanel.vue                # ä¸­å¤®ãƒ‘ãƒãƒ«ï¼ˆæ›´æ–°ï¼‰
```

---

### ConditionTabs.vue

```vue
<script setup lang="ts">
import { ref } from 'vue';
import SelectTab from './select/SelectTab.vue';
// ä»–ã®ã‚¿ãƒ–ã¯åˆ¥ã‚¿ã‚¹ã‚¯ã§å®Ÿè£…

const activeTab = ref('select');

const tabs = [
  { value: 'select', label: 'SELECT', icon: 'mdi-format-list-checks' },
  { value: 'where', label: 'WHERE', icon: 'mdi-filter' },
  { value: 'group', label: 'GROUP BY', icon: 'mdi-group' },
  { value: 'order', label: 'ORDER BY', icon: 'mdi-sort' },
  { value: 'limit', label: 'LIMIT', icon: 'mdi-counter' },
];
</script>

<template>
  <div class="condition-tabs">
    <!-- ã‚¿ãƒ–ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <v-tabs v-model="activeTab" density="compact" class="tabs-header">
      <v-tab
        v-for="tab in tabs"
        :key="tab.value"
        :value="tab.value"
      >
        <v-icon size="small" class="mr-1">{{ tab.icon }}</v-icon>
        {{ tab.label }}
      </v-tab>
    </v-tabs>

    <!-- ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div class="tabs-content">
      <v-window v-model="activeTab">
        <v-window-item value="select">
          <SelectTab />
        </v-window-item>

        <v-window-item value="where">
          <div class="placeholder">WHEREæ¡ä»¶ï¼ˆã‚¿ã‚¹ã‚¯1.6.6ã§å®Ÿè£…ï¼‰</div>
        </v-window-item>

        <v-window-item value="group">
          <div class="placeholder">GROUP BYï¼ˆãƒ•ã‚§ãƒ¼ã‚º2ã§å®Ÿè£…ï¼‰</div>
        </v-window-item>

        <v-window-item value="order">
          <div class="placeholder">ORDER BYï¼ˆãƒ•ã‚§ãƒ¼ã‚º2ã§å®Ÿè£…ï¼‰</div>
        </v-window-item>

        <v-window-item value="limit">
          <div class="placeholder">LIMITï¼ˆãƒ•ã‚§ãƒ¼ã‚º2ã§å®Ÿè£…ï¼‰</div>
        </v-window-item>
      </v-window>
    </div>
  </div>
</template>

<style scoped>
.condition-tabs {
  display: flex;
  flex-direction: column;
  height: 100%;
  overflow: hidden;
}

.tabs-header {
  flex-shrink: 0;
  border-bottom: 1px solid rgba(var(--v-border-color), var(--v-border-opacity));
}

.tabs-content {
  flex: 1;
  overflow: auto;
}

.placeholder {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  color: rgb(var(--v-theme-on-surface-variant));
}
</style>
```

---

### select/SelectTab.vue

```vue
<script setup lang="ts">
import { computed } from 'vue';
import { useQueryBuilderStore } from '@/stores/query-builder';
import TableColumnGroup from './TableColumnGroup.vue';
import SelectedColumnList from './SelectedColumnList.vue';

const queryBuilderStore = useQueryBuilderStore();

// é¸æŠã•ã‚ŒãŸãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§
const selectedTables = computed(() => queryBuilderStore.selectedTables);

// é¸æŠã•ã‚ŒãŸã‚«ãƒ©ãƒ ä¸€è¦§
const selectedColumns = computed(() => queryBuilderStore.selectedColumns);

// é¸æŠã‚«ãƒ©ãƒ æ•°
const selectedColumnCount = computed(() => selectedColumns.value.length);

// å…¨ã‚«ãƒ©ãƒ æ•°
const totalColumnCount = computed(() =>
  selectedTables.value.reduce((sum, table) => sum + table.columns.length, 0)
);

// ãƒ†ãƒ¼ãƒ–ãƒ«ãŒãªã„å ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
const isEmpty = computed(() => selectedTables.value.length === 0);
</script>

<template>
  <div class="select-tab">
    <!-- ç©ºçŠ¶æ…‹ -->
    <div v-if="isEmpty" class="empty-state">
      <v-icon size="48" color="grey-lighten-1">mdi-table-off</v-icon>
      <p class="text-grey mt-2">ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
      <p class="text-caption text-grey">
        å·¦ãƒ‘ãƒãƒ«ã‹ã‚‰ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—
      </p>
    </div>

    <template v-else>
      <div class="select-tab-content">
        <!-- å·¦: ã‚«ãƒ©ãƒ é¸æŠ -->
        <div class="column-selection-area">
          <div class="section-header">
            <span class="section-title">ã‚«ãƒ©ãƒ é¸æŠ</span>
            <span class="column-count">
              {{ selectedColumnCount }} / {{ totalColumnCount }}
            </span>
          </div>

          <div class="column-groups">
            <TableColumnGroup
              v-for="table in selectedTables"
              :key="table.id"
              :table="table"
            />
          </div>
        </div>

        <!-- å³: é¸æŠã•ã‚ŒãŸã‚«ãƒ©ãƒ  -->
        <div class="selected-columns-area">
          <div class="section-header">
            <span class="section-title">é¸æŠã•ã‚ŒãŸã‚«ãƒ©ãƒ </span>
            <v-btn
              v-if="selectedColumnCount > 0"
              variant="text"
              size="x-small"
              color="error"
              @click="queryBuilderStore.clearSelectedColumns()"
            >
              å…¨è§£é™¤
            </v-btn>
          </div>

          <SelectedColumnList :columns="selectedColumns" />
        </div>
      </div>
    </template>
  </div>
</template>

<style scoped>
.select-tab {
  height: 100%;
  overflow: hidden;
}

.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  padding: 24px;
  text-align: center;
}

.select-tab-content {
  display: flex;
  height: 100%;
  gap: 16px;
  padding: 16px;
}

.column-selection-area {
  flex: 1;
  min-width: 0;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.selected-columns-area {
  width: 300px;
  flex-shrink: 0;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  border-left: 1px solid rgba(var(--v-border-color), var(--v-border-opacity));
  padding-left: 16px;
}

.section-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
}

.section-title {
  font-size: 0.875rem;
  font-weight: 500;
}

.column-count {
  font-size: 0.75rem;
  color: rgb(var(--v-theme-on-surface-variant));
}

.column-groups {
  flex: 1;
  overflow: auto;
}
</style>
```

---

### select/TableColumnGroup.vue

```vue
<script setup lang="ts">
import { computed } from 'vue';
import { useQueryBuilderStore } from '@/stores/query-builder';
import ColumnCheckbox from './ColumnCheckbox.vue';
import type { SelectedTable } from '@/types/query';

const props = defineProps<{
  table: SelectedTable;
}>();

const queryBuilderStore = useQueryBuilderStore();

// ã“ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰é¸æŠã•ã‚ŒãŸã‚«ãƒ©ãƒ 
const selectedColumnsForTable = computed(() =>
  queryBuilderStore.selectedColumns.filter((c) => c.tableId === props.table.id)
);

// å…¨é¸æŠçŠ¶æ…‹
const isAllSelected = computed(
  () => selectedColumnsForTable.value.length === props.table.columns.length
);

// ä¸€éƒ¨é¸æŠçŠ¶æ…‹
const isIndeterminate = computed(
  () =>
    selectedColumnsForTable.value.length > 0 &&
    selectedColumnsForTable.value.length < props.table.columns.length
);

/**
 * å…¨é¸æŠ/è§£é™¤
 */
const toggleSelectAll = () => {
  if (isAllSelected.value) {
    queryBuilderStore.deselectAllColumnsFromTable(props.table.id);
  } else {
    queryBuilderStore.selectAllColumnsFromTable(props.table);
  }
};

/**
 * ã‚«ãƒ©ãƒ ã®é¸æŠçŠ¶æ…‹ã‚’å¤‰æ›´
 */
const handleColumnToggle = (columnName: string, selected: boolean) => {
  const column = props.table.columns.find((c) => c.name === columnName);
  if (!column) return;

  if (selected) {
    queryBuilderStore.selectColumn({
      tableId: props.table.id,
      tableAlias: props.table.alias,
      columnName: column.name,
      columnAlias: null,
      dataType: column.dataType,
    });
  } else {
    queryBuilderStore.deselectColumn(props.table.id, columnName);
  }
};

/**
 * ã‚«ãƒ©ãƒ ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã‹
 */
const isColumnSelected = (columnName: string): boolean => {
  return selectedColumnsForTable.value.some((c) => c.columnName === columnName);
};
</script>

<template>
  <div class="table-column-group">
    <!-- ã‚°ãƒ«ãƒ¼ãƒ—ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="group-header">
      <v-checkbox
        :model-value="isAllSelected"
        :indeterminate="isIndeterminate"
        hide-details
        density="compact"
        @update:model-value="toggleSelectAll"
      />

      <v-icon size="small" color="primary" class="mr-1">mdi-table</v-icon>
      <span class="table-name">{{ table.name }}</span>
      <span class="table-alias">({{ table.alias }})</span>

      <v-spacer />

      <span class="selection-count">
        {{ selectedColumnsForTable.length }} / {{ table.columns.length }}
      </span>
    </div>

    <!-- ã‚«ãƒ©ãƒ ãƒªã‚¹ãƒˆ -->
    <div class="column-list">
      <ColumnCheckbox
        v-for="column in table.columns"
        :key="column.name"
        :column="column"
        :table-alias="table.alias"
        :selected="isColumnSelected(column.name)"
        @toggle="handleColumnToggle"
      />
    </div>
  </div>
</template>

<style scoped>
.table-column-group {
  margin-bottom: 16px;
  border: 1px solid rgba(var(--v-border-color), var(--v-border-opacity));
  border-radius: 8px;
  overflow: hidden;
}

.group-header {
  display: flex;
  align-items: center;
  padding: 8px 12px;
  background: rgba(var(--v-theme-surface-variant), 0.5);
  gap: 4px;
}

.table-name {
  font-size: 0.875rem;
  font-weight: 500;
}

.table-alias {
  font-size: 0.75rem;
  color: rgb(var(--v-theme-primary));
}

.selection-count {
  font-size: 0.75rem;
  color: rgb(var(--v-theme-on-surface-variant));
}

.column-list {
  padding: 8px;
}
</style>
```

---

### select/ColumnCheckbox.vue

```vue
<script setup lang="ts">
import { ref, computed, watch } from 'vue';
import type { Column } from '@/types/database-structure';

const props = defineProps<{
  column: Column;
  tableAlias: string;
  selected: boolean;
}>();

const emit = defineEmits<{
  (e: 'toggle', columnName: string, selected: boolean): void;
}>();

// ã‚¨ã‚¤ãƒªã‚¢ã‚¹ç·¨é›†
const isEditingAlias = ref(false);
const editingAlias = ref('');

// ã‚«ãƒ©ãƒ ã‚¢ã‚¤ã‚³ãƒ³
const columnIcon = computed(() => {
  if (props.column.isPrimaryKey) return { icon: 'mdi-key', color: 'amber-darken-2' };
  if (props.column.isForeignKey) return { icon: 'mdi-link', color: 'blue' };
  if (props.column.isUnique) return { icon: 'mdi-star', color: 'purple' };
  return { icon: 'mdi-format-text', color: 'grey' };
});

/**
 * ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹å¤‰æ›´
 */
const handleChange = (value: boolean) => {
  emit('toggle', props.column.name, value);
};
</script>

<template>
  <div class="column-checkbox" :class="{ 'is-selected': selected }">
    <v-checkbox
      :model-value="selected"
      hide-details
      density="compact"
      @update:model-value="handleChange"
    />

    <v-icon
      :icon="columnIcon.icon"
      :color="columnIcon.color"
      size="x-small"
      class="column-icon"
    />

    <span class="column-name">{{ column.name }}</span>

    <span class="column-type">{{ column.displayType }}</span>

    <span v-if="!column.nullable" class="not-null" title="NOT NULL">*</span>
  </div>
</template>

<style scoped>
.column-checkbox {
  display: flex;
  align-items: center;
  padding: 4px 8px;
  border-radius: 4px;
  gap: 4px;
  transition: background-color 0.2s;
}

.column-checkbox:hover {
  background: rgba(var(--v-theme-primary), 0.05);
}

.column-checkbox.is-selected {
  background: rgba(var(--v-theme-primary), 0.1);
}

.column-icon {
  flex-shrink: 0;
}

.column-name {
  font-size: 0.8125rem;
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.column-type {
  font-size: 0.75rem;
  color: rgb(var(--v-theme-on-surface-variant));
  flex-shrink: 0;
}

.not-null {
  color: rgb(var(--v-theme-error));
  font-weight: bold;
  flex-shrink: 0;
}
</style>
```

---

### select/SelectedColumnList.vue

```vue
<script setup lang="ts">
import { computed } from 'vue';
import { useQueryBuilderStore } from '@/stores/query-builder';
import SelectedColumnItem from './SelectedColumnItem.vue';
import type { SelectedColumn } from '@/types/query';

const props = defineProps<{
  columns: SelectedColumn[];
}>();

const queryBuilderStore = useQueryBuilderStore();

// ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
const draggedIndex = ref<number | null>(null);

/**
 * ã‚«ãƒ©ãƒ ã‚’å‰Šé™¤
 */
const handleRemove = (tableId: string, columnName: string) => {
  queryBuilderStore.deselectColumn(tableId, columnName);
};

/**
 * ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’æ›´æ–°
 */
const handleAliasUpdate = (
  tableId: string,
  columnName: string,
  alias: string | null
) => {
  queryBuilderStore.updateColumnAlias(tableId, columnName, alias);
};

/**
 * ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹
 */
const handleDragStart = (index: number) => {
  draggedIndex.value = index;
};

/**
 * ãƒ‰ãƒ©ãƒƒã‚°ã‚ªãƒ¼ãƒãƒ¼
 */
const handleDragOver = (index: number) => {
  if (draggedIndex.value === null || draggedIndex.value === index) return;

  queryBuilderStore.reorderColumns(draggedIndex.value, index);
  draggedIndex.value = index;
};

/**
 * ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†
 */
const handleDragEnd = () => {
  draggedIndex.value = null;
};

import { ref } from 'vue';
</script>

<template>
  <div class="selected-column-list">
    <div v-if="columns.length === 0" class="empty-state">
      <v-icon color="grey-lighten-1">mdi-checkbox-blank-outline</v-icon>
      <p class="text-caption text-grey mt-2">
        ã‚«ãƒ©ãƒ ã‚’é¸æŠã—ã¦ãã ã•ã„
      </p>
    </div>

    <TransitionGroup v-else name="list" tag="div" class="column-items">
      <SelectedColumnItem
        v-for="(column, index) in columns"
        :key="`${column.tableId}.${column.columnName}`"
        :column="column"
        :index="index"
        :is-dragging="draggedIndex === index"
        @remove="handleRemove"
        @update-alias="handleAliasUpdate"
        @drag-start="handleDragStart"
        @drag-over="handleDragOver"
        @drag-end="handleDragEnd"
      />
    </TransitionGroup>
  </div>
</template>

<style scoped>
.selected-column-list {
  flex: 1;
  overflow: auto;
}

.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  padding: 24px;
  text-align: center;
}

.column-items {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

/* ãƒªã‚¹ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
.list-enter-active,
.list-leave-active {
  transition: all 0.3s ease;
}

.list-enter-from,
.list-leave-to {
  opacity: 0;
  transform: translateX(30px);
}

.list-move {
  transition: transform 0.3s ease;
}
</style>
```

---

### select/SelectedColumnItem.vue

```vue
<script setup lang="ts">
import { ref, computed, watch } from 'vue';
import type { SelectedColumn } from '@/types/query';

const props = defineProps<{
  column: SelectedColumn;
  index: number;
  isDragging: boolean;
}>();

const emit = defineEmits<{
  (e: 'remove', tableId: string, columnName: string): void;
  (e: 'update-alias', tableId: string, columnName: string, alias: string | null): void;
  (e: 'drag-start', index: number): void;
  (e: 'drag-over', index: number): void;
  (e: 'drag-end'): void;
}>();

// ã‚¨ã‚¤ãƒªã‚¢ã‚¹ç·¨é›†
const isEditingAlias = ref(false);
const editingAlias = ref('');

// è¡¨ç¤ºç”¨ã®ã‚«ãƒ©ãƒ å
const displayName = computed(() =>
  `${props.column.tableAlias}.${props.column.columnName}`
);

// è¡¨ç¤ºç”¨ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹
const displayAlias = computed(() =>
  props.column.columnAlias || props.column.columnName
);

/**
 * ã‚¨ã‚¤ãƒªã‚¢ã‚¹ç·¨é›†é–‹å§‹
 */
const startEditAlias = () => {
  isEditingAlias.value = true;
  editingAlias.value = props.column.columnAlias || '';
};

/**
 * ã‚¨ã‚¤ãƒªã‚¢ã‚¹ç¢ºå®š
 */
const confirmAlias = () => {
  isEditingAlias.value = false;
  const alias = editingAlias.value.trim() || null;
  emit('update-alias', props.column.tableId, props.column.columnName, alias);
};

/**
 * ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚­ãƒ£ãƒ³ã‚»ãƒ«
 */
const cancelAlias = () => {
  isEditingAlias.value = false;
};

/**
 * ã‚­ãƒ¼å…¥åŠ›
 */
const handleKeyDown = (e: KeyboardEvent) => {
  if (e.key === 'Enter') confirmAlias();
  if (e.key === 'Escape') cancelAlias();
};

/**
 * å‰Šé™¤
 */
const handleRemove = () => {
  emit('remove', props.column.tableId, props.column.columnName);
};

/**
 * ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹
 */
const handleDragStart = () => {
  emit('drag-start', props.index);
};

/**
 * ãƒ‰ãƒ©ãƒƒã‚°ã‚ªãƒ¼ãƒãƒ¼
 */
const handleDragOver = (e: DragEvent) => {
  e.preventDefault();
  emit('drag-over', props.index);
};

/**
 * ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†
 */
const handleDragEnd = () => {
  emit('drag-end');
};
</script>

<template>
  <div
    class="selected-column-item"
    :class="{ 'is-dragging': isDragging }"
    draggable="true"
    @dragstart="handleDragStart"
    @dragover="handleDragOver"
    @dragend="handleDragEnd"
  >
    <!-- ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ« -->
    <v-icon size="small" class="drag-handle">mdi-drag</v-icon>

    <!-- ã‚«ãƒ©ãƒ å -->
    <span class="column-name">{{ displayName }}</span>

    <!-- AS -->
    <span class="as-keyword">AS</span>

    <!-- ã‚¨ã‚¤ãƒªã‚¢ã‚¹ -->
    <template v-if="isEditingAlias">
      <input
        v-model="editingAlias"
        class="alias-input"
        type="text"
        maxlength="50"
        placeholder="ã‚¨ã‚¤ãƒªã‚¢ã‚¹"
        @blur="confirmAlias"
        @keydown="handleKeyDown"
        autofocus
      />
    </template>
    <template v-else>
      <span
        class="alias-display"
        :class="{ 'is-custom': column.columnAlias }"
        @click="startEditAlias"
      >
        {{ displayAlias }}
      </span>
    </template>

    <v-spacer />

    <!-- å‰Šé™¤ãƒœã‚¿ãƒ³ -->
    <v-btn
      icon
      variant="text"
      size="x-small"
      color="error"
      @click="handleRemove"
    >
      <v-icon size="small">mdi-close</v-icon>
    </v-btn>
  </div>
</template>

<style scoped>
.selected-column-item {
  display: flex;
  align-items: center;
  padding: 6px 8px;
  background: rgb(var(--v-theme-surface));
  border: 1px solid rgba(var(--v-border-color), var(--v-border-opacity));
  border-radius: 4px;
  gap: 8px;
  cursor: grab;
}

.selected-column-item:hover {
  background: rgba(var(--v-theme-primary), 0.05);
}

.selected-column-item.is-dragging {
  opacity: 0.5;
}

.drag-handle {
  cursor: grab;
  color: rgb(var(--v-theme-on-surface-variant));
}

.column-name {
  font-size: 0.8125rem;
  font-family: monospace;
  color: rgb(var(--v-theme-primary));
}

.as-keyword {
  font-size: 0.75rem;
  color: rgb(var(--v-theme-on-surface-variant));
  text-transform: uppercase;
}

.alias-display {
  font-size: 0.8125rem;
  font-family: monospace;
  padding: 2px 6px;
  border-radius: 4px;
  cursor: pointer;
  color: rgb(var(--v-theme-on-surface-variant));
}

.alias-display:hover {
  background: rgba(var(--v-theme-primary), 0.1);
}

.alias-display.is-custom {
  color: rgb(var(--v-theme-secondary));
  background: rgba(var(--v-theme-secondary), 0.1);
}

.alias-input {
  width: 100px;
  font-size: 0.8125rem;
  font-family: monospace;
  padding: 2px 6px;
  border: 1px solid rgb(var(--v-theme-primary));
  border-radius: 4px;
  outline: none;
}
</style>
```

---

## çŠ¶æ…‹ç®¡ç†

### query-builder.tsï¼ˆã‚«ãƒ©ãƒ é¸æŠé–¢é€£ã®è¿½åŠ ï¼‰

```typescript
import { defineStore } from 'pinia';
import type { SelectedTable, SelectedColumn } from '@/types/query';

interface QueryBuilderState {
  selectedTables: SelectedTable[];
  selectedColumns: SelectedColumn[];
  // ...
}

export const useQueryBuilderStore = defineStore('query-builder', {
  state: (): QueryBuilderState => ({
    selectedTables: [],
    selectedColumns: [],
    // ...
  }),

  actions: {
    /**
     * ã‚«ãƒ©ãƒ ã‚’é¸æŠ
     */
    selectColumn(column: SelectedColumn) {
      // é‡è¤‡ãƒã‚§ãƒƒã‚¯
      const exists = this.selectedColumns.some(
        (c) => c.tableId === column.tableId && c.columnName === column.columnName
      );
      if (exists) return;

      this.selectedColumns.push(column);
      this.regenerateSql();
    },

    /**
     * ã‚«ãƒ©ãƒ ã®é¸æŠã‚’è§£é™¤
     */
    deselectColumn(tableId: string, columnName: string) {
      const index = this.selectedColumns.findIndex(
        (c) => c.tableId === tableId && c.columnName === columnName
      );
      if (index !== -1) {
        this.selectedColumns.splice(index, 1);
        this.regenerateSql();
      }
    },

    /**
     * ãƒ†ãƒ¼ãƒ–ãƒ«ã®å…¨ã‚«ãƒ©ãƒ ã‚’é¸æŠ
     */
    selectAllColumnsFromTable(table: SelectedTable) {
      for (const column of table.columns) {
        this.selectColumn({
          tableId: table.id,
          tableAlias: table.alias,
          columnName: column.name,
          columnAlias: null,
          dataType: column.dataType,
        });
      }
    },

    /**
     * ãƒ†ãƒ¼ãƒ–ãƒ«ã®å…¨ã‚«ãƒ©ãƒ ã®é¸æŠã‚’è§£é™¤
     */
    deselectAllColumnsFromTable(tableId: string) {
      this.selectedColumns = this.selectedColumns.filter(
        (c) => c.tableId !== tableId
      );
      this.regenerateSql();
    },

    /**
     * å…¨ã‚«ãƒ©ãƒ ã®é¸æŠã‚’ã‚¯ãƒªã‚¢
     */
    clearSelectedColumns() {
      this.selectedColumns = [];
      this.regenerateSql();
    },

    /**
     * ã‚«ãƒ©ãƒ ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’æ›´æ–°
     */
    updateColumnAlias(
      tableId: string,
      columnName: string,
      alias: string | null
    ) {
      const column = this.selectedColumns.find(
        (c) => c.tableId === tableId && c.columnName === columnName
      );
      if (column) {
        column.columnAlias = alias;
        this.regenerateSql();
      }
    },

    /**
     * ã‚«ãƒ©ãƒ ã®é †åºã‚’å¤‰æ›´
     */
    reorderColumns(fromIndex: number, toIndex: number) {
      const [column] = this.selectedColumns.splice(fromIndex, 1);
      this.selectedColumns.splice(toIndex, 0, column);
      this.regenerateSql();
    },

    /**
     * ãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤æ™‚ã«é–¢é€£ã‚«ãƒ©ãƒ ã‚‚å‰Šé™¤
     */
    removeRelatedColumns(tableId: string) {
      this.deselectAllColumnsFromTable(tableId);
    },
  },
});
```

---

## å‹å®šç¾©

### src/types/query.tsï¼ˆè¿½åŠ ï¼‰

```typescript
/**
 * é¸æŠã•ã‚ŒãŸã‚«ãƒ©ãƒ 
 */
export interface SelectedColumn {
  /** ãƒ†ãƒ¼ãƒ–ãƒ«ID */
  tableId: string;
  /** ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¨ã‚¤ãƒªã‚¢ã‚¹ */
  tableAlias: string;
  /** ã‚«ãƒ©ãƒ å */
  columnName: string;
  /** ã‚«ãƒ©ãƒ ã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼ˆASå¥ï¼‰ */
  columnAlias: string | null;
  /** ãƒ‡ãƒ¼ã‚¿å‹ */
  dataType: string;
}
```

---

## ãƒ†ã‚¹ãƒˆè¨­è¨ˆ

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

```typescript
describe('SelectTab', () => {
  it('should display empty state when no tables selected', () => {
    // ãƒ†ãƒ¼ãƒ–ãƒ«ãŒãªã„å ´åˆã¯ç©ºçŠ¶æ…‹ã‚’è¡¨ç¤º
  });

  it('should display column groups for each table', () => {
    // ãƒ†ãƒ¼ãƒ–ãƒ«ã”ã¨ã«ã‚«ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—ã‚’è¡¨ç¤º
  });
});

describe('TableColumnGroup', () => {
  it('should toggle all columns', () => {
    // å…¨é¸æŠ/è§£é™¤ãŒå‹•ä½œã™ã‚‹
  });

  it('should show correct selection count', () => {
    // é¸æŠæ•°ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
  });
});

describe('SelectedColumnList', () => {
  it('should reorder columns on drag', () => {
    // ãƒ‰ãƒ©ãƒƒã‚°ã§é †åºå¤‰æ›´ã§ãã‚‹
  });

  it('should allow alias editing', () => {
    // ã‚¨ã‚¤ãƒªã‚¢ã‚¹ãŒç·¨é›†ã§ãã‚‹
  });
});
```

### E2Eãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª

```
ã‚·ãƒŠãƒªã‚ª1: ã‚«ãƒ©ãƒ é¸æŠ
1. ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¿½åŠ 
2. SELECTã‚¿ãƒ–ã§ã‚«ãƒ©ãƒ ã«ãƒã‚§ãƒƒã‚¯
3. é¸æŠã•ã‚ŒãŸã‚«ãƒ©ãƒ ãƒªã‚¹ãƒˆã«è¿½åŠ ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

ã‚·ãƒŠãƒªã‚ª2: å…¨é¸æŠ/è§£é™¤
1. ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã®å…¨é¸æŠãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯
2. å…¨ã‚«ãƒ©ãƒ ãŒé¸æŠã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
3. å†åº¦ã‚¯ãƒªãƒƒã‚¯ã—ã¦å…¨è§£é™¤ã‚’ç¢ºèª

ã‚·ãƒŠãƒªã‚ª3: ã‚«ãƒ©ãƒ é †åºå¤‰æ›´
1. è¤‡æ•°ã‚«ãƒ©ãƒ ã‚’é¸æŠ
2. é¸æŠã‚«ãƒ©ãƒ ãƒªã‚¹ãƒˆã§ãƒ‰ãƒ©ãƒƒã‚°
3. é †åºãŒå¤‰æ›´ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
```

---

## å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] `src/components/query-builder/ConditionTabs.vue` ã®ä½œæˆ
- [ ] `src/components/query-builder/select/SelectTab.vue` ã®ä½œæˆ
- [ ] `src/components/query-builder/select/TableColumnGroup.vue` ã®ä½œæˆ
- [ ] `src/components/query-builder/select/ColumnCheckbox.vue` ã®ä½œæˆ
- [ ] `src/components/query-builder/select/SelectedColumnList.vue` ã®ä½œæˆ
- [ ] `src/components/query-builder/select/SelectedColumnItem.vue` ã®ä½œæˆ
- [ ] `src/types/query.ts` ã®æ›´æ–°ï¼ˆSelectedColumnå‹ï¼‰
- [ ] `src/stores/query-builder.ts` ã®æ›´æ–°ï¼ˆã‚«ãƒ©ãƒ é¸æŠæ©Ÿèƒ½ï¼‰
- [ ] ã‚«ãƒ©ãƒ é¸æŠæ©Ÿèƒ½ã®å®Ÿè£…
- [ ] ã‚¨ã‚¤ãƒªã‚¢ã‚¹ç·¨é›†æ©Ÿèƒ½ã®å®Ÿè£…
- [ ] ãƒ‰ãƒ©ãƒƒã‚°ä¸¦ã³æ›¿ãˆæ©Ÿèƒ½ã®å®Ÿè£…
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ä½œæˆ
- [ ] E2Eãƒ†ã‚¹ãƒˆã®ä½œæˆ

---

## å‚è€ƒè³‡æ–™

- [Nuxt UI v4 Documentation](https://ui.nuxt.com/)
- [Nuxt UI Checkbox Component](https://ui.nuxt.com/components/checkbox)
- [Nuxt UI Tabs Component](https://ui.nuxt.com/components/tabs)
- [Tailwind CSS v4](https://tailwindcss.com/)
- [Vue Transition Group](https://vuejs.org/guide/built-ins/transition-group.html)
