# タスク1.3.1: 起動画面(ランチャー)UI実装 設計書

## 概要

**タスクID**: 1.3.1
**タスク名**: 起動画面(ランチャー)UI実装
**工数**: 2日
**依存関係**: 1.1.2 (Vuetify 3.x セットアップ)
**完了条件**: ランチャー画面が表示される

---

## 目的

アプリケーション起動時に表示される、データベース接続の一覧と管理を行うランチャー画面のUIを実装する。

---

## 画面構成

### レイアウト構造

```
┌───────────────────────────────────────────────────┐
│ ヘッダーバー                                       │
│ [アプリロゴ] SQLエディタ        [新規接続] [設定]  │
├───────────────────────────────────────────────────┤
│ ツールバー                                         │
│ [検索バー]  [環境別フィルター]  [ソート]          │
├───────────────────────────────────────────────────┤
│ メインコンテンツ                                   │
│                                                   │
│ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐    │
│ │接続    │ │接続    │ │接続    │ │接続    │    │
│ │カード1 │ │カード2 │ │カード3 │ │カード4 │    │
│ └────────┘ └────────┘ └────────┘ └────────┘    │
│                                                   │
│ ┌────────┐ ┌────────┐                           │
│ │接続    │ │接続    │                           │
│ │カード5 │ │カード6 │                           │
│ └────────┘ └────────┘                           │
│                                                   │
└───────────────────────────────────────────────────┘
```

---

## コンポーネント設計

### 1. ページコンポーネント: `LauncherPage.vue`

**配置場所**: `src/pages/launcher.vue`

#### 責務
- ランチャー画面全体のレイアウト管理
- 各子コンポーネントの配置と連携
- 画面全体の状態管理

#### Props
なし (ルートページコンポーネント)

#### Emits
なし

#### 構成
```vue
<template>
  <v-app>
    <LauncherAppBar
      @new-connection="handleNewConnection"
      @open-settings="handleOpenSettings"
    />

    <v-main>
      <v-container fluid>
        <LauncherToolbar
          v-model:search="searchQuery"
          v-model:filter="environmentFilter"
          v-model:sort="sortOption"
        />

        <ConnectionList
          :connections="filteredConnections"
          :loading="loading"
          @select-connection="handleSelectConnection"
          @edit-connection="handleEditConnection"
          @delete-connection="handleDeleteConnection"
        />
      </v-container>
    </v-main>
  </v-app>
</template>
```

#### データ構造
```typescript
interface LauncherPageData {
  searchQuery: string;          // 検索クエリ
  environmentFilter: string;    // 環境フィルター ('all' | 'development' | 'test' | 'staging' | 'production')
  sortOption: string;           // ソートオプション ('name' | 'lastUsed' | 'environment')
  loading: boolean;             // ローディング状態
}
```

---

### 2. ヘッダーコンポーネント: `LauncherAppBar.vue`

**配置場所**: `src/components/connection/LauncherAppBar.vue`

#### 責務
- アプリケーションロゴとタイトルの表示
- 新規接続ボタンの配置
- 設定ボタンの配置

#### Props
```typescript
interface LauncherAppBarProps {
  // なし
}
```

#### Emits
```typescript
interface LauncherAppBarEmits {
  (e: 'new-connection'): void;
  (e: 'open-settings'): void;
}
```

#### レイアウト
```vue
<template>
  <v-app-bar color="primary" dark elevation="2">
    <v-app-bar-nav-icon>
      <v-icon>mdi-database</v-icon>
    </v-app-bar-nav-icon>

    <v-app-bar-title>SQLエディタ ランチャー</v-app-bar-title>

    <v-spacer></v-spacer>

    <v-btn
      prepend-icon="mdi-plus-circle"
      @click="$emit('new-connection')"
    >
      新規接続
    </v-btn>

    <v-btn
      icon="mdi-cog"
      @click="$emit('open-settings')"
    ></v-btn>
  </v-app-bar>
</template>
```

---

### 3. ツールバーコンポーネント: `LauncherToolbar.vue`

**配置場所**: `src/components/connection/LauncherToolbar.vue`

#### 責務
- 接続の検索機能
- 環境別フィルター
- ソートオプション選択

#### Props
```typescript
interface LauncherToolbarProps {
  search: string;
  filter: string;
  sort: string;
}
```

#### Emits
```typescript
interface LauncherToolbarEmits {
  (e: 'update:search', value: string): void;
  (e: 'update:filter', value: string): void;
  (e: 'update:sort', value: string): void;
}
```

#### レイアウト
```vue
<template>
  <v-toolbar flat class="mb-4">
    <v-text-field
      :model-value="search"
      @update:model-value="$emit('update:search', $event)"
      prepend-inner-icon="mdi-magnify"
      label="接続名で検索"
      single-line
      hide-details
      clearable
      variant="outlined"
      density="compact"
      style="max-width: 400px"
    ></v-text-field>

    <v-spacer></v-spacer>

    <v-select
      :model-value="filter"
      @update:model-value="$emit('update:filter', $event)"
      :items="environmentFilterOptions"
      label="環境フィルター"
      variant="outlined"
      density="compact"
      hide-details
      style="max-width: 200px"
      class="mr-4"
    ></v-select>

    <v-select
      :model-value="sort"
      @update:model-value="$emit('update:sort', $event)"
      :items="sortOptions"
      label="並び順"
      variant="outlined"
      density="compact"
      hide-details
      style="max-width: 200px"
    ></v-select>
  </v-toolbar>
</template>
```

#### データ定義
```typescript
const environmentFilterOptions = [
  { title: 'すべて', value: 'all' },
  { title: '開発環境', value: 'development' },
  { title: 'テスト環境', value: 'test' },
  { title: 'ステージング環境', value: 'staging' },
  { title: '本番環境', value: 'production' }
];

const sortOptions = [
  { title: '接続名順', value: 'name' },
  { title: '最終使用日時順', value: 'lastUsed' },
  { title: '環境順', value: 'environment' }
];
```

---

### 4. 接続リストコンポーネント: `ConnectionList.vue`

**配置場所**: `src/components/connection/ConnectionList.vue`

#### 責務
- 接続カードのグリッド表示
- ローディング状態の表示
- 空状態の表示

#### Props
```typescript
interface ConnectionListProps {
  connections: Connection[];
  loading: boolean;
}
```

#### Emits
```typescript
interface ConnectionListEmits {
  (e: 'select-connection', connection: Connection): void;
  (e: 'edit-connection', connection: Connection): void;
  (e: 'delete-connection', connection: Connection): void;
}
```

#### レイアウト
```vue
<template>
  <div class="connection-list">
    <!-- ローディング状態 -->
    <v-progress-linear
      v-if="loading"
      indeterminate
      color="primary"
    ></v-progress-linear>

    <!-- 空状態 -->
    <v-sheet
      v-else-if="connections.length === 0"
      class="text-center pa-12"
      rounded
      border
    >
      <v-icon size="64" color="grey-lighten-1">mdi-database-off</v-icon>
      <div class="text-h6 mt-4 text-grey">登録された接続がありません</div>
      <div class="text-body-2 text-grey-darken-1 mt-2">
        「新規接続」ボタンから接続を追加してください
      </div>
    </v-sheet>

    <!-- 接続カードグリッド -->
    <v-row v-else>
      <v-col
        v-for="connection in connections"
        :key="connection.id"
        cols="12"
        sm="6"
        md="4"
        lg="3"
      >
        <ConnectionCard
          :connection="connection"
          @select="$emit('select-connection', connection)"
          @edit="$emit('edit-connection', connection)"
          @delete="$emit('delete-connection', connection)"
        />
      </v-col>
    </v-row>
  </div>
</template>
```

---

## データモデル

### Connection型定義

```typescript
interface Connection {
  id: string;                    // UUID
  name: string;                  // 接続名
  environment: Environment;      // 環境タイプ
  themeColor: string;            // テーマカラー
  host: string;                  // ホスト名
  port: number;                  // ポート番号
  database: string;              // データベース名
  username: string;              // ユーザー名
  password: string;              // 暗号化されたパスワード
  dbType: DatabaseType;          // データベース種別
  ssl: boolean;                  // SSL使用フラグ
  createdAt: string;             // 作成日時 (ISO 8601)
  updatedAt: string;             // 更新日時 (ISO 8601)
  lastUsedAt?: string;           // 最終使用日時 (ISO 8601)
}

type Environment = 'development' | 'test' | 'staging' | 'production';
type DatabaseType = 'postgresql' | 'mysql' | 'sqlite';
```

---

## スタイリング

### レスポンシブデザイン

```scss
// グリッドブレークポイント
// xs: < 600px  - 1カラム
// sm: ≥ 600px  - 2カラム
// md: ≥ 960px  - 3カラム
// lg: ≥ 1280px - 4カラム
// xl: ≥ 1920px - 4カラム
```

### テーマカラー

```typescript
// Vuetify テーマ設定
const theme = {
  primary: '#1976D2',      // Blue
  secondary: '#424242',    // Grey
  accent: '#82B1FF',       // Light Blue
  error: '#FF5252',        // Red
  info: '#2196F3',         // Blue
  success: '#4CAF50',      // Green
  warning: '#FB8C00',      // Orange
};
```

---

## 画面遷移

### ユーザーアクション
1. **新規接続ボタンクリック** → 接続設定画面 (S002) へ遷移
2. **設定ボタンクリック** → 設定画面 (S010) へ遷移
3. **接続カードクリック** → クエリビルダー画面 (S003) を新規ウィンドウで起動
4. **編集ボタンクリック** → 接続設定画面 (S002) へ遷移 (編集モード)
5. **削除ボタンクリック** → 削除確認ダイアログ表示

---

## アクセシビリティ

### キーボード操作
- **Tab**: フォーカス移動
- **Enter**: 接続を選択して起動
- **Delete**: 選択中の接続を削除 (確認ダイアログ表示)
- **Ctrl/Cmd + N**: 新規接続
- **Ctrl/Cmd + F**: 検索フォーカス

### ARIA属性
```html
<v-btn
  aria-label="新規接続を追加"
  role="button"
>
  新規接続
</v-btn>

<v-card
  :aria-label="`${connection.name}への接続`"
  role="button"
  tabindex="0"
>
```

---

## パフォーマンス考慮事項

### 仮想スクロール
- 接続が100件を超える場合、`v-virtual-scroll`を使用して仮想スクロールを実装

### 遅延ロード
- 接続リストのフィルタリング・ソートはクライアントサイドで実施
- 接続数が1000件を超える場合は、サーバーサイドページネーションを検討

---

## エラーハンドリング

### 接続取得エラー
```typescript
try {
  const connections = await invoke('get_connections');
} catch (error) {
  // エラートースト表示
  showErrorToast('接続情報の取得に失敗しました');
  console.error('Failed to load connections:', error);
}
```

### 削除確認ダイアログ
```typescript
const confirmDelete = async (connection: Connection) => {
  const confirmed = await showConfirmDialog({
    title: '接続の削除',
    message: `「${connection.name}」を削除してもよろしいですか?`,
    confirmText: '削除',
    cancelText: 'キャンセル',
    color: 'error'
  });

  if (confirmed) {
    await deleteConnection(connection.id);
  }
};
```

---

## テスト観点

### ユニットテスト
- [ ] 検索フィルタリングが正しく動作すること
- [ ] 環境フィルターが正しく動作すること
- [ ] ソート機能が正しく動作すること
- [ ] 空状態が正しく表示されること

### E2Eテスト
- [ ] ランチャー画面が正しく表示されること
- [ ] 新規接続ボタンから接続設定画面に遷移できること
- [ ] 接続カードをクリックして新規ウィンドウが起動すること
- [ ] 検索機能が正しく動作すること

---

## 実装チェックリスト

- [ ] `src/pages/launcher.vue` の作成
- [ ] `src/components/connection/LauncherAppBar.vue` の作成
- [ ] `src/components/connection/LauncherToolbar.vue` の作成
- [ ] `src/components/connection/ConnectionList.vue` の作成
- [ ] フィルタリングロジックの実装
- [ ] ソートロジックの実装
- [ ] キーボードショートカットの実装
- [ ] レスポンシブデザインの確認
- [ ] アクセシビリティのテスト
- [ ] ユニットテストの作成
- [ ] E2Eテストの作成
