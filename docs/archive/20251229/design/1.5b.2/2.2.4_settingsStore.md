# タスク1.5b.2.2.4: settingsストア移行

**サブフェーズ**: 2.2 Piniaストア移行
**工数**: 1.5時間
**優先度**: 中
**依存関係**: 2.1.3 (型定義)

---

## 目的

アプリケーション設定の管理を実装

---

## 実装内容

### ファイル作成: `app/stores/settings.ts`

```typescript
import { defineStore } from 'pinia'
import type { AppSettings } from '~/types'

export const useSettingsStore = defineStore('settings', {
  state: () => ({
    settings: {
      theme: 'auto',
      language: 'ja',
      autoSave: true,
      windowRestore: true
    } as AppSettings,
    loading: false,
    error: null as string | null
  }),

  getters: {
    /**
     * 現在の設定
     */
    currentSettings: (state) => state.settings,

    /**
     * 自動保存が有効か
     */
    isAutoSaveEnabled: (state) => state.settings.autoSave,

    /**
     * ウィンドウ復元が有効か
     */
    isWindowRestoreEnabled: (state) => state.settings.windowRestore,

    /**
     * 現在の言語
     */
    currentLanguage: (state) => state.settings.language
  },

  actions: {
    /**
     * 設定をロード
     */
    async loadSettings() {
      this.loading = true
      this.error = null

      try {
        const { invokeCommand } = useTauri()
        const settings = await invokeCommand<AppSettings>('get_settings')
        if (settings) {
          this.settings = settings
        }
      } catch (error) {
        this.error = error instanceof Error ? error.message : 'Failed to load settings'
        console.error('Failed to load settings:', error)
      } finally {
        this.loading = false
      }
    },

    /**
     * 設定を更新
     */
    async updateSettings(updates: Partial<AppSettings>) {
      this.loading = true
      this.error = null

      try {
        const { invokeCommand } = useTauri()
        const updated = await invokeCommand<AppSettings>('update_settings', { settings: updates })
        this.settings = updated
        return updated
      } catch (error) {
        this.error = error instanceof Error ? error.message : 'Failed to update settings'
        console.error('Failed to update settings:', error)
        throw error
      } finally {
        this.loading = false
      }
    },

    /**
     * 設定をリセット
     */
    async resetSettings() {
      this.loading = true
      this.error = null

      try {
        const { invokeCommand } = useTauri()
        const defaultSettings = await invokeCommand<AppSettings>('reset_settings')
        this.settings = defaultSettings
        return defaultSettings
      } catch (error) {
        this.error = error instanceof Error ? error.message : 'Failed to reset settings'
        console.error('Failed to reset settings:', error)
        throw error
      } finally {
        this.loading = false
      }
    }
  }
})
```

---

## 確認事項

- [ ] ファイルが作成されたか
- [ ] 設定の読み込み・更新・リセットが実装されているか
- [ ] Tauri IPCと連携しているか
- [ ] AppSettings型が正しく使用されているか
- [ ] デフォルト値が適切に設定されているか

---

## 成果物

- `app/stores/settings.ts`

---

## ストア構成

### State
- `settings`: アプリケーション設定
  - `theme`: テーマ設定
  - `language`: 言語設定
  - `autoSave`: 自動保存の有効/無効
  - `windowRestore`: ウィンドウ復元の有効/無効
- `loading`: ローディング状態
- `error`: エラーメッセージ

### Getters
- `currentSettings`: 現在の設定
- `isAutoSaveEnabled`: 自動保存が有効か
- `isWindowRestoreEnabled`: ウィンドウ復元が有効か
- `currentLanguage`: 現在の言語

### Actions
- `loadSettings()`: 設定をロード
- `updateSettings(updates)`: 設定を更新
- `resetSettings()`: 設定をリセット

---

## Tauri IPCコマンド一覧

| コマンド名 | 引数 | 戻り値 |
|-----------|------|--------|
| `get_settings` | なし | `AppSettings` |
| `update_settings` | `{ settings }` | `AppSettings` |
| `reset_settings` | なし | `AppSettings` |

---

## 次のタスク

→ [2.2.5: securityストア移行](2.2.5_securityStore.md)
