# タスク1.5b.2.5.1: pages/connection-form.vue作成

**サブフェーズ**: 2.5 接続フォームページ
**工数**: 4時間
**優先度**: 高
**依存関係**: 2.2.1 (connectionストア), 2.3.1 (EnvironmentHeader), 2.5.2 (EnvironmentSelector)

---

## 目的

接続の作成・編集フォームページを実装

---

## 実装内容

### ファイル作成: `app/pages/connection-form.vue`

元の設計書の854-1063行目を参照してください。

**主要機能**:
1. 新規接続作成フォーム
2. 既存接続編集フォーム
3. 接続テスト機能
4. バリデーション
5. 環境選択
6. データベースタイプ選択

---

## 確認事項

- [ ] ページが作成されたか
- [ ] フォームが正しく動作するか
- [ ] 接続テスト機能が動作するか
- [ ] 作成・編集が正常に完了するか
- [ ] バリデーションが動作するか
- [ ] 編集モード時に既存データが読み込まれるか

---

## 成果物

- `app/pages/connection-form.vue`

---

## ページ構成

### 1. ヘッダー
- EnvironmentHeaderコンポーネント
- 選択した環境に応じたカラー

### 2. フォームタイトル
- 新規作成: "新規接続"
- 編集: "接続を編集"

### 3. フォームフィールド
- 接続名（必須）
- データベースタイプ（必須）
- 環境選択（必須）
- ホスト（必須）
- ポート（必須）
- データベース名（必須）
- ユーザー名（必須）
- パスワード（任意）

### 4. アクションボタン
- キャンセル
- 接続テスト
- 作成 / 更新

---

## 状態管理

```typescript
const form = reactive({
  name: '',
  type: 'mysql' as DatabaseType,
  environment: 'development' as Environment,
  host: 'localhost',
  port: 3306,
  username: '',
  database: '',
  password: ''
})

const loading = ref(false)
const testing = ref(false)
const testResult = ref<{ success: boolean; message: string } | null>(null)
```

---

## Computed Properties

| 名称 | 説明 |
|------|------|
| `isEditMode` | 編集モードかどうか（query.idの有無） |
| `connectionId` | 編集対象の接続ID |

---

## メソッド

| 名称 | 説明 |
|------|------|
| `testConnection()` | 接続テストを実行 |
| `submitForm()` | フォームを送信（作成 or 更新） |

---

## ライフサイクル

```typescript
onMounted(async () => {
  if (isEditMode.value) {
    // 既存接続データを読み込み
    const connection = connectionStore.getConnectionById(connectionId.value)
    if (connection) {
      Object.assign(form, connection)
    }
  }
})
```

---

## バリデーション

- 必須フィールドのチェック
- ポート番号の範囲チェック（1-65535）
- ホスト名の形式チェック

---

## 接続テスト

1. テストボタンクリック
2. `testing = true`
3. Tauri IPC経由でバックエンドに接続テスト要求
4. 結果を`testResult`に格納
5. 成功/失敗メッセージを表示

---

## フォーム送信

1. バリデーション実行
2. `loading = true`
3. 編集モード: `updateConnection()`
4. 新規モード: `createConnection()`
5. 成功時: ランチャーページへ遷移
6. 失敗時: エラーメッセージ表示

---

## 次のタスク

→ [2.5.2: EnvironmentSelector.vue作成](2.5.2_EnvironmentSelector.md)
