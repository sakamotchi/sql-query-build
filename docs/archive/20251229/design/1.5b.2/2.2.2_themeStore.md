# タスク1.5b.2.2.2: themeストア移行

**サブフェーズ**: 2.2 Piniaストア移行
**工数**: 1.5時間
**優先度**: 中
**依存関係**: 2.1.3 (型定義)

---

## 目的

テーマ設定の永続化を実装

---

## 実装内容

### ファイル作成: `app/stores/theme.ts`

```typescript
import { defineStore } from 'pinia'
import type { ColorMode } from '~/types'

export const useThemeStore = defineStore('theme', {
  state: () => ({
    colorMode: 'auto' as ColorMode,
    primaryColor: '#4CAF50',
    loading: false,
    error: null as string | null
  }),

  getters: {
    /**
     * 現在のカラーモード
     */
    currentColorMode: (state) => state.colorMode,

    /**
     * 現在のプライマリカラー
     */
    currentPrimaryColor: (state) => state.primaryColor
  },

  actions: {
    /**
     * テーマ設定をロード
     */
    async loadTheme() {
      this.loading = true
      this.error = null

      try {
        const { invokeCommand } = useTauri()
        const theme = await invokeCommand<{ colorMode: ColorMode; primaryColor: string }>('get_theme')
        if (theme) {
          this.colorMode = theme.colorMode
          this.primaryColor = theme.primaryColor
        }
      } catch (error) {
        this.error = error instanceof Error ? error.message : 'Failed to load theme'
        console.error('Failed to load theme:', error)
      } finally {
        this.loading = false
      }
    },

    /**
     * カラーモードを設定
     */
    async setColorMode(mode: ColorMode) {
      this.loading = true
      this.error = null

      try {
        const { invokeCommand } = useTauri()
        await invokeCommand('set_color_mode', { mode })
        this.colorMode = mode
      } catch (error) {
        this.error = error instanceof Error ? error.message : 'Failed to set color mode'
        console.error('Failed to set color mode:', error)
        throw error
      } finally {
        this.loading = false
      }
    },

    /**
     * プライマリカラーを設定
     */
    async setPrimaryColor(color: string) {
      this.loading = true
      this.error = null

      try {
        const { invokeCommand } = useTauri()
        await invokeCommand('set_primary_color', { color })
        this.primaryColor = color
      } catch (error) {
        this.error = error instanceof Error ? error.message : 'Failed to set primary color'
        console.error('Failed to set primary color:', error)
        throw error
      } finally {
        this.loading = false
      }
    }
  }
})
```

---

## 確認事項

- [ ] ファイルが作成されたか
- [ ] テーマ設定の読み込み・保存が実装されているか
- [ ] Tauri IPCと連携しているか
- [ ] ColorMode型が正しく使用されているか

---

## 成果物

- `app/stores/theme.ts`

---

## ストア構成

### State
- `colorMode`: カラーモード(light/dark/auto)
- `primaryColor`: プライマリカラー
- `loading`: ローディング状態
- `error`: エラーメッセージ

### Getters
- `currentColorMode`: 現在のカラーモード
- `currentPrimaryColor`: 現在のプライマリカラー

### Actions
- `loadTheme()`: テーマ設定をロード
- `setColorMode(mode)`: カラーモードを設定
- `setPrimaryColor(color)`: プライマリカラーを設定

---

## Tauri IPCコマンド一覧

| コマンド名 | 引数 | 戻り値 |
|-----------|------|--------|
| `get_theme` | なし | `{ colorMode, primaryColor }` |
| `set_color_mode` | `{ mode }` | `void` |
| `set_primary_color` | `{ color }` | `void` |

---

## 次のタスク

→ [2.2.3: windowストア移行](2.2.3_windowStore.md)
