# Phase 3 タスクリスト: サブクエリビルダーUI

**フェーズ目標**: スカラーサブクエリを含むクエリをGUIで構築できるUIの実装

**前提条件**: Phase 2が完了している

**状態**: 📝 未着手

---

## タスク一覧

### 1. サブクエリビルダーUI

| ID | タスク | 状態 | 優先度 | 見積もり |
|----|--------|------|--------|---------|
| T1.1 | SubqueryBuilder.vueコンポーネント作成 | ⬜ 未着手 | 必須 | 大 |
| T1.2 | ミニクエリビルダーUI実装 | ⬜ 未着手 | 必須 | 大 |
| T1.3 | FROM句のテーブル選択UI | ⬜ 未着手 | 必須 | 中 |
| T1.4 | SELECT句のカラム選択UI（単一カラム制限） | ⬜ 未着手 | 必須 | 中 |
| T1.5 | WHERE句の条件設定UI | ⬜ 未着手 | 必須 | 中 |
| T1.6 | サブクエリプレビュー表示 | ⬜ 未着手 | 必須 | 中 |
| T1.7 | エイリアス入力フィールド | ⬜ 未着手 | 必須 | 小 |

**依存関係**: Phase 2完了

---

### 2. 相関サブクエリのサポート

| ID | タスク | 状態 | 優先度 | 見積もり |
|----|--------|------|--------|---------|
| T2.1 | 外部クエリのテーブル情報を取得 | ⬜ 未着手 | 必須 | 中 |
| T2.2 | 外部クエリのカラムを参照するUI | ⬜ 未着手 | 必須 | 中 |
| T2.3 | 相関カラムの表示（特別なアイコン等） | ⬜ 未着手 | 中 | 小 |
| T2.4 | 相関サブクエリのSQL生成 | ⬜ 未着手 | 必須 | 中 |

**依存関係**: T1系（サブクエリビルダー基本実装後）

---

### 3. 集計サブクエリのサポート

| ID | タスク | 状態 | 優先度 | 見積もり |
|----|--------|------|--------|---------|
| T3.1 | サブクエリ内での集計関数選択UI | ⬜ 未着手 | 必須 | 中 |
| T3.2 | COUNT, SUM, AVG, MIN, MAX サポート | ⬜ 未着手 | 必須 | 小 |
| T3.3 | GROUP BY句のサポート（サブクエリ内） | ⬜ 未着手 | 中 | 中 |

**依存関係**: T1系

---

### 4. バリデーション

| ID | タスク | 状態 | 優先度 | 見積もり |
|----|--------|------|--------|---------|
| T4.1 | スカラー値チェック（SELECTが単一カラムか） | ⬜ 未着手 | 高 | 中 |
| T4.2 | 循環参照の検出 | ⬜ 未着手 | 中 | 大 |
| T4.3 | サブクエリの深さ制限（最大3レベル） | ⬜ 未着手 | 中 | 小 |
| T4.4 | テーブル存在チェック | ⬜ 未着手 | 中 | 小 |

**依存関係**: T1系

---

### 5. 式ツリーへの統合

| ID | タスク | 状態 | 優先度 | 見積もり |
|----|--------|------|--------|---------|
| T5.1 | SubqueryExpression型への変換 | ⬜ 未着手 | 必須 | 中 |
| T5.2 | ネストしたQueryModelの構築 | ⬜ 未着手 | 必須 | 中 |
| T5.3 | サブクエリのSQL生成（括弧付き） | ⬜ 未着手 | 必須 | 小 |

**依存関係**: T1系, T2系

---

### 6. UI統合

| ID | タスク | 状態 | 優先度 | 見積もり |
|----|--------|------|--------|---------|
| T6.1 | SelectTabへの統合 | ⬜ 未着手 | 必須 | 小 |
| T6.2 | 関数ビルダーの引数としてサブクエリを選択可能に | ⬜ 未着手 | 高 | 中 |
| T6.3 | サブクエリの編集機能 | ⬜ 未着手 | 必須 | 中 |
| T6.4 | サブクエリの削除機能 | ⬜ 未着手 | 必須 | 小 |

**依存関係**: T5系

---

### 7. パフォーマンス最適化

| ID | タスク | 状態 | 優先度 | 見積もり |
|----|--------|------|--------|---------|
| T7.1 | サブクエリプレビューの遅延更新 | ⬜ 未着手 | 中 | 小 |
| T7.2 | テーブル/カラム情報のキャッシュ | ⬜ 未着手 | 中 | 中 |

**依存関係**: 基本実装完了後

---

### 8. テスト

| ID | タスク | 状態 | 優先度 | 見積もり |
|----|--------|------|--------|---------|
| T8.1 | SubqueryBuilderコンポーネントの単体テスト | ⬜ 未着手 | 必須 | 中 |
| T8.2 | バリデーションのテスト | ⬜ 未着手 | 必須 | 中 |
| T8.3 | 相関サブクエリのSQL生成テスト | ⬜ 未着手 | 必須 | 中 |
| T8.4 | E2Eテスト（サブクエリ→SQL生成→実行） | ⬜ 未着手 | 必須 | 大 |
| T8.5 | リグレッションテスト | ⬜ 未着手 | 必須 | 中 |
| T8.6 | パフォーマンステスト | ⬜ 未着手 | 中 | 中 |

**依存関係**: 各実装タスク完了後

---

### 9. ドキュメント

| ID | タスク | 状態 | 優先度 | 見積もり |
|----|--------|------|--------|---------|
| T9.1 | サブクエリの使用例ドキュメント | ⬜ 未着手 | 高 | 中 |
| T9.2 | features/query-builder.md更新 | ⬜ 未着手 | 高 | 小 |
| T9.3 | 永続化ドキュメントの更新 | ⬜ 未着手 | 必須 | 中 |
| T9.4 | プロジェクト完了レポート作成 | ⬜ 未着手 | 高 | 中 |

**依存関係**: 実装完了後

---

## 進捗サマリー

| カテゴリ | 完了 | 進行中 | 未着手 | 合計 |
|---------|------|--------|--------|------|
| ビルダーUI | 0 | 0 | 7 | 7 |
| 相関サブクエリ | 0 | 0 | 4 | 4 |
| 集計サブクエリ | 0 | 0 | 3 | 3 |
| バリデーション | 0 | 0 | 4 | 4 |
| 式ツリー統合 | 0 | 0 | 3 | 3 |
| UI統合 | 0 | 0 | 4 | 4 |
| パフォーマンス | 0 | 0 | 2 | 2 |
| テスト | 0 | 0 | 6 | 6 |
| ドキュメント | 0 | 0 | 4 | 4 |
| **合計** | **0** | **0** | **37** | **37** |

---

## 完了条件

- [ ] すべてのタスクが完了している
- [ ] スカラーサブクエリが構築可能
- [ ] 相関サブクエリが構築可能
- [ ] 集計関数を含むサブクエリが構築可能
- [ ] バリデーションが適切に動作
- [ ] E2Eテストが全て合格
- [ ] ドキュメントが更新されている
- [ ] testing.mdのテスト手順が全て完了
- [ ] プロジェクト完了レポートが作成されている

---

## プロジェクト完了後のタスク

### 永続化ドキュメントの更新

以下のドキュメントを更新する必要があります：

- [ ] `docs/02_functional_design.md` - SELECT句拡張機能の追加
- [ ] `docs/03_architecture_specifications.md` - ExpressionNode型の追加
- [ ] `docs/06_ubiquitous_language.md` - 新しい用語の追加
- [ ] `docs/features/query-builder.md` - 詳細仕様の更新

### アーカイブ

- [ ] `docs/projects/select-clause-extension/` を `docs/archive/projects/` に移動（または残す）
- [ ] 完了レポートを作成し、プロジェクトをクローズ

---

## 備考

### サブクエリの制限事項（Phase 3）

- SELECT句でのスカラーサブクエリのみサポート
- FROM句のサブクエリ（派生テーブル）は対象外
- ウィンドウ関数との組み合わせは対象外

### 将来の拡張候補

- FROM句のサブクエリ対応
- サブクエリのネスト深度拡張（現在3レベル）
- サブクエリのパフォーマンス分析ツール
- サブクエリの自動最適化（JOINへの変換提案等）
