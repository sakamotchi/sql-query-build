# Phase 2 タスクリスト: 関数ビルダーUI

**フェーズ目標**: よく使う関数をGUIで構築できるUIの実装

**前提条件**: Phase 1が完了している

**状態**: 📝 未着手

---

## タスク一覧

### 1. 関数マスターデータ

| ID | タスク | 状態 | 優先度 | 見積もり |
|----|--------|------|--------|---------|
| T1.1 | database-functions.ts作成（関数定義マスター） | ⬜ 未着手 | 必須 | 中 |
| T1.2 | 文字列関数の定義（UPPER, LOWER, CONCAT等） | ⬜ 未着手 | 必須 | 中 |
| T1.3 | 日付関数の定義（NOW, DATE_FORMAT等） | ⬜ 未着手 | 必須 | 中 |
| T1.4 | 数値関数の定義（ROUND, CEIL等） | ⬜ 未着手 | 必須 | 小 |
| T1.5 | 条件関数の定義（COALESCE, NULLIF等） | ⬜ 未着手 | 必須 | 小 |
| T1.6 | データベース種別ごとの関数マッピング | ⬜ 未着手 | 必須 | 中 |

**依存関係**: Phase 1完了

---

### 2. 関数ビルダーUI

| ID | タスク | 状態 | 優先度 | 見積もり |
|----|--------|------|--------|---------|
| T2.1 | FunctionBuilder.vueコンポーネント作成 | ⬜ 未着手 | 必須 | 大 |
| T2.2 | 関数カテゴリ選択UI実装 | ⬜ 未着手 | 必須 | 小 |
| T2.3 | 関数選択ドロップダウン実装 | ⬜ 未着手 | 必須 | 中 |
| T2.4 | 関数の説明表示 | ⬜ 未着手 | 中 | 小 |
| T2.5 | 引数リストUI実装 | ⬜ 未着手 | 必須 | 大 |
| T2.6 | 引数の型選択（カラム/リテラル/関数/サブクエリ） | ⬜ 未着手 | 必須 | 中 |
| T2.7 | カラム選択ドロップダウン | ⬜ 未着手 | 必須 | 小 |
| T2.8 | リテラル値入力フィールド | ⬜ 未着手 | 必須 | 小 |
| T2.9 | ネストした関数の追加（再帰的UI） | ⬜ 未着手 | 高 | 大 |
| T2.10 | 関数プレビュー表示 | ⬜ 未着手 | 必須 | 中 |
| T2.11 | エイリアス入力フィールド | ⬜ 未着手 | 必須 | 小 |

**依存関係**: T1系（関数マスター完了後）

---

### 3. 引数ビルダー

| ID | タスク | 状態 | 優先度 | 見積もり |
|----|--------|------|--------|---------|
| T3.1 | ArgumentBuilder.vueコンポーネント作成 | ⬜ 未着手 | 必須 | 中 |
| T3.2 | 引数の追加/削除機能 | ⬜ 未着手 | 必須 | 小 |
| T3.3 | 引数の並び替え（ドラッグ&ドロップ） | ⬜ 未着手 | 中 | 中 |
| T3.4 | 引数の型に応じた入力UI切り替え | ⬜ 未着手 | 必須 | 中 |
| T3.5 | 必須/任意引数の表示 | ⬜ 未着手 | 中 | 小 |

**依存関係**: T2系（関数ビルダー実装中に並行可）

---

### 4. データベース方言対応UI

| ID | タスク | 状態 | 優先度 | 見積もり |
|----|--------|------|--------|---------|
| T4.1 | 現在接続中のDB種別に応じた関数フィルタリング | ⬜ 未着手 | 高 | 中 |
| T4.2 | 非対応関数の警告表示 | ⬜ 未着手 | 中 | 小 |
| T4.3 | 方言の違いの説明表示 | ⬜ 未着手 | 低 | 小 |

**依存関係**: T2系

---

### 5. 式ツリーへの変換

| ID | タスク | 状態 | 優先度 | 見積もり |
|----|--------|------|--------|---------|
| T5.1 | UIから式ツリーへの変換ロジック | ⬜ 未着手 | 必須 | 中 |
| T5.2 | ネストした関数の式ツリー構築 | ⬜ 未着手 | 必須 | 中 |
| T5.3 | バリデーション（引数の数、型チェック） | ⬜ 未着手 | 高 | 中 |

**依存関係**: T2系

---

### 6. 統合とストア更新

| ID | タスク | 状態 | 優先度 | 見積もり |
|----|--------|------|--------|---------|
| T6.1 | SelectTabへの統合 | ⬜ 未着手 | 必須 | 小 |
| T6.2 | ストアアクションの更新 | ⬜ 未着手 | 必須 | 小 |
| T6.3 | 式入力モード/関数ビルダーモードの切り替え | ⬜ 未着手 | 中 | 中 |

**依存関係**: T5系

---

### 7. テスト

| ID | タスク | 状態 | 優先度 | 見積もり |
|----|--------|------|--------|---------|
| T7.1 | 関数マスターの単体テスト | ⬜ 未着手 | 必須 | 小 |
| T7.2 | FunctionBuilderコンポーネントの単体テスト | ⬜ 未着手 | 必須 | 中 |
| T7.3 | 式ツリー変換のテスト | ⬜ 未着手 | 必須 | 中 |
| T7.4 | E2Eテスト（関数ビルダー→SQL生成→実行） | ⬜ 未着手 | 必須 | 大 |
| T7.5 | リグレッションテスト | ⬜ 未着手 | 必須 | 中 |

**依存関係**: 各実装タスク完了後

---

### 8. ドキュメント

| ID | タスク | 状態 | 優先度 | 見積もり |
|----|--------|------|--------|---------|
| T8.1 | 関数マスターのドキュメント | ⬜ 未着手 | 高 | 小 |
| T8.2 | features/query-builder.md更新 | ⬜ 未着手 | 高 | 小 |
| T8.3 | ユーザーガイド作成 | ⬜ 未着手 | 中 | 中 |

**依存関係**: 実装完了後

---

## 進捗サマリー

| カテゴリ | 完了 | 進行中 | 未着手 | 合計 |
|---------|------|--------|--------|------|
| 関数マスター | 0 | 0 | 6 | 6 |
| ビルダーUI | 0 | 0 | 11 | 11 |
| 引数ビルダー | 0 | 0 | 5 | 5 |
| 方言対応UI | 0 | 0 | 3 | 3 |
| 式ツリー変換 | 0 | 0 | 3 | 3 |
| 統合 | 0 | 0 | 3 | 3 |
| テスト | 0 | 0 | 5 | 5 |
| ドキュメント | 0 | 0 | 3 | 3 |
| **合計** | **0** | **0** | **39** | **39** |

---

## 完了条件

- [ ] すべてのタスクが完了している
- [ ] よく使う関数（20種類以上）がGUIで構築可能
- [ ] ネストした関数が構築可能
- [ ] 3つのデータベースで関数が正しく動作
- [ ] E2Eテストが全て合格
- [ ] ドキュメントが更新されている
- [ ] testing.mdのテスト手順が全て完了

---

## 備考

### サポートする関数の優先順位

**Phase 2で必ずサポート**:
- UPPER, LOWER, CONCAT, SUBSTRING, LENGTH (文字列)
- NOW, CURRENT_DATE, DATE_FORMAT (日付)
- ROUND, CEIL, FLOOR (数値)
- COALESCE, NULLIF (条件)

**Phase 3以降で追加検討**:
- TRIM, REPLACE, LPAD, RPAD (文字列)
- EXTRACT, DATE_ADD, DATE_SUB (日付)
- ABS, POWER, SQRT (数値)
- CASE WHEN (条件)
