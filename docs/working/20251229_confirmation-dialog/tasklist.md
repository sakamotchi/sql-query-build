# タスクリスト: 確認ダイアログ

**作成日**: 2025年12月29日
**WBS参照**: Phase 3.2 確認ダイアログ

---

## タスク一覧

| タスクID | タスク名 | 状態 | 依存 | 完了条件 |
|---------|---------|------|------|---------|
| 3.2.1 | DangerousQueryDialog.vue作成 | 📝 未着手 | 3.1完了 | 2段階確認ダイアログが表示される |
| 3.2.2 | 遅延実行ボタン実装 | 📝 未着手 | 3.2.1 | 3秒待機後に有効化される |
| 3.2.3 | QueryBuilderToolbar統合 | 📝 未着手 | 3.2.2 | 実行ボタンからダイアログ表示 |
| 3.2.4 | テストコード作成 | 📝 未着手 | 3.2.3 | 全テストがパス |
| 3.2.5 | 手動テスト・動作確認 | 📝 未着手 | 3.2.4 | 要件を満たすことを確認 |

---

## 詳細タスク

### 3.2.1 DangerousQueryDialog.vue作成

**概要**: 危険なクエリ実行時の確認ダイアログコンポーネントを作成

**作業内容**:
1. `app/components/query-builder/dialog/` ディレクトリ作成
2. `DangerousQueryDialog.vue` コンポーネント作成
3. Props定義（analysisResult, sql）
4. Emits定義（confirm, cancel）
5. UModalを使用したダイアログUI実装
6. 危険度バッジ表示
7. RiskFactor（警告メッセージ）表示
8. 影響テーブル表示
9. SQL表示

**完了条件**:
- [x] コンポーネントファイルが作成されている
- [ ] PropsとEmitsが正しく定義されている
- [ ] UModalでダイアログが表示される
- [ ] 危険度に応じた色分けがされる

---

### 3.2.2 遅延実行ボタン実装

**概要**: Dangerレベル時に3秒カウントダウン後に有効化されるボタン

**作業内容**:
1. カウントダウンロジック実装
2. ボタン無効化制御
3. カウントダウン表示（"実行する (3秒待機)"）
4. タイマークリーンアップ

**完了条件**:
- [ ] Dangerレベルで3秒カウントダウンが表示される
- [ ] カウントダウン中はボタンが無効
- [ ] Warningレベルでは即座に有効
- [ ] ダイアログを閉じるとタイマーがリセットされる

---

### 3.2.3 QueryBuilderToolbar統合

**概要**: 既存の実行ボタンに確認ダイアログ表示ロジックを統合

**作業内容**:
1. DangerousQueryDialogのimport追加
2. showConfirmDialog状態の追加
3. handleExecuteClick関数の実装
4. riskLevel判定ロジック
5. confirmハンドラ実装
6. cancelハンドラ実装
7. テンプレートへのダイアログコンポーネント追加

**完了条件**:
- [ ] Safe時は直接実行される
- [ ] Warning/Danger時はダイアログが表示される
- [ ] 確認後にクエリが実行される
- [ ] キャンセルで実行されない

---

### 3.2.4 テストコード作成

**概要**: DangerousQueryDialogのユニットテスト

**作業内容**:
1. テストファイル作成
2. Dangerレベルのカウントダウンテスト
3. Warningレベルの即時有効テスト
4. 危険度バッジ表示テスト
5. 確認/キャンセルイベントテスト

**完了条件**:
- [ ] テストファイルが作成されている
- [ ] 全テストがパスする
- [ ] カバレッジが80%以上

---

### 3.2.5 手動テスト・動作確認

**概要**: 実際のアプリケーションでの動作確認

**作業内容**:
1. `npm run tauri:dev` でアプリ起動
2. DELETE文（WHERE なし）でダイアログ確認
3. UPDATE文（WHERE あり）でダイアログ確認
4. SELECT文でダイアログなし確認
5. カウントダウン動作確認
6. キャンセル動作確認
7. Escapeキー動作確認

**完了条件**:
- [ ] testing.md の全項目が確認済み

---

## 進捗状況

- **開始日**: -
- **完了日**: -
- **進捗率**: 0%

| 状態 | 件数 |
|------|------|
| 📝 未着手 | 5 |
| 🔄 進行中 | 0 |
| ✅ 完了 | 0 |
| ❌ ブロック | 0 |

---

## 備考

- Phase 3.1（クエリ種別検出）が完了していることが前提
- 既存のanalysisResult, executeQueryをそのまま活用
- UModalコンポーネントを使用（Nuxt UI v4）
