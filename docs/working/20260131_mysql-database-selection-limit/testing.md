# テスト手順書 - MySQLデータベース選択機能の制限対応

## 概要

本テスト手順書では、MySQLデータベース選択機能の制限対応について、手動操作による動作確認手順を記載します。

## テスト環境

### 必要な環境

- **MySQL接続**: `demo_ecommerce`と`benchmark_small`の両方のデータベースが存在する接続
- **PostgreSQL接続**: 複数のスキーマ（`public`, `test`など）が存在する接続
- **SQLite接続**: 任意のSQLiteデータベース

### 準備

1. Tauriアプリを起動: `npm run tauri:dev`
2. 各データベースタイプの接続を作成済みであることを確認

## テストケース

### TC-1: MySQL - デフォルトデータベースの表示確認

**目的**: MySQLの場合、デフォルトデータベース名が読み取り専用で表示されることを確認する

**前提条件**:
- MySQL接続が作成されている
- 接続設定で`database`フィールドに`demo_ecommerce`が設定されている

**手順**:

1. ランチャー画面でMySQL接続カードをクリック
2. SQLエディタ画面が開く
3. ツールバーのデータベース表示部分を確認

**期待結果**:

- [ ] データベース名として`demo_ecommerce`が表示されている
- [ ] ロックアイコンが表示されている
- [ ] データベース名の部分をクリックしてもドロップダウンが開かない（読み取り専用）
- [ ] ホバー時にツールチップが表示される
  - 日本語: 「MySQLではデフォルトデータベースのみ使用可能です。他のデータベースにアクセスする場合は、完全修飾名（database.table）を使用してください。」
  - 英語: 「MySQL uses the default database specified in the connection. To access other databases, use fully qualified names (database.table).」

### TC-2: MySQL - デフォルトデータベースへのクエリ実行

**目的**: MySQLのデフォルトデータベースに対してクエリが正常に実行できることを確認する

**前提条件**:
- TC-1が成功している
- `demo_ecommerce`データベースに`carts`テーブルが存在する

**手順**:

1. SQLエディタに以下のSQLを入力:
   ```sql
   SELECT * FROM carts LIMIT 10
   ```
2. 実行ボタンをクリック

**期待結果**:

- [ ] クエリが正常に実行される
- [ ] `demo_ecommerce.carts`テーブルの結果が表示される
- [ ] エラーが発生しない

### TC-3: MySQL - 完全修飾名での他データベースへのアクセス

**目的**: MySQLで完全修飾名を使用して他のデータベースにアクセスできることを確認する

**前提条件**:
- TC-1が成功している
- `benchmark_small`データベースに`table_1`テーブルが存在する
- デフォルトデータベースは`demo_ecommerce`

**手順**:

1. SQLエディタに以下のSQLを入力:
   ```sql
   SELECT * FROM benchmark_small.table_1 LIMIT 10
   ```
2. 実行ボタンをクリック

**期待結果**:

- [ ] クエリが正常に実行される
- [ ] `benchmark_small.table_1`テーブルの結果が表示される
- [ ] エラーが発生しない

### TC-4: MySQL - 他データベースのテーブルを完全修飾なしで実行時のエラー

**目的**: MySQLで他のデータベースのテーブルを完全修飾なしで実行するとエラーになることを確認する

**前提条件**:
- TC-1が成功している
- デフォルトデータベースは`demo_ecommerce`
- `demo_ecommerce`に`table_1`テーブルは存在しない

**手順**:

1. SQLエディタに以下のSQLを入力:
   ```sql
   SELECT * FROM table_1 LIMIT 10
   ```
2. 実行ボタンをクリック

**期待結果**:

- [ ] エラーが発生する
- [ ] エラーメッセージに「Table 'demo_ecommerce.table_1' doesn't exist」のような内容が表示される

### TC-5: PostgreSQL - スキーマ選択ドロップダウンの表示確認

**目的**: PostgreSQLの場合、スキーマ選択ドロップダウンが表示されることを確認する

**前提条件**:
- PostgreSQL接続が作成されている
- 複数のスキーマ（`public`, `test`など）が存在する

**手順**:

1. ランチャー画面でPostgreSQL接続カードをクリック
2. SQLエディタ画面が開く
3. ツールバーのデータベース選択部分を確認

**期待結果**:

- [ ] スキーマ選択ドロップダウンが表示されている
- [ ] デフォルトで`public`スキーマが選択されている
- [ ] ドロップダウンをクリックすると利用可能なスキーマ一覧が表示される
- [ ] 検索可能（searchable）である
- [ ] クリアボタン（clearable）が表示される

### TC-6: PostgreSQL - スキーマ選択とクエリ実行

**目的**: PostgreSQLでスキーマを選択し、そのスキーマに対してクエリが実行できることを確認する

**前提条件**:
- TC-5が成功している
- `public`スキーマに`users`テーブルが存在する
- `test`スキーマに`test_table`テーブルが存在する

**手順**:

1. スキーマドロップダウンから`public`を選択
2. SQLエディタに以下のSQLを入力:
   ```sql
   SELECT * FROM users LIMIT 10
   ```
3. 実行ボタンをクリック
4. スキーマドロップダウンから`test`を選択
5. SQLエディタに以下のSQLを入力:
   ```sql
   SELECT * FROM test_table LIMIT 10
   ```
6. 実行ボタンをクリック

**期待結果**:

- [ ] `public`スキーマ選択時、`public.users`テーブルの結果が表示される
- [ ] `test`スキーマ選択時、`test.test_table`テーブルの結果が表示される
- [ ] それぞれエラーが発生しない

### TC-7: PostgreSQL - SET search_path文の自動追加確認

**目的**: PostgreSQLでスキーマを選択した場合、SET search_path文が自動的に追加されることを確認する

**前提条件**:
- TC-5が成功している
- ブラウザの開発者ツールでコンソールログを確認できる状態

**手順**:

1. スキーマドロップダウンから`test`を選択
2. SQLエディタに以下のSQLを入力:
   ```sql
   SELECT * FROM test_table LIMIT 10
   ```
3. 開発者ツールのコンソールを開く
4. 実行ボタンをクリック
5. Rustバックエンドのログ（ターミナル）を確認

**期待結果**:

- [ ] バックエンドに送信されるSQLに`SET search_path TO "test";`が含まれている
- [ ] その後に元のSELECT文が実行されている

**注**: この確認は開発時のみ実施。本番環境では不要。

### TC-8: SQLite - データベースセレクターが非表示

**目的**: SQLiteの場合、データベースセレクターが表示されないことを確認する

**前提条件**:
- SQLite接続が作成されている

**手順**:

1. ランチャー画面でSQLite接続カードをクリック
2. SQLエディタ画面が開く
3. ツールバーを確認

**期待結果**:

- [ ] データベースセレクター（ドロップダウンまたは読み取り専用表示）が表示されない
- [ ] ツールバーのレイアウトが正常に表示される

### TC-9: SQLite - クエリ実行

**目的**: SQLiteでクエリが正常に実行できることを確認する

**前提条件**:
- TC-8が成功している
- SQLiteデータベースにテーブルが存在する

**手順**:

1. SQLエディタに以下のSQLを入力:
   ```sql
   SELECT * FROM sqlite_master WHERE type='table'
   ```
2. 実行ボタンをクリック

**期待結果**:

- [ ] クエリが正常に実行される
- [ ] テーブル一覧が表示される
- [ ] エラーが発生しない

### TC-10: 多言語切り替え - 日本語表示

**目的**: 日本語表示時に翻訳が正しく表示されることを確認する

**前提条件**:
- アプリの言語設定が日本語になっている

**手順**:

1. 設定画面から言語を「日本語」に設定
2. MySQL接続でSQLエディタを開く
3. データベース表示部分のツールチップを確認
4. PostgreSQL接続でSQLエディタを開く
5. スキーマ選択ドロップダウンのプレースホルダーを確認

**期待結果**:

- [ ] MySQLのツールチップが日本語で表示される
- [ ] PostgreSQLのプレースホルダーが「スキーマを選択」と表示される
- [ ] すべてのUI要素が日本語で表示される

### TC-11: 多言語切り替え - 英語表示

**目的**: 英語表示時に翻訳が正しく表示されることを確認する

**前提条件**:
- アプリの言語設定が英語になっている

**手順**:

1. 設定画面から言語を「English」に設定
2. MySQL接続でSQLエディタを開く
3. データベース表示部分のツールチップを確認
4. PostgreSQL接続でSQLエディタを開く
5. スキーマ選択ドロップダウンのプレースホルダーを確認

**期待結果**:

- [ ] MySQLのツールチップが英語で表示される
- [ ] PostgreSQLのプレースホルダーが「Select schema」と表示される
- [ ] すべてのUI要素が英語で表示される

### TC-12: タブ切り替え時の状態保持

**目的**: タブを切り替えても選択されたデータベース/スキーマが保持されることを確認する

**前提条件**:
- PostgreSQL接続でSQLエディタを開いている

**手順**:

1. スキーマドロップダウンから`test`を選択
2. 「新規タブ」ボタンをクリックして新しいタブを作成
3. 新しいタブでスキーマドロップダウンから`public`を選択
4. 最初のタブに戻る
5. スキーマ選択状態を確認
6. 2番目のタブに切り替える
7. スキーマ選択状態を確認

**期待結果**:

- [ ] 最初のタブでは`test`スキーマが選択されている
- [ ] 2番目のタブでは`public`スキーマが選択されている
- [ ] タブごとに独立した状態が保持されている

### TC-13: 接続切り替え時の初期化

**目的**: 別の接続に切り替えた時、適切に初期化されることを確認する

**前提条件**:
- MySQL接続とPostgreSQL接続の両方が作成されている

**手順**:

1. MySQL接続でSQLエディタを開く
2. データベース表示を確認
3. ランチャー画面に戻る
4. PostgreSQL接続でSQLエディタを開く
5. スキーマ選択ドロップダウンを確認

**期待結果**:

- [ ] MySQLからPostgreSQLに切り替えた時、スキーマドロップダウンが表示される
- [ ] PostgreSQLのデフォルトスキーマ（`public`）が選択されている
- [ ] 前の接続の状態が残っていない

## エッジケースのテスト

### EC-1: デフォルトデータベースが設定されていない場合

**目的**: MySQL接続でデフォルトデータベースが設定されていない場合の動作を確認する

**前提条件**:
- MySQL接続設定で`database`フィールドが空または未設定

**手順**:

1. MySQL接続でSQLエディタを開く
2. データベース表示部分を確認

**期待結果**:

- [ ] データベース表示部分が非表示になる、または適切なメッセージが表示される
- [ ] アプリがクラッシュしない

### EC-2: 存在しないスキーマを選択した場合

**目的**: PostgreSQLで存在しないスキーマを選択した場合の動作を確認する

**前提条件**:
- PostgreSQL接続でSQLエディタを開いている

**手順**:

1. データベース構造を削除して、スキーマが存在しない状態にする
2. スキーマドロップダウンを確認

**期待結果**:

- [ ] スキーマ一覧が空になる、または適切なメッセージが表示される
- [ ] アプリがクラッシュしない

## テスト結果サマリー

| テストケース | 結果 | 備考 |
|------------|------|------|
| TC-1: MySQL - デフォルトDB表示 | ⬜ | |
| TC-2: MySQL - デフォルトDBクエリ | ⬜ | |
| TC-3: MySQL - 完全修飾名アクセス | ⬜ | |
| TC-4: MySQL - エラー確認 | ⬜ | |
| TC-5: PostgreSQL - ドロップダウン表示 | ⬜ | |
| TC-6: PostgreSQL - スキーマ選択 | ⬜ | |
| TC-7: PostgreSQL - SET文確認 | ⬜ | |
| TC-8: SQLite - 非表示 | ⬜ | |
| TC-9: SQLite - クエリ実行 | ⬜ | |
| TC-10: 多言語 - 日本語 | ⬜ | |
| TC-11: 多言語 - 英語 | ⬜ | |
| TC-12: タブ切り替え | ⬜ | |
| TC-13: 接続切り替え | ⬜ | |
| EC-1: デフォルトDB未設定 | ⬜ | |
| EC-2: 存在しないスキーマ | ⬜ | |

**凡例**:
- ⬜ 未実施
- ✅ 合格
- ❌ 不合格

## 不具合報告

テスト中に発見した不具合をここに記録します。

| ID | テストケース | 内容 | 重要度 | 状態 |
|----|------------|------|--------|------|
| - | - | - | - | - |

## 備考

- 本テストは手動操作による確認を中心としています
- 自動テストが必要な場合は、Vitestを使用した単体テストを別途実装してください
- パフォーマンステストは本実装では対象外です
