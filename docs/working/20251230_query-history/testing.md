# テスト計画: クエリ履歴機能

**作成日**: 2025年12月30日
**対象機能**: クエリ履歴 (Phase 4.3)

---

## 1. 概要

本ドキュメントは、クエリ履歴機能のテスト手順と期待される結果をまとめたものです。

## 2. テスト環境

- OS: macOS
- ブラウザ: 組み込みWebview / Chrome
- データベース: ローカルまたはリモートの検証用データベース (PostgreSQL/MySQL/SQLite)

## 3. テスト項目

### 3.1 履歴の記録

| ID | テストケース | 手順 | 期待される結果 | 備考 |
|----|------------|------|---------------|------|
| TC-1 | クエリ実行成功時の記録 | 1. 任意のクエリを実行し成功させる<br>2. 履歴パネルを開く | 履歴リストの先頭に実行したクエリが表示されること。<br>バッジが「成功」であること。<br>行数と実行時間が表示されること。 | |
| TC-2 | クエリ実行失敗時の記録 | 1. 構文エラーになるクエリを実行する<br>2. 履歴パネルを開く | 履歴リストの先頭に実行したクエリが表示されること。<br>バッジが「失敗」であること。 | |

### 3.2 履歴の表示・検索

| ID | テストケース | 手順 | 期待される結果 | 備考 |
|----|------------|------|---------------|------|
| TC-3 | 履歴一覧の表示 | 1. 複数のクエリを実行する<br>2. 履歴パネルを開く | 最新のクエリが上に来る順序で表示されること。 | |
| TC-4 | キーワード検索 | 1. 検索ボックスに特定のキーワード（例: "SELECT"）を入力 | そのキーワードを含む履歴のみが表示されること。 | |
| TC-5 | 成功のみフィルタ | 1. 失敗したクエリを含む状態で「成功のみ表示」にチェック | 成功したクエリのみが表示されること。 | |

### 3.3 履歴のアクション

| ID | テストケース | 手順 | 期待される結果 | 備考 |
|----|------------|------|---------------|------|
| TC-6 | 履歴の復元 | 1. 履歴リストの項目をクリック | クエリビルダーにその時点の状態（選択テーブル、カラム、条件など）が復元されること。 | |
| TC-7 | 履歴の保存 | 1. 履歴項目の保存ボタンをクリック<br>2. ダイアログで名前を入力して保存 | 「保存済みクエリ」として保存され、保存済みクエリスライドオーバーで確認できること。 | |
| TC-8 | 履歴の削除 | 1. 履歴項目の削除ボタンをクリック<br>2. 確認ダイアログで「削除」を選択 | その履歴がリストから消えること。 | |

### 3.4 システム動作

| ID | テストケース | 手順 | 期待される結果 | 備考 |
|----|------------|------|---------------|------|
| TC-9 | 自動削除（件数制限） | 1. 1000件を超える履歴を作成（スクリプト等で模擬） | 古い履歴から削除され、常に最新1000件が維持されること。 | 手動検証は困難なためユニットテストで保証 |
| TC-10 | データ永続化 | 1. アプリを再起動 | 再起動後も履歴が残っていること。 | |

## 4. 既知の問題・制限事項

- 現時点ではSQL文の全文検索は可能だが、高度な構文解析検索は未実装。
- 履歴からの復元時、テーブルスキーマが変更されている場合は正しく復元できない可能性がある。

## 5. テスト結果要約

| 実施日 | 実施者 | OK数 | NG数 | 判定 |
|-------|-------|-----|-----|------|
| - | - | - | - | - |
