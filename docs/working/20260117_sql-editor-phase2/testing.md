# テスト手順書 - SQLエディタ Phase 2: エディタUI基本構築

## 変更履歴

- 2026-01-17: CodeMirror 6からMonaco Editorに変更。テストケースを更新

## 概要

このドキュメントでは、SQLエディタ Phase 2（エディタUI基本構築）のテスト手順を記載します。
Monaco Editorを使用したSQLエディタUIの基本機能をテストします。
可能な限り手動操作で確認し、操作で確認できない項目のみ自動テストを記載します。

## 前提条件

- `npm run tauri:dev` でアプリが起動していること
- Phase 1が完了しており、SQLエディタウィンドウが起動できること
- テスト用の接続が1つ以上登録されていること
- Monaco Editorパッケージがインストールされていること

## 手動テスト

### ケース 1: SQLエディタウィンドウの起動

**関連要件**: F-9

**手順:**

1. `npm run tauri:dev` でアプリを起動する
2. ランチャー画面で接続カードの「エディタ」ボタンをクリックする
3. SQLエディタウィンドウが開くことを確認する

**期待結果:**

- SQLエディタウィンドウが新しいウィンドウとして開く
- EnvironmentHeaderが表示され、接続の環境（開発/本番等）が表示される
- ツールバーが表示される
- エディタエリアが表示される
- 結果パネルプレースホルダーが表示される

**確認結果:**

- [ ] OK / NG

---

### ケース 2: エディタレイアウトの確認

**関連要件**: F-1

**手順:**

1. SQLエディタウィンドウを開く
2. レイアウトの各セクションを確認する
   - ツールバー（上部）
   - エディタエリア（中央上）
   - 結果パネル（中央下、プレースホルダー）

**期待結果:**

- 3つのセクションが縦に並んで表示される
- ツールバーは固定高さ
- エディタエリアと結果パネルは flex-1 で領域を分割
- ウィンドウをリサイズしても正しく追従する

**確認結果:**

- [ ] OK / NG

---

### ケース 3: ツールバーのボタン確認

**関連要件**: F-2

**手順:**

1. SQLエディタウィンドウを開く
2. ツールバーのボタンを確認する

**期待結果:**

- 実行ボタン（▶）が表示される（無効状態）
- 停止ボタン（⏹）が表示される（無効状態）
- 保存ボタン（🔖）が表示される（無効状態）
- すべてのボタンにアイコンとラベルが表示される
- ボタンはクリックできない（disabled状態）

**確認結果:**

- [ ] OK / NG

---

### ケース 4: エディタの基本機能

**関連要件**: F-3

**手順:**

1. SQLエディタウィンドウを開く
2. エディタエリアにカーソルを合わせてクリックする
3. 以下のテキストを入力する:
   ```sql
   SELECT * FROM users WHERE id = 1;
   ```
4. テキストが正しく入力されることを確認する
5. 入力したテキストを選択してDeleteキーで削除する
6. コピー＆ペーストで再度テキストを貼り付ける

**期待結果:**

- エディタにフォーカスが移る
- テキストが正しく入力される
- カーソルが入力位置に表示される
- 削除操作が正しく動作する
- コピー＆ペーストが正しく動作する

**確認結果:**

- [ ] OK / NG

---

### ケース 5: SQL構文ハイライト

**関連要件**: F-4

**手順:**

1. SQLエディタウィンドウを開く
2. 以下のSQLを入力する:
   ```sql
   SELECT id, name, email
   FROM users
   WHERE status = 'active'
   AND created_at > '2024-01-01'
   -- これはコメントです
   ORDER BY created_at DESC;
   ```
3. 構文ハイライトを確認する

**期待結果:**

- SQLキーワード（SELECT, FROM, WHERE, AND, ORDER BY, DESC）が色分けされる
- 文字列リテラル（'active', '2024-01-01'）が色分けされる
- コメント（`-- これはコメントです`）が色分けされる
- カラム名（id, name, email）が表示される

**確認結果:**

- [ ] OK / NG

---

### ケース 6: 行番号の表示

**関連要件**: F-5

**手順:**

1. SQLエディタウィンドウを開く
2. 複数行のSQLを入力する:
   ```sql
   SELECT *
   FROM users
   WHERE id = 1;
   ```
3. 左側に行番号が表示されることを確認する
4. エディタをスクロールして行番号が追従することを確認する

**期待結果:**

- エディタの左側に行番号（1, 2, 3...）が表示される
- 行番号の色がテーマに適合している
- スクロール時も行番号が追従する

**確認結果:**

- [ ] OK / NG

---

### ケース 7: Undo/Redo機能

**関連要件**: F-6

**手順:**

1. SQLエディタウィンドウを開く
2. テキストを入力する: `SELECT * FROM users;`
3. `Ctrl+Z`（macOS: `Cmd+Z`）を押す
4. テキストが元に戻ることを確認する
5. `Ctrl+Shift+Z`（macOS: `Cmd+Shift+Z`）を押す
6. テキストが再度入力されることを確認する
7. 複数回のUndo/Redoを試す

**期待結果:**

- `Ctrl+Z`（`Cmd+Z`）でUndoが動作する
- `Ctrl+Shift+Z`（`Cmd+Shift+Z`）でRedoが動作する
- 複数回のUndo/Redoが正しく動作する
- 編集履歴が適切に管理される

**確認結果:**

- [ ] OK / NG

---

### ケース 8: ライトモード表示

**関連要件**: F-3

**手順:**

1. アプリをライトモードに設定する
2. SQLエディタウィンドウを開く
3. SQLを入力して表示を確認する

**期待結果:**

- エディタ背景が白色系
- テキストが黒色系
- 構文ハイライトの色が視認しやすい
- 行番号が適切な色で表示される
- アプリ全体のデザインと調和している

**確認結果:**

- [ ] OK / NG

---

### ケース 9: ダークモード表示

**関連要件**: F-3

**手順:**

1. アプリをダークモードに設定する
2. SQLエディタウィンドウを開く
3. SQLを入力して表示を確認する

**期待結果:**

- エディタ背景が黒色系
- テキストが白色系
- 構文ハイライトの色が視認しやすい
- 行番号が適切な色で表示される
- アプリ全体のデザインと調和している

**確認結果:**

- [ ] OK / NG

---

### ケース 10: カラーモード切り替え

**関連要件**: F-3

**手順:**

1. ライトモードでSQLエディタウィンドウを開く
2. SQLを入力する
3. アプリの設定でダークモードに切り替える
4. SQLエディタのテーマが即座に切り替わることを確認する
5. 再度ライトモードに戻す

**期待結果:**

- カラーモード切り替え時にエディタテーマが即座に切り替わる
- テキスト内容は保持される
- 遅延やちらつきがない

**確認結果:**

- [ ] OK / NG

---

### ケース 11: レスポンシブ対応

**関連要件**: F-1

**手順:**

1. SQLエディタウィンドウを開く
2. ウィンドウサイズを大きくする
3. ウィンドウサイズを小さくする
4. ウィンドウを縦長にする
5. ウィンドウを横長にする

**期待結果:**

- ウィンドウサイズに応じてレイアウトが追従する
- エディタエリアが常に適切なサイズで表示される
- 極端に小さいサイズでもレイアウトが崩れない
- スクロールバーが適切に表示される

**確認結果:**

- [ ] OK / NG

---

### ケース 12: 大きなSQLファイルのパフォーマンス

**非機能要件**: パフォーマンス

**手順:**

1. SQLエディタウィンドウを開く
2. Monaco Editorの初期化時間を確認する（開発者ツールのPerformanceタブで計測）
3. 大きなSQL（1000行以上）をコピー＆ペーストする
4. スクロール動作を確認する
5. テキスト編集の反応速度を確認する

**期待結果:**

- Monaco Editorの初期化時間が2秒以内
- 大きなSQL（10,000行程度）でもスムーズに動作する
- スクロールが滑らか
- テキスト入力に遅延がない
- Monaco Editorの仮想スクロールが正しく動作する

**確認結果:**

- [ ] OK / NG

---

### ケース 13: 複数のSQLエディタウィンドウ

**手順:**

1. 接続Aで「エディタ」ボタンをクリックしてSQLエディタを開く
2. 接続Bで「エディタ」ボタンをクリックして別のSQLエディタを開く
3. 2つのウィンドウが独立して動作することを確認する

**期待結果:**

- 2つの独立したSQLエディタウィンドウが開く
- 各ウィンドウは異なる接続情報を持つ
- 各ウィンドウで独立してSQLを編集できる
- EnvironmentHeaderがそれぞれの接続環境を表示する

**確認結果:**

- [ ] OK / NG

---

### ケース 14: 接続情報の取得

**関連要件**: F-7, F-9

**手順:**

1. テスト用の接続（例: PostgreSQL開発環境）で「エディタ」ボタンをクリック
2. SQLエディタウィンドウが開く
3. EnvironmentHeaderに正しい接続名と環境が表示されることを確認する
4. ブラウザの開発者ツールでストアの状態を確認する（任意）

**期待結果:**

- EnvironmentHeaderに接続名が表示される
- EnvironmentHeaderに環境（開発/本番等）が表示される
- ストアに接続IDが設定される

**確認結果:**

- [ ] OK / NG

---

## 自動テスト

### ユニットテスト

すべてのユニットテストが正常にパスすることを確認します。

```bash
npm run test:run
```

**対象テスト:**

- `tests/stores/sql-editor.test.ts` - SQLエディタストアのテスト
- `tests/components/sql-editor/SqlEditorToolbar.test.ts` - ツールバーコンポーネントのテスト
- `tests/components/sql-editor/SqlEditorLayout.test.ts` - レイアウトコンポーネントのテスト
- `tests/components/sql-editor/SqlTextEditor.test.ts` - テキストエディタコンポーネントのテスト

**確認結果:**

- [ ] OK / NG

---

### 型チェック

TypeScriptの型チェックがすべてパスすることを確認します。

```bash
npm run typecheck
```

**確認結果:**

- [ ] OK / NG

---

## エッジケース

| ケース | 期待動作 | 確認結果 |
|--------|---------|---------|
| 空のSQLを入力 | エラーなく表示される | [ ] OK / NG |
| 非常に長い1行のSQL | 横スクロールが表示される | [ ] OK / NG |
| 特殊文字を含むSQL（絵文字等） | 正しく表示・編集できる | [ ] OK / NG |
| 日本語コメントを含むSQL | 正しく表示・編集できる | [ ] OK / NG |
| タブ文字を含むSQL | 適切にインデント表示される | [ ] OK / NG |
| 接続情報がない状態でウィンドウを開く | エラーが表示される、またはグレースフルに処理される | [ ] OK / NG |

---

## 回帰テスト

Phase 2の実装により既存機能への影響がないことを確認します。

### ランチャー機能

- [ ] ランチャー画面が正常に表示される
- [ ] 接続カードが正常に表示される
- [ ] 「クエリビルダー」ボタンが正常に動作する
- [ ] 「エディタ」ボタンが正常に動作する（Phase 1から引き続き）

### 接続管理機能

- [ ] 接続の新規作成が正常に動作する
- [ ] 接続の編集が正常に動作する
- [ ] 接続の削除が正常に動作する
- [ ] 環境設定が正常に動作する

### クエリビルダー機能

- [ ] クエリビルダーウィンドウが正常に開く
- [ ] テーブル選択が正常に動作する
- [ ] クエリ構築が正常に動作する
- [ ] クエリ実行が正常に動作する

### 設定機能

- [ ] 設定画面が正常に開く
- [ ] カラーモード切り替えが正常に動作する
- [ ] その他の設定が正常に動作する

---

## テスト結果サマリー

### 手動テスト

| カテゴリ | 実施件数 | OK | NG |
|---------|---------|----|----|
| 基本機能 | 14 | - | - |
| エッジケース | 6 | - | - |
| 回帰テスト | 10+ | - | - |

### 自動テスト

| テスト種別 | 結果 |
|-----------|------|
| ユニットテスト | - |
| 型チェック | - |

---

## 既知の問題・制限事項

実装・テスト中に発見された問題や制限事項を記載します。

- （テスト実施後に記載）

---

## テスト環境

| 項目 | 値 |
|------|-----|
| OS | macOS / Windows / Linux |
| Node.js | 18.x以上 |
| npm | 9.x以上 |
| Rust | 1.70以上 |
| アプリバージョン | （実装時に記載） |
| 実施日 | （テスト実施時に記載） |
| 実施者 | （テスト実施時に記載） |

---

## 参考資料

- [requirements.md](./requirements.md) - 要件定義書
- [design.md](./design.md) - 設計書
- [tasklist.md](./tasklist.md) - タスクリスト
- [WBS Phase 2](../../local/20260117_エディタ機能/wbs.md#phase-2-エディタui基本構築)
