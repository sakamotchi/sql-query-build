# テスト手順書 - SQLエディタ画面の多言語対応

## 概要

このドキュメントでは、SQLエディタ画面の多言語対応機能のテスト手順を記載します。
可能な限り手動操作で確認し、操作で確認できない項目のみ自動テストを記載します。

## 前提条件

- `npm run tauri:dev` でアプリが起動していること
- 少なくとも1つのデータベース接続が設定されていること
- 保存済みクエリが1件以上存在すること（保存クエリパネルのテスト用）
- 実行履歴が1件以上存在すること（履歴パネルのテスト用）

## 手動テスト

### ケース 1: 日本語環境での表示確認

**目的**: 既存の日本語表示が変わらず正しく表示されることを確認

**手順:**

1. アプリを起動する
2. 設定画面を開き、言語が「日本語」に設定されていることを確認
3. SQLエディタ画面を開く
4. ツールバーのボタンラベルを確認
   - "実行", "停止", "整形", "保存" が表示されている
5. 左パネルのタイトルを確認
   - "保存クエリ" タブが表示されている
   - "実行履歴" タブが表示されている
6. 結果パネルのメッセージを確認
   - "クエリを実行してください" が表示されている
7. クエリを実行し、結果パネルを確認
   - "結果" タイトルが表示されている
   - "実行時間: X.XXX秒" が表示されている
   - "取得件数: X件" または "影響行数: X行" が表示されている
8. 保存ボタンをクリックし、保存ダイアログを確認
   - タイトル: "クエリを保存"
   - フォームラベル: "クエリ名", "説明", "タグ", "保存先フォルダ"
   - ボタン: "キャンセル", "保存"

**期待結果:**

- 全ての表示が既存と同じ日本語で表示される
- ハードコードされていた文字列と同一の表示である

**確認結果:**

- [ ] OK / NG

---

### ケース 2: 英語環境での表示確認

**目的**: 言語を英語に切り替えた際に、全ての表示が英語になることを確認

**手順:**

1. アプリを起動する
2. 設定画面を開き、言語を「English」に変更する
3. SQLエディタ画面を開く
4. ツールバーのボタンラベルを確認
   - "Execute", "Stop", "Format", "Save" が表示されている
5. 左パネルのタイトルを確認
   - "Saved Queries" タブが表示されている
   - "Execution History" タブが表示されている
6. 結果パネルのメッセージを確認
   - "Please execute a query" が表示されている
7. クエリを実行し、結果パネルを確認
   - "Result" タイトルが表示されている
   - "Execution Time: X.XXXs" が表示されている
   - "Rows: X" または "Affected Rows: X" が表示されている
8. 保存ボタンをクリックし、保存ダイアログを確認
   - タイトル: "Save Query"
   - フォームラベル: "Query Name", "Description", "Tags", "Folder"
   - ボタン: "Cancel", "Save"

**期待結果:**

- 全ての表示が自然な英語で表示される
- 翻訳漏れがない

**確認結果:**

- [ ] OK / NG

---

### ケース 3: 言語切り替え時のリアクティブ更新

**目的**: 言語切り替え時に、画面がリアルタイムで更新されることを確認

**手順:**

1. アプリを起動し、言語を「日本語」に設定する
2. SQLエディタ画面を開く
3. 設定画面を開き、言語を「English」に変更する
4. SQLエディタ画面に戻る（リロードせず）
5. 画面の表示を確認

**期待結果:**

- リロードせずに、全ての表示が英語に切り替わる
- ボタンラベル、パネルタイトル、メッセージが即座に更新される

**確認結果:**

- [ ] OK / NG

---

### ケース 4: ツールバーの多言語対応

**目的**: ツールバーの全ての要素が多言語対応されていることを確認

**手順:**

1. 言語を「日本語」に設定し、SQLエディタ画面を開く
2. ツールバーの各ボタンのラベルを確認
   - "実行", "停止", "整形", "保存"
3. パネル表示/非表示ボタンのツールチップを確認（ホバー時）
   - "パネルを非表示" または "パネルを表示"
4. 保存済みクエリを読み込んだ状態で、保存ボタンをクリック
5. 更新確認ダイアログを確認
   - タイトル: "クエリを更新しますか?"
   - 説明: "保存済みのクエリを更新するか、新しいクエリとして保存するか選択してください"
   - ボタン: "キャンセル", "新規保存", "更新"
6. "更新" をクリックし、トースト通知を確認
   - "クエリを更新しました"
7. 言語を「English」に切り替え、同じ手順を繰り返す
   - ボタン: "Execute", "Stop", "Format", "Save"
   - ダイアログタイトル: "Update Query?"
   - トースト: "Query updated successfully"

**期待結果:**

- 日本語と英語の両方で、全ての要素が正しく表示される

**確認結果:**

- [ ] OK / NG

---

### ケース 5: 結果パネルの多言語対応

**目的**: 結果パネルの全ての状態で多言語対応されていることを確認

**手順:**

1. 言語を「日本語」に設定し、SQLエディタ画面を開く
2. 初期状態（クエリ未実行）のメッセージを確認
   - "クエリを実行してください"
3. SELECT クエリを実行し、結果を確認
   - "結果" タイトル
   - "実行時間: X.XXX秒"
   - "取得件数: X件"
4. INSERT/UPDATE/DELETE クエリを実行し、結果を確認
   - "影響行数: X行"
5. エラーが発生するクエリを実行し、エラー表示を確認
   - "エラー位置: X行 Y列" または "エラー位置: X行"
6. 言語を「English」に切り替え、同じ手順を繰り返す
   - "Please execute a query"
   - "Result", "Execution Time: X.XXXs", "Rows: X", "Affected Rows: X"
   - "Error at line X, column Y" または "Error at line X"

**期待結果:**

- 全ての状態で、日本語と英語が正しく表示される
- 動的な値（秒数、行数、行番号、列番号）が正しく埋め込まれる

**確認結果:**

- [ ] OK / NG

---

### ケース 6: 保存ダイアログの多言語対応

**目的**: 保存ダイアログの全ての要素が多言語対応されていることを確認

**手順:**

1. 言語を「日本語」に設定し、SQLエディタ画面を開く
2. 新規クエリを入力し、保存ボタンをクリック
3. ダイアログのタイトルと説明を確認
   - タイトル: "クエリを保存"
   - 説明: "名前・説明・タグを入力してください"
4. フォームのラベルとプレースホルダーを確認
   - クエリ名: ラベル "クエリ名", プレースホルダー "例: 全ユーザー一覧"
   - 説明: ラベル "説明", プレースホルダー "このクエリの用途を説明...", ヒント "任意"
   - タグ: ラベル "タグ", プレースホルダー "例: admin, report", ヒント "カンマ区切りで入力"
   - フォルダ: ラベル "保存先フォルダ", ヒント "任意"
5. 空のクエリ名で保存を試み、バリデーションエラーを確認
   - "クエリ名は必須です"
6. 101文字のクエリ名を入力し、バリデーションエラーを確認
   - "クエリ名は100文字以内で入力してください"
7. 言語を「English」に切り替え、同じ手順を繰り返す
   - タイトル: "Save Query", 説明: "Enter name, description, and tags"
   - エラー: "Query name is required", "Query name must be within 100 characters"

**期待結果:**

- 全ての要素が日本語と英語で正しく表示される
- バリデーションエラーメッセージも多言語対応されている

**確認結果:**

- [ ] OK / NG

---

### ケース 7: 保存クエリパネルの多言語対応

**目的**: 保存クエリパネルの全ての要素が多言語対応されていることを確認

**手順:**

1. 言語を「日本語」に設定し、SQLエディタ画面を開く
2. 保存クエリパネルを開く
3. 検索ボックスのプレースホルダーを確認
   - "クエリを検索..."
4. クエリを右クリックし、コンテキストメニューを確認
   - "読み込み", "実行", "編集", "移動", "ルートに移動", "削除"
5. クエリを読み込み、トースト通知を確認
   - "「クエリ名」を読み込みました"
6. クエリを削除し、確認ダイアログとトーストを確認
   - ダイアログタイトル: "保存クエリを削除しますか?"
   - ダイアログ説明: "「クエリ名」は元に戻せません。"
   - トースト: "クエリを削除しました"
7. フォルダを右クリックし、コンテキストメニューを確認
   - "新規フォルダ", "名前変更", "削除", "すべて展開", "すべて折りたたみ"
8. 言語を「English」に切り替え、同じ手順を繰り返す
   - プレースホルダー: "Search queries..."
   - メニュー: "Load", "Execute", "Edit", "Move", "Move to Root", "Delete"
   - トースト: "Loaded \"クエリ名\"", "Query deleted successfully"

**期待結果:**

- 全ての要素が日本語と英語で正しく表示される
- 動的な値（クエリ名、パス）が正しく埋め込まれる

**確認結果:**

- [ ] OK / NG

---

### ケース 8: 履歴パネルの多言語対応と相対時刻表示

**目的**: 履歴パネルの全ての要素が多言語対応され、相対時刻表示が各言語で自然に表示されることを確認

**手順:**

1. 言語を「日本語」に設定し、SQLエディタ画面を開く
2. 履歴パネルを開く
3. 検索ボックスのプレースホルダーを確認
   - "履歴を検索..."
4. フィルタのラベルを確認
   - "成功のみ表示"
5. ステータス表示を確認
   - "成功" または "失敗"
6. 相対時刻表示を確認
   - 最近の履歴: "数秒前", "5分前", "今日 HH:MM"
   - 古い履歴: "MM/DD HH:MM" (日本語形式)
7. 履歴を右クリックし、コンテキストメニューを確認（あれば）
8. 履歴を削除し、確認ダイアログとトーストを確認
   - ダイアログタイトル: "履歴を削除しますか?"
   - トースト: "履歴を削除しました"
9. 言語を「English」に切り替え、同じ手順を繰り返す
   - プレースホルダー: "Search history..."
   - フィルタ: "Success only"
   - ステータス: "Success" / "Failure"
   - 相対時刻: "A few seconds ago", "5 min ago", "Today HH:MM"
   - 日付: "MM/DD HH:MM" (英語形式)

**期待結果:**

- 全ての要素が日本語と英語で正しく表示される
- 相対時刻表示が各言語で自然な表現になっている
- 日付フォーマットがロケールに応じて変わる

**確認結果:**

- [ ] OK / NG

---

### ケース 9: トースト通知の多言語対応

**目的**: 全てのトースト通知が多言語対応されていることを確認

**手順:**

1. 言語を「日本語」に設定する
2. 以下の操作を行い、各トースト通知を確認する
   - クエリを更新: "クエリを更新しました"
   - クエリの更新に失敗（エラーを誘発）: "クエリの更新に失敗しました"
   - クエリを保存: "クエリを保存しました"
   - クエリの保存に失敗（エラーを誘発）: "クエリの保存に失敗しました"
   - 保存クエリを読み込み: "「クエリ名」を読み込みました"
   - 保存クエリを削除: "クエリを削除しました"
   - フォルダを作成: "フォルダを作成しました"
   - フォルダ名を変更: "フォルダ名を変更しました"
   - フォルダを削除: "フォルダを削除しました"
   - 履歴を削除: "履歴を削除しました"
3. 言語を「English」に切り替え、同じ手順を繰り返す
   - "Query updated successfully"
   - "Failed to update query"
   - "Query saved successfully"
   - "Failed to save query"
   - "Loaded \"クエリ名\""
   - "Query deleted successfully"
   - "Folder created successfully"
   - "Folder renamed successfully"
   - "Folder deleted successfully"
   - "History deleted successfully"

**期待結果:**

- 全てのトースト通知が日本語と英語で正しく表示される
- エラーメッセージも多言語対応されている

**確認結果:**

- [ ] OK / NG

---

### ケース 10: エディタタブの多言語対応

**目的**: エディタタブ関連の要素が多言語対応されていることを確認（該当する場合）

**手順:**

1. 言語を「日本語」に設定し、SQLエディタ画面を開く
2. 複数のタブを開く
3. タブのツールチップやラベルを確認（ハードコード文字列がある場合）
4. 言語を「English」に切り替え、同じ手順を繰り返す

**期待結果:**

- タブ関連の全ての要素が多言語対応されている

**確認結果:**

- [ ] OK / NG（または N/A: ハードコード文字列なし）

---

## 自動テスト

### ユニットテスト（コンポーネント）

多言語対応の動作を確認するユニットテストを実行します。

```bash
npm run test:run
```

**確認ポイント:**
- i18n プラグインが正しく設定されている
- 翻訳キーが正しく解決される
- 言語切り替え時にリアクティブに更新される

**確認結果:**

- [ ] OK / NG

---

### 型チェック

TypeScript の型エラーがないことを確認します。

```bash
npm run typecheck
```

**確認ポイント:**
- 翻訳キーの型が正しい
- `useI18n()` の使用方法が正しい

**確認結果:**

- [ ] OK / NG

---

## エッジケース

| ケース | 期待動作 | 確認結果 |
|--------|---------|---------|
| 翻訳キーが存在しない場合 | キー名がそのまま表示される（または警告が表示される） | [ ] OK / NG |
| プレースホルダーの値が `null` の場合 | 空文字列または適切なフォールバック値が表示される | [ ] OK / NG |
| 相対時刻表示で不正な日付が渡された場合 | 元の文字列がそのまま表示される | [ ] OK / NG |
| 非常に長いクエリ名を含むトースト通知 | テキストが適切に折り返される | [ ] OK / NG |
| 日本語と英語を頻繁に切り替える | メモリリークが発生しない、パフォーマンスが低下しない | [ ] OK / NG |

---

## 回帰テスト

既存機能への影響がないことを確認します。

- [ ] 既存の接続機能が正常に動作する
- [ ] クエリビルダー画面が正常に動作する（既に多言語対応済み）
- [ ] データ変更画面が正常に動作する（既に多言語対応済み）
- [ ] 設定画面が正常に動作する（既に多言語対応済み）
- [ ] ランチャー画面が正常に動作する（既に多言語対応済み）
- [ ] 言語設定を変更すると、全ての画面で言語が切り替わる

---

## 翻訳品質チェック

英語翻訳の品質を確認します。

- [ ] 文法的に正しい英語である
- [ ] 自然な英語表現である（直訳でない）
- [ ] 技術用語が適切に使用されている
- [ ] 一貫した用語が使用されている（例: "Query" の一貫性）
- [ ] 敬語や丁寧語が適切に訳されている

---

## パフォーマンステスト

多言語対応による性能劣化がないことを確認します。

**手順:**

1. 言語を「日本語」に設定し、SQLエディタ画面を開く
2. 画面の描画速度を確認
3. 言語を「English」に切り替える
4. 画面の再描画速度を確認
5. 既存の画面（クエリビルダー等）と比較

**期待結果:**

- 描画速度が既存の画面と同等である
- 言語切り替え時の再描画が1秒以内に完了する

**確認結果:**

- [ ] OK / NG

---

## 完了チェックリスト

- [ ] 全ての手動テストケースが OK
- [ ] 自動テストが全てパス
- [ ] エッジケースが全て OK
- [ ] 回帰テストが全て OK
- [ ] 翻訳品質チェックが全て OK
- [ ] パフォーマンステストが OK
- [ ] 翻訳漏れがない（全てのハードコード文字列が置き換えられている）
- [ ] コンソールにエラーや警告が表示されない

---

## 既知の問題・制限事項

（テスト中に発見した問題をここに記載）

- なし

---

## テスト実施記録

| 実施日 | 実施者 | 結果 | 備考 |
|--------|--------|------|------|
| | | | |
