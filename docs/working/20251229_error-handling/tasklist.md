# タスクリスト: エラーハンドリング

## 前提条件

- [x] Phase 2.1 クエリ実行基盤（Rust）が完成していること
- [x] Phase 2.2 結果表示UIが完成していること

## タスク一覧

### 2.3.1 QueryError型定義（拡充）

| タスクID | タスク名 | 状態 | 依存 |
|---------|---------|------|------|
| 2.3.1.1 | QueryErrorCode列挙型の拡充（Rust） | 📝 未着手 | - |
| 2.3.1.2 | QueryErrorDetails構造体の拡充（Rust） | 📝 未着手 | - |
| 2.3.1.3 | PostgreSQLエラーマッピング実装 | 📝 未着手 | 2.3.1.1 |
| 2.3.1.4 | MySQLエラーマッピング実装 | 📝 未着手 | 2.3.1.1 |
| 2.3.1.5 | SQLiteエラーマッピング実装 | 📝 未着手 | 2.3.1.1 |
| 2.3.1.6 | フロントエンドQueryErrorCode型更新 | 📝 未着手 | 2.3.1.1 |
| 2.3.1.7 | フロントエンドQueryErrorDetails型更新 | 📝 未着手 | 2.3.1.2 |

**成果物**:
- `src-tauri/src/models/query_result.rs` - 拡充
- `src-tauri/src/database/postgresql_executor.rs` - エラーマッピング強化
- `src-tauri/src/database/mysql_executor.rs` - エラーマッピング強化
- `src-tauri/src/database/sqlite_executor.rs` - エラーマッピング強化
- `app/types/query-result.ts` - 型更新

### 2.3.2 エラー表示UI

| タスクID | タスク名 | 状態 | 依存 |
|---------|---------|------|------|
| 2.3.2.1 | error-messages.tsユーティリティ作成 | 📝 未着手 | 2.3.1.6 |
| 2.3.2.2 | エラーメッセージマッピング定義 | 📝 未着手 | 2.3.2.1 |
| 2.3.2.3 | エラーヒントマッピング定義 | 📝 未着手 | 2.3.2.1 |
| 2.3.2.4 | エラーアイコンマッピング定義 | 📝 未着手 | 2.3.2.1 |
| 2.3.2.5 | QueryErrorDisplay.vueコンポーネント作成 | 📝 未着手 | 2.3.2.1 |
| 2.3.2.6 | エラーメッセージ表示部分実装 | 📝 未着手 | 2.3.2.5 |
| 2.3.2.7 | エラーアイコン表示実装 | 📝 未着手 | 2.3.2.5 |
| 2.3.2.8 | 技術詳細展開表示実装 | 📝 未着手 | 2.3.2.6 |
| 2.3.2.9 | ErrorHint.vueコンポーネント作成 | 📝 未着手 | 2.3.2.3 |
| 2.3.2.10 | ヒント表示の統合 | 📝 未着手 | 2.3.2.9 |
| 2.3.2.11 | リトライボタン実装 | 📝 未着手 | 2.3.2.5 |

**成果物**:
- `app/utils/error-messages.ts` - 新規
- `app/components/query-builder/error/QueryErrorDisplay.vue` - 新規
- `app/components/query-builder/error/ErrorHint.vue` - 新規

### 2.3.3 構文エラーハイライト

| タスクID | タスク名 | 状態 | 依存 |
|---------|---------|------|------|
| 2.3.3.1 | SqlPreview.vueにエラー情報Props追加 | 📝 未着手 | 2.3.1.7 |
| 2.3.3.2 | エラー行計算ロジック実装 | 📝 未着手 | 2.3.3.1 |
| 2.3.3.3 | エラー列計算ロジック実装 | 📝 未着手 | 2.3.3.2 |
| 2.3.3.4 | エラー行ハイライト（赤背景）実装 | 📝 未着手 | 2.3.3.2 |
| 2.3.3.5 | エラー箇所波線下線実装 | 📝 未着手 | 2.3.3.3 |
| 2.3.3.6 | エラー位置インジケーター表示 | 📝 未着手 | 2.3.3.3 |

**成果物**:
- `app/components/query-builder/SqlPreview.vue` - エラーハイライト追加

### 2.3.4 ResultPanel統合

| タスクID | タスク名 | 状態 | 依存 |
|---------|---------|------|------|
| 2.3.4.1 | query-builderストアにqueryError状態追加 | 📝 未着手 | 2.3.1.6 |
| 2.3.4.2 | parseQueryError関数実装 | 📝 未着手 | 2.3.4.1 |
| 2.3.4.3 | executeQuery内でqueryErrorを設定 | 📝 未着手 | 2.3.4.2 |
| 2.3.4.4 | clearErrorアクション追加 | 📝 未着手 | 2.3.4.1 |
| 2.3.4.5 | ResultPanel.vueにQueryErrorDisplay統合 | 📝 未着手 | 2.3.2.5, 2.3.4.1 |
| 2.3.4.6 | エラー時のヘッダーアイコン変更 | 📝 未着手 | 2.3.4.5 |
| 2.3.4.7 | リトライボタンのイベントハンドリング | 📝 未着手 | 2.3.4.5 |

**成果物**:
- `app/stores/query-builder.ts` - queryError状態追加
- `app/components/query-builder/ResultPanel.vue` - エラー表示統合

### 2.3.5 テストコード

| タスクID | タスク名 | 状態 | 依存 |
|---------|---------|------|------|
| 2.3.5.1 | error-messages.spec.ts作成 | 📝 未着手 | 2.3.2.1 |
| 2.3.5.2 | QueryErrorDisplay.spec.ts作成 | 📝 未着手 | 2.3.2.5 |
| 2.3.5.3 | ErrorHint.spec.ts作成 | 📝 未着手 | 2.3.2.9 |
| 2.3.5.4 | SqlPreviewエラーハイライト.spec.ts作成 | 📝 未着手 | 2.3.3 |
| 2.3.5.5 | query-builderストアエラーテスト追加 | 📝 未着手 | 2.3.4 |

**成果物**:
- `app/utils/__tests__/error-messages.spec.ts` - 新規
- `app/components/query-builder/error/__tests__/QueryErrorDisplay.spec.ts` - 新規
- `app/components/query-builder/error/__tests__/ErrorHint.spec.ts` - 新規
- `app/components/query-builder/__tests__/SqlPreview.spec.ts` - 拡充

## 進捗サマリー

| フェーズ | 完了 | 進行中 | 未着手 | 合計 |
|---------|------|--------|--------|------|
| 2.3.1 QueryError型 | 0 | 0 | 7 | 7 |
| 2.3.2 エラー表示UI | 0 | 0 | 11 | 11 |
| 2.3.3 構文エラーハイライト | 0 | 0 | 6 | 6 |
| 2.3.4 ResultPanel統合 | 0 | 0 | 7 | 7 |
| 2.3.5 テストコード | 0 | 0 | 5 | 5 |
| **合計** | **0** | **0** | **36** | **36** |

## 推奨実装順序

1. **2.3.1.1-2.3.1.2** QueryError型の拡充（Rust） - 基盤となる型定義
2. **2.3.1.3-2.3.1.5** 各DBのエラーマッピング実装 - 並行実装可能
3. **2.3.1.6-2.3.1.7** フロントエンド型定義の更新
4. **2.3.2.1-2.3.2.4** error-messages.tsユーティリティ作成
5. **2.3.2.5-2.3.2.11** エラー表示UIコンポーネント実装
6. **2.3.3** 構文エラーハイライト実装
7. **2.3.4** ResultPanel統合
8. **2.3.5** テストコード作成

## 優先度別タスク

### 必須（MVP）

- 2.3.1.* 型定義の拡充
- 2.3.2.1-2.3.2.7 エラー表示UIの基本機能
- 2.3.4.1-2.3.4.5 ResultPanel統合

### 推奨

- 2.3.2.8 技術詳細展開表示
- 2.3.2.9-2.3.2.10 ヒント表示
- 2.3.3.* 構文エラーハイライト

### オプション

- 2.3.2.11 リトライボタン
- 2.3.5.* テストコード
