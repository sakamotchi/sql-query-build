# タスクリスト - SQLエディタウィンドウ基盤構築

## 進捗サマリー

| 状態 | 件数 |
|------|------|
| 完了 | 0 |
| 進行中 | 0 |
| 未着手 | 7 |

**総工数見積**: 5.5時間

## タスク一覧

### P1-1: ウィンドウタイプ定義追加（フロントエンド）

**見積**: 0.5h

- [ ] `app/types/index.ts` の `WindowType` 型に `'sql_editor'` を追加
- [ ] TypeScriptコンパイルエラーがないことを確認
- [ ] 型定義のドキュメントコメントを更新

**関連要件**: F-1

**対象ファイル**:
- `app/types/index.ts`

**受け入れ条件**:
- `WindowType` 型に `'sql_editor'` が追加されている
- TypeScriptコンパイルエラーが発生しない
- 既存のクエリビルダー・ミューテーションビルダーに影響がない

---

### P1-2: Rust側ウィンドウマネージャー拡張

**見積**: 1h

- [ ] `src-tauri/src/models/window.rs` の `WindowType` enumに `SqlEditor` バリアントを追加
- [ ] `src-tauri/src/services/window_manager.rs` に `open_sql_editor_window` 関数を実装
- [ ] ウィンドウラベル形式を `sql_editor_{connection_id}` とする
- [ ] ウィンドウタイトルを `[環境名] 接続名 - SQLエディタ` 形式とする（本番は `⚠️` 追加）
- [ ] 重複ウィンドウ防止ロジックを実装（既存ウィンドウがある場合はフォーカス）
- [ ] ウィンドウサイズを `1280x900`（最小 `1024x768`）に設定
- [ ] Rustコンパイルエラーがないことを確認

**関連要件**: F-2, F-7

**対象ファイル**:
- `src-tauri/src/models/window.rs`
- `src-tauri/src/services/window_manager.rs`

**受け入れ条件**:
- `WindowType::SqlEditor` バリアントが追加されている
- `open_sql_editor_window` 関数が実装されている
- 同一接続で重複ウィンドウが開かないよう制御されている
- 既存ウィンドウがある場合はフォーカスする挙動である
- ウィンドウタイトルが正しい形式である

---

### P1-3: フロントエンドウィンドウAPI拡張

**見積**: 1h

- [ ] `app/api/window.ts` に `openSqlEditor()` 関数を追加
- [ ] Tauriコマンド `open_sql_editor_window` を呼び出すように実装
- [ ] エラーハンドリングを実装
- [ ] TypeScript型定義が正しいことを確認

**関連要件**: F-3

**対象ファイル**:
- `app/api/window.ts`

**受け入れ条件**:
- `openSqlEditor(connectionId: string, connectionName: string, environment: string)` 関数が定義されている
- Tauriコマンド `open_sql_editor_window` を呼び出している
- 戻り値は `Promise<WindowInfo>` である
- エラーハンドリングが実装されている

---

### P1-4: SQLエディタページ作成（空）

**見積**: 0.5h

- [ ] `app/pages/sql-editor.vue` を新規作成
- [ ] Nuxt 4のページ規約に従ったComposition API形式で実装
- [ ] ウィンドウコンテキスト（接続ID、環境情報）を取得
- [ ] `EnvironmentHeader` コンポーネントを表示
- [ ] プレースホルダーテキスト（「SQLエディタ（準備中）」等）を表示
- [ ] TypeScriptコンパイルエラーがないことを確認

**関連要件**: F-4

**対象ファイル**:
- `app/pages/sql-editor.vue`

**受け入れ条件**:
- `app/pages/sql-editor.vue` が存在する
- Nuxt 4のページ規約に従っている
- ウィンドウコンテキストを取得している
- 環境ヘッダーが表示されている
- プレースホルダーテキストが表示されている

---

### P1-5: 接続カードにボタン追加

**見積**: 1h

- [ ] `app/components/connection/ConnectionCard.vue` に「エディタ」ボタンを追加
- [ ] ボタンアイコンを `i-heroicons-code-bracket` に設定
- [ ] ボタンクリックイベント `@open-sql-editor` を emit
- [ ] ボタンデザインが既存ボタンと一貫性があることを確認
- [ ] TypeScriptコンパイルエラーがないことを確認

**関連要件**: F-5

**対象ファイル**:
- `app/components/connection/ConnectionCard.vue`

**受け入れ条件**:
- 接続カードに「エディタ」ボタンが表示される
- ボタンは既存の「クエリビルダー」「ミューテーション」ボタンと同じデザインパターンである
- ボタンクリック時に `@open-sql-editor` イベントがemitされる
- ボタンのアイコンが適切である

---

### P1-6: ランチャーのハンドラー追加

**見積**: 0.5h

- [ ] `app/pages/index.vue` に `handleOpenSqlEditor` 関数を実装
- [ ] `ConnectionCard` からの `@open-sql-editor` イベントを受け取る
- [ ] `windowApi.openSqlEditor()` を呼び出す
- [ ] エラーハンドリングとトースト表示を実装
- [ ] TypeScriptコンパイルエラーがないことを確認

**関連要件**: F-6

**対象ファイル**:
- `app/pages/index.vue`

**受け入れ条件**:
- `handleOpenSqlEditor(connectionId: string)` 関数が実装されている
- `ConnectionCard` から `@open-sql-editor` イベントを受け取っている
- `openSqlEditor()` を呼び出し、エラーハンドリングを行っている

---

### P1-7: 動作確認・テスト

**見積**: 1h

- [ ] 型チェックが通ることを確認（`npm run typecheck`）
- [ ] Rustビルドが通ることを確認
- [ ] Tauriアプリを起動（`npm run tauri:dev`）
- [ ] ランチャーに接続カードが表示されることを確認
- [ ] 接続カードに「エディタ」ボタンが表示されることを確認
- [ ] 「エディタ」ボタンをクリックしてSQLエディタウィンドウが開くことを確認
- [ ] ウィンドウタイトルに接続名と環境が表示されることを確認
- [ ] 環境ヘッダーが表示され、環境色が適用されることを確認
- [ ] 同一接続で「エディタ」ボタンを再クリックした際、新規ウィンドウではなく既存ウィンドウにフォーカスすることを確認
- [ ] 本番環境の接続で `⚠️` が表示されることを確認（本番接続がある場合）
- [ ] 既存のクエリビルダー・ミューテーションビルダーが正常に動作することを確認
- [ ] ユニットテストを作成・実行（`windowApi.openSqlEditor` のテスト）
- [ ] 問題があれば修正

**関連要件**: 全要件

**対象ファイル**: 全ファイル

**受け入れ条件**:
- 全ての手動テスト項目が完了している
- ユニットテストが作成され、パスしている
- TypeScript型チェックが通っている
- Rustビルドが通っている
- 既存機能に影響がない

---

## タスク依存関係

```
P1-1 (型定義) ─┬─→ P1-3 (フロントエンドAPI) ─→ P1-6 (ランチャー) ─┐
               │                                                  │
               └─→ P1-4 (ページ作成) ──────────────────────────→ │
                                                                  ├─→ P1-7 (動作確認)
P1-2 (Rustウィンドウマネージャー) ───────────────────────────→    │
                                                                  │
P1-5 (接続カードボタン) ─────────────────────────────────────→ ┘
```

- **P1-1（型定義）は最初に実施**（P1-3, P1-4が依存）
- **P1-2（Rustウィンドウマネージャー）は独立して実施可能**
- **P1-3（フロントエンドAPI）はP1-1の後に実施**（P1-6が依存）
- **P1-4（ページ作成）はP1-1の後に実施可能**
- **P1-5（接続カードボタン）は独立して実施可能**
- **P1-6（ランチャー）はP1-3とP1-5の後に実施**
- **P1-7（動作確認）は全タスク完了後に実施**

## 完了条件

Phase 1は以下の条件をすべて満たした時点で完了とする：

- [x] 全タスク（P1-1 ~ P1-7）が完了
- [x] ランチャーの接続カードに「エディタ」ボタンが表示される
- [x] ボタンクリックでSQLエディタウィンドウが開く
- [x] 同一接続で重複ウィンドウが開かない（既存にフォーカス）
- [x] ウィンドウタイトルに接続名と環境が表示される
- [x] 環境ヘッダーが表示され、環境色が適用される
- [x] 既存のクエリビルダー・ミューテーションビルダーに影響がない
- [x] TypeScriptコンパイルエラーがない
- [x] Rustビルドエラーがない
- [x] ユニットテストが作成され、すべてパスしている

## 次のステップ

Phase 1完了後、以下の作業に進む：

1. **Phase 2: エディタUI基本構築**
   - CodeMirror 6またはPrism.jsを使用したテキストエディタの実装
   - 構文ハイライト、行番号表示
   - Undo/Redo機能

2. **永続化ドキュメント更新**（Phase 1-3完了後）
   - `docs/steering/features/sql-editor.md` の作成
   - `docs/steering/features/window.md` の更新（SQLエディタウィンドウタイプ追加）
   - `docs/steering/04_repository_structure.md` の更新（必要に応じて）
